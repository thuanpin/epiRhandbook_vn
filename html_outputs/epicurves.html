<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>32 Đường cong dịch bệnh | Cẩm nang dịch tễ học với R</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.16/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.0.0/tabwid.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.2.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.52.2/plotly-basic-1.52.2.min.js"></script><script src="libs/plotly-cartesian-1.52.2/plotly-cartesian-1.52.2.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-8.1.2/highcharts.js"></script><script src="libs/highcharts-8.1.2/highcharts-3d.js"></script><script src="libs/highcharts-8.1.2/highcharts-more.js"></script><script src="libs/highcharts-8.1.2/modules/stock.js"></script><script src="libs/highcharts-8.1.2/modules/map.js"></script><script src="libs/highcharts-8.1.2/modules/annotations.js"></script><script src="libs/highcharts-8.1.2/modules/data.js"></script><script src="libs/highcharts-8.1.2/modules/drilldown.js"></script><script src="libs/highcharts-8.1.2/modules/item-series.js"></script><script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script><script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-8.1.2/modules/exporting.js"></script><script src="libs/highcharts-8.1.2/modules/export-data.js"></script><script src="libs/highcharts-8.1.2/modules/funnel.js"></script><script src="libs/highcharts-8.1.2/modules/heatmap.js"></script><script src="libs/highcharts-8.1.2/modules/treemap.js"></script><script src="libs/highcharts-8.1.2/modules/sankey.js"></script><script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script><script src="libs/highcharts-8.1.2/modules/organization.js"></script><script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script><script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script><script src="libs/highcharts-8.1.2/modules/sunburst.js"></script><script src="libs/highcharts-8.1.2/modules/vector.js"></script><script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script><script src="libs/highcharts-8.1.2/modules/xrange.js"></script><script src="libs/highcharts-8.1.2/modules/tilemap.js"></script><script src="libs/highcharts-8.1.2/modules/venn.js"></script><script src="libs/highcharts-8.1.2/modules/gantt.js"></script><script src="libs/highcharts-8.1.2/modules/timeline.js"></script><script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script><script src="libs/highcharts-8.1.2/modules/bullet.js"></script><script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script><script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script><script src="libs/highcharts-8.1.2/modules/lollipop.js"></script><script src="libs/highcharts-8.1.2/modules/series-label.js"></script><script src="libs/highcharts-8.1.2/plugins/motion.js"></script><script src="libs/highcharts-8.1.2/custom/reset.js"></script><script src="libs/highcharts-8.1.2/modules/boost.js"></script><script src="libs/highchart-binding-0.8.2/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Cẩm nang dịch tễ học với R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Về cuốn sách này</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> Biên tập và ghi chú kỹ thuật</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> Tải sách và dữ liệu</a></li>
<li class="book-part">Nhập môn về R</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R Cơ bản</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Chuyển đổi sang R</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> Package đề xuất</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Dự án R</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> Nhập xuất dữ liệu</a></li>
<li class="book-part">Quản lý dữ liệu</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> Làm sạch số liệu và các hàm quan trọng</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> Làm việc với ngày tháng</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> Ký tự và chuỗi</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Factors</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> Xoay trục dữ liệu</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> Nhóm dữ liệu</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> Nối dữ liệu</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> Loại bỏ trùng lặp</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Lặp, vòng lặp, và danh sách</a></li>
<li class="book-part">Phân tích dữ liệu</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> Bảng mô tả</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> Các kiểm định thống kê cơ bản</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Hồi quy đơn và đa biến</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Dữ liệu Missing</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> Tỷ suất chuẩn hóa</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> Đường trung bình động</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> Chuỗi thời gian và phát hiện ổ dịch</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> Mô hình hóa dịch bệnh</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> Truy vết tiếp xúc</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> Phân tích khảo sát</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> Phân tích sống còn</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS cơ bản</a></li>
<li class="book-part">Trực quan hóa dữ liệu</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> Trình bày bảng</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot cơ bản</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> Các tips với ggplot</a></li>
<li><a class="active" href="epicurves.html"><span class="header-section-number">32</span> Đường cong dịch bệnh</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> Tháp dân số và thang đo Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> Biểu đồ nhiệt</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> Sơ đồ và biểu đồ</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> Biểu đồ kết hợp</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Chuỗi lây nhiễm</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> Cây phả hệ</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Biểu đồ tương tác</a></li>
<li class="book-part">Báo cáo và dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> Báo cáo với R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> Tổ chức báo cáo định kỳ</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> Dashboards với R Markdown</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Dashboards với Shiny</a></li>
<li class="book-part">Tổng hợp</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> Viết hàm</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> Tương tác với thư mục làm việc</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Version control với Git và Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> Các lỗi thường gặp</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> Nhờ sự trợ giúp</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> R trên ổ cứng mạng</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> Data Table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="epicurves" class="section level1" number="32">
<h1>
<span class="header-section-number">32</span> Đường cong dịch bệnh<a class="anchor" aria-label="anchor" href="#epicurves"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/epicurve_top.png" width="75%"></div>
<p>Đường cong dịch bệnh (còn được gọi là “đường cong epi”) là một biểu đồ dịch tễ học cốt lõi thường được sử dụng để trực quan xu hướng khởi phát bệnh theo thời gian trong một cụm hoặc nhóm ca bệnh.</p>
<p>Phân tích đường cong dịch bệnh có thể cho biết xu hướng theo thời gian, giá trị ngoại lai, mức độ bùng phát dịch, khoảng thời gian có khả năng bị phơi nhiễm cao nhất, khoảng thời gian giữa các thế hệ ca bệnh và thậm chí có thể giúp xác định phương thức lây truyền của một căn bệnh không xác định (ví dụ: điểm bắt nguồn, nguồn tiếp diễn phổ biến, lây truyền từ người sang người). Bạn có thể tìm thấy một bài học trực tuyến về giải thích các đường cong dịch bệnh tại trang web của <a href="https://www.cdc.gov/training/quicklearns/epimode/index.html">CDC Hoa Kỳ</a>.</p>
<p>Trong chương này, chúng tôi trình bày hai cách tiếp cận để tạo ra đường cong dịch bệnh trong R:</p>
<ul>
<li>Package <strong>incidence2</strong>, có thể tạo ra đường cong dịch bệnh với các lệnh đơn giản<br>
</li>
<li>Package <strong>ggplot2</strong>, cho phép khả năng tùy chỉnh nâng cao thông qua các lệnh phức tạp hơn</li>
</ul>
<p>Chúng tôi cũng sẽ giải quyết các trường hợp cụ thể như:</p>
<ul>
<li>Lập biểu đồ dữ liệu đếm tổng hợp<br>
</li>
<li>Faceting hoặc tạo nhiều cấu phần nhỏ<br>
</li>
<li>Áp dụng đường trung bình động<br>
</li>
<li>Hiển thị dữ liệu “dự kiến” hoặc có thể bị chậm trễ trong báo cáo<br>
</li>
<li>Thêm tỷ lệ ca nhiễm mới tích lũy bằng cách sử dụng trục thứ hai</li>
</ul>
<!-- ======================================================= --><div id="chuẩn-bị-23" class="section level2" number="32.1">
<h2>
<span class="header-section-number">32.1</span> Chuẩn bị<a class="anchor" aria-label="anchor" href="#chu%E1%BA%A9n-b%E1%BB%8B-23"><i class="fas fa-link"></i></a>
</h2>
<div id="packages-3" class="section level3 unnumbered">
<h3>Packages<a class="anchor" aria-label="anchor" href="#packages-3"><i class="fas fa-link"></i></a>
</h3>
<p>Đoạn code này hiển thị cách gọi các package cần thiết cho các phân tích. Trong cuốn sách này, chúng tôi nhấn mạnh đến hàm <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> từ package <strong>pacman</strong>, sẽ cài đặt package nếu cần <em>và</em> gọi package để sử dụng. Bạn cũng có thể cài đặt package với hàm <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> từ <strong>base</strong> R. Xem chương <a href="basics.html#basics">R cơ bản</a> để biết thêm thông tin về các package trong R.</p>
<div class="sourceCode" id="cb1510"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">rio</span>,          <span class="co"># file import/export</span>
  <span class="va">here</span>,         <span class="co"># relative filepaths </span>
  <span class="va">lubridate</span>,    <span class="co"># working with dates/epiweeks</span>
  <span class="va">aweek</span>,        <span class="co"># alternative package for working with dates/epiweeks</span>
  <span class="va">incidence2</span>,   <span class="co"># epicurves of linelist data</span>
  <span class="va">i2extras</span>,     <span class="co"># supplement to incidence2</span>
  <span class="va">stringr</span>,      <span class="co"># search and manipulate character strings</span>
  <span class="va">forcats</span>,      <span class="co"># working with factors</span>
  <span class="va">RColorBrewer</span>, <span class="co"># Color palettes from colorbrewer2.org</span>
  <span class="va">tidyverse</span>     <span class="co"># data management + ggplot2 graphics</span>
<span class="op">)</span> </code></pre></div>
</div>
<div id="nhập-dữ-liệu-17" class="section level3 unnumbered">
<h3>Nhập dữ liệu<a class="anchor" aria-label="anchor" href="#nh%E1%BA%ADp-d%E1%BB%AF-li%E1%BB%87u-17"><i class="fas fa-link"></i></a>
</h3>
<p>Hai bộ dữ liệu mẫu được sử dụng trong chương này:</p>
<ul>
<li>Bộ số liệu <code>linelist</code> về các ca bệnh từ một vụ dịch mô phỏng<br>
</li>
<li>Số lượng tổng hợp theo bệnh viện từ cùng một dịch bệnh mô phỏng bên trên</li>
</ul>
<p>Các bộ dữ liệu được nhập bằng hàm <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> từ package <strong>rio</strong>. Xem chương <a href="importing.html#importing">Nhập xuất dữ liệu</a> để biết các cách nhập dữ liệu khác nhau.</p>
<p><strong>Bộ số liệu <code>linelist</code></strong></p>
<p>Chúng ta nhập bộ dữ liệu về các ca bệnh mô phỏng từ một vụ dịch Ebola. Nếu bạn muốn tải xuống dữ liệu để làm theo từng bước, hãy xem hướng dẫn trong chương <a href="data-used.html#data-used">Tải sách và dữ liệu</a>. Chúng tôi giả sử các tệp tin nằm trong thư mục làm việc nên không có thư mục con nào được chỉ định trong đường dẫn này.</p>
<div class="sourceCode" id="cb1511"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.xlsx"</span><span class="op">)</span></code></pre></div>
<p>50 dòng đầu tiên được hiển thị như bên dưới:</p>
<div id="htmlwidget-6b1d5ddb6d7b35fa2efc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6b1d5ddb6d7b35fa2efc">{"x":{"filter":"none","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>Số lượng ca bệnh do bệnh viện tổng hợp</strong></p>
<p>Theo mục tiêu của cuốn sách này, bộ dữ liệu về số lượng tổng hợp hàng tuần theo bệnh viện được tạo từ <code>linelist</code> với đoạn code sau.</p>
<div class="sourceCode" id="cb1512"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import the counts data into R</span>
<span class="va">count_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">date_hospitalisation</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarize</span><span class="op">(</span>n_cases <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>50 dòng đầu tiên được hiển thị như bên dưới:</p>
<div id="htmlwidget-cb153c2607bc112d174a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-cb153c2607bc112d174a">{"x":{"filter":"none","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="thiết-lập-các-tham-số" class="section level3 unnumbered">
<h3>Thiết lập các tham số<a class="anchor" aria-label="anchor" href="#thi%E1%BA%BFt-l%E1%BA%ADp-c%C3%A1c-tham-s%E1%BB%91"><i class="fas fa-link"></i></a>
</h3>
<p>Để tạo báo cáo, bạn có thể muốn thiết lập các thông số có thể chỉnh sửa, chẳng hạn như ngày dữ liệu hiện tại (“ngày dữ liệu”). Sau đó, bạn có thể tham chiếu đối tượng <code>data_date</code> trong code khi áp dụng bộ lọc hoặc trong chú thích động.</p>
<div class="sourceCode" id="cb1513"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## set the report date for the report</span>
<span class="co">## note: can be set to Sys.Date() for the current date</span>
<span class="va">data_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-05-15"</span><span class="op">)</span></code></pre></div>
</div>
<div id="xác-minh-ngày" class="section level3 unnumbered">
<h3>Xác minh ngày<a class="anchor" aria-label="anchor" href="#x%C3%A1c-minh-ng%C3%A0y"><i class="fas fa-link"></i></a>
</h3>
<p>Xác minh rằng mỗi cột ngày có liên quan là phân lớp Ngày và có phạm vi giá trị thích hợp. Bạn có thể thực hiện việc này đơn giản bằng cách sử dụng hàm <code><a href="https://rdrr.io/r/graphics/hist.html">hist()</a></code> cho histogram hoặc hàm <code><a href="https://rdrr.io/r/base/range.html">range()</a></code> với <code>na.rm=TRUE</code>, hoặc với hàm <code>ggplot()</code> như bên dưới.</p>
<div class="sourceCode" id="cb1514"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># check range of onset dates</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1118-1.png" width="50%"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="đường-cong-dịch-bệnh-với-package-incidence2" class="section level2" number="32.2">
<h2>
<span class="header-section-number">32.2</span> Đường cong dịch bệnh với package <strong>incidence2</strong><a class="anchor" aria-label="anchor" href="#%C4%91%C6%B0%E1%BB%9Dng-cong-d%E1%BB%8Bch-b%E1%BB%87nh-v%E1%BB%9Bi-package-incidence2"><i class="fas fa-link"></i></a>
</h2>
<p>Dưới đây, chúng tôi trình bày cách tạo các đường cong dịch bệnh bằng cách sử dụng package <strong>precision2</strong>. Các tác giả của package này đã cố gắng cho phép người dùng tạo và sửa đổi các đường cong dịch bệnh mà không cần biết cú pháp <strong>ggplot2</strong>. Phần lớn nội dung của chương này được điều chỉnh từ <strong>minh họa</strong> của package, bạn có thể tìm thấy tại trang <a href="https://github.com/reconhub/incidence2">github</a> của package <strong>incidence2</strong>.</p>
<!-- ======================================================= -->
<div id="ví-dụ-đơn-giản" class="section level3 unnumbered">
<h3>Ví dụ đơn giản<a class="anchor" aria-label="anchor" href="#v%C3%AD-d%E1%BB%A5-%C4%91%C6%A1n-gi%E1%BA%A3n"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Cần có 2 bước để vẽ đường cong dịch bệnh với package <em>incidence2</em>:</strong></p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Tạo</strong> một <em>incidence object</em> (sử dụng hàm <code>incidence()</code>)</p>
<ul>
<li>Cung cấp dữ liệu<br>
</li>
<li>Xác định cột ngày tại <code>date_index =</code><br>
</li>
<li>Xác định khoảng thời gian <code>interval =</code> các ca nên được tổng hợp (hàng ngày, tuần, tháng..)<br>
</li>
<li>Xác định bất kỳ cột dùng để nhóm nào (ví dụ như giới tính, bệnh viện, kết quả)<br>
</li>
</ul>
</li>
<li>
<p><strong>Vẽ biểu đồ</strong> incidence object</p>
<ul>
<li>Xác định nhãn, màu, tiêu đề, …</li>
</ul>
</li>
</ol>
<p>Dưới đây, chúng tôi gọi package <strong>incidence2</strong>, tạo incidence object từ dữ liệu <code>linelist</code> trên cột <code>date_onset</code> và tổng hợp các trường hợp theo ngày. Sau đó, chúng tôi in ra tóm tắt về đối tượng incidence object.</p>
<div class="sourceCode" id="cb1515"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load incidence2 package</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">incidence2</span><span class="op">)</span>

<span class="co"># create the incidence object, aggregating cases by day</span>
<span class="va">epi_day</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>       <span class="co"># create incidence object</span>
  x <span class="op">=</span> <span class="va">linelist</span>,             <span class="co"># dataset</span>
  date_index <span class="op">=</span> <span class="va">date_onset</span>,  <span class="co"># date column</span>
  interval <span class="op">=</span> <span class="st">"day"</span>          <span class="co"># date grouping interval</span>
  <span class="op">)</span></code></pre></div>
<p>Đối tượng <strong>incidence2</strong> trông giống như một tibble (một kiểu data frame) và có thể được hiển thị hoặc thao tác thêm như một bộ dữ liệu.</p>
<div class="sourceCode" id="cb1516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">epi_day</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "incidence2" "tbl_df"     "tbl"        "data.frame"</code></pre>
<p>Đây là thông tin khi được hiển thị. Nó có một cột <code>date_index</code> và một cột <code>count</code> .</p>
<div class="sourceCode" id="cb1518"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">epi_day</span></code></pre></div>
<pre><code>## An incidence2 object: 367 x 2
## 5632 cases from 2014-04-07 to 2015-04-30
## interval: 1 day
## cumulative: FALSE
## 
##    date_index count
##    &lt;date&gt;     &lt;int&gt;
##  1 2014-04-07     1
##  2 2014-04-15     1
##  3 2014-04-21     2
##  4 2014-04-25     1
##  5 2014-04-26     1
##  6 2014-04-27     1
##  7 2014-05-01     2
##  8 2014-05-03     1
##  9 2014-05-04     1
## 10 2014-05-05     1
## # ... with 357 more rows</code></pre>
<p>Bạn cũng có thể tổng hợp thông tin của đối tượng:</p>
<div class="sourceCode" id="cb1520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print summary of the incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">epi_day</span><span class="op">)</span></code></pre></div>
<pre><code>## An incidence2 object: 367 x 2
## 5632 cases from 2014-04-07 to 2015-04-30
## interval: 1 day
## cumulative: FALSE
## timespan: 389 days</code></pre>
<p>Để <em>vẽ biểu đồ incidence object</em>, hãy sử dụng hàm <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> với <em>tên của incidence object</em>. Trong nền, hàm <code>plot.incidence2()</code> đã được gọi, vì vậy để đọc tài liệu cụ thể về <strong>incidence2</strong>, bạn cần chạy lệnh <code>?plot.incidence2</code>.</p>
<div class="sourceCode" id="cb1522"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_day</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1123-1.png" width="672"></div>
<p>Nếu bạn nhận thấy nhiều đường dọc nhỏ màu trắng, hãy cố gắng điều chỉnh kích thước hình ảnh của bạn. Ví dụ: nếu bạn xuất biểu đồ bằng <code>ggsave()</code>, bạn có thể cung cấp giá trị số cho <code>width =</code> và <code>height =</code>. Nếu bạn mở rộng biểu đồ, những đường đó có thể biến mất.</p>
</div>
<div id="thay-đổi-khoảng-thời-gian-tổng-hợp-ca-bệnh" class="section level3 unnumbered">
<h3>Thay đổi khoảng thời gian tổng hợp ca bệnh<a class="anchor" aria-label="anchor" href="#thay-%C4%91%E1%BB%95i-kho%E1%BA%A3ng-th%E1%BB%9Di-gian-t%E1%BB%95ng-h%E1%BB%A3p-ca-b%E1%BB%87nh"><i class="fas fa-link"></i></a>
</h3>
<p>Đối số <code>interval =</code> của hàm <code>incidence()</code> xác định cách các quan sát được nhóm thành các cột dọc trong biểu đồ.</p>
<p><strong>Xác định khoảng thời gian</strong></p>
<p><strong>incidence2</strong> đem lại sự linh hoạt và cú pháp dễ hiểu để bạn có thể dễ dàng tổng hợp số ca bệnh thành các biểu đồ cột-đường cong dịch bệnh. Cung cấp một giá trị như những giá trị bên dưới cho đối số <code>interval =</code>. Bạn có thể viết bất kỳ thông tin nào bên dưới dưới dạng số nhiều (ví dụ: “week<strong>s</strong>”) và bạn có thể thêm số phía trước (ví dụ: “3 months”).</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Tùy chọn đối số</th>
<th>Giải thích thêm</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Số (1, 7, 13, 14, etc.)</td>
<td>số ngày cho mỗi khoảng thời gian</td>
</tr>
<tr class="even">
<td>“weeks”</td>
<td>ghi chú: mặc định ngày bắt đầu là Thứ 2</td>
</tr>
<tr class="odd">
<td>“2 weeks”</td>
<td>hoặc 3, 4, 5…</td>
</tr>
<tr class="even">
<td>“Sunday weeks”</td>
<td>tuần bắt đầu tính từ Chủ nhật (cũng có thể là Thứ 5, …)</td>
</tr>
<tr class="odd">
<td>“2 Sunday weeks”</td>
<td>hoặc 3, 4, 5…</td>
</tr>
<tr class="even">
<td>“MMWRweek”</td>
<td>tuần bắt đầu vào Chủ nhật - xem thêm tại CDC Hoa Kỳ</td>
</tr>
<tr class="odd">
<td>“month”</td>
<td>ngày đầu tiên của tháng</td>
</tr>
<tr class="even">
<td>“quarter”</td>
<td>ngày đầu tiên của tháng của một quí</td>
</tr>
<tr class="odd">
<td>“2 months”</td>
<td>hoặc 3, 4, 5…</td>
</tr>
<tr class="even">
<td>“year”</td>
<td>ngày đầu tiên của năm</td>
</tr>
</tbody>
</table></div>
<p>Dưới đây là ví dụ về các khoảng thời gian khác nhau trông như thế nào khi áp dụng vào bộ số liệu <code>linelist</code>. Lưu ý cách mà định dạng mặc định và tần suất của các <em>nhãn</em> thời gian trên trục x thay đổi khi khoảng thời gian thay đổi.</p>
<div class="sourceCode" id="cb1523"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create the incidence objects (with different intervals)</span>
<span class="co">##############################</span>
<span class="co"># Weekly (Monday week by default)</span>
<span class="va">epi_wk</span>      <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Monday week"</span><span class="op">)</span>

<span class="co"># Sunday week</span>
<span class="va">epi_Sun_wk</span>  <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"Sunday week"</span><span class="op">)</span>

<span class="co"># Three weeks (Monday weeks by default)</span>
<span class="va">epi_2wk</span>     <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"2 weeks"</span><span class="op">)</span>

<span class="co"># Monthly</span>
<span class="va">epi_month</span>   <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span>

<span class="co"># Quarterly</span>
<span class="va">epi_quarter</span>   <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"quarter"</span><span class="op">)</span>

<span class="co"># Years</span>
<span class="va">epi_year</span>   <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span>


<span class="co"># Plot the incidence objects (+ titles for clarity)</span>
<span class="co">############################</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_wk</span><span class="op">)</span><span class="op">+</span>      <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Monday weeks"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_Sun_wk</span><span class="op">)</span><span class="op">+</span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sunday weeks"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_2wk</span><span class="op">)</span><span class="op">+</span>     <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"2 (Monday) weeks"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_month</span><span class="op">)</span><span class="op">+</span>   <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Months"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_quarter</span><span class="op">)</span><span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Quarters"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_year</span><span class="op">)</span><span class="op">+</span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Years"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/incidence-1.png" width="50%"><img src="_main_files/figure-html/incidence-2.png" width="50%"><img src="_main_files/figure-html/incidence-3.png" width="50%"><img src="_main_files/figure-html/incidence-4.png" width="50%"><img src="_main_files/figure-html/incidence-5.png" width="50%"><img src="_main_files/figure-html/incidence-6.png" width="50%"></p>
<!--**Bắt đầu với ca đầu tiên**-->
<!--Nếu bạn muốn các khoảng thời gian bắt đầu ở trường hợp đầu tiên, bạn có thể thêm argument `standard = TRUE` vào lệnh `incidence()`. Điều này chỉ hoạt động nếu khoảng thời gian là "tuần", "tháng", "quý" hoặc "năm".-->
<p><strong>Ngày đầu tiên</strong></p>
<p>Bạn có thể tùy chọn chỉ định một giá trị thuộc phân lớp Ngày (ví dụ: <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date("2016-05-01")</a></code>) tới đối số <code>firstdate =</code> trong lệnh <code>incidence()</code>. Nếu được cung cấp, dữ liệu sẽ được cắt bớt theo phạm vi này và khoảng thời gian sẽ bắt đầu từ ngày này.</p>
</div>
<div id="nhóm-1" class="section level3 unnumbered">
<h3>Nhóm<a class="anchor" aria-label="anchor" href="#nh%C3%B3m-1"><i class="fas fa-link"></i></a>
</h3>
<p>Các nhóm được chỉ định trong lệnh <code>incidence()</code> và có thể được sử dụng để tô màu cho các cột hoặc facet dữ liệu. Để chỉ định các nhóm trong dữ liệu của bạn, hãy cung cấp tên cột tới đối số <code>groups =</code> trong hàm <code>incidence()</code> (không có dấu ngoặc kép xung quanh tên cột). Nếu chỉ định nhiều cột, hãy để tên các cột bên trong hàm <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>.</p>
<p>Bạn có thể chỉ định rằng các trường hợp có giá trị bị thiếu trong các cột được nhóm được liệt kê như một nhóm <code>NA</code> riêng biệt bằng cách thiết lập <code>na_as_group = TRUE</code>. Nếu không, chúng sẽ bị loại khỏi biểu đồ.</p>
<ul>
<li><p>Để <em>tô màu các cột theo cột nhóm</em>, bạn cần cung cấp lại tên cột tới đối số <code>fill =</code> trong lệnh <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>.</p></li>
<li><p>Để <em>facet dựa trên cột nhóm</em>, hãy xem phần bên dưới về facet với <strong>incidence2</strong>.</p></li>
</ul>
<p>Trong ví dụ dưới đây, các trường hợp trong toàn bộ đợt bùng phát được nhóm theo phân loại tuổi của họ. Các giá trị thiếu được đưa vào một nhóm. Khoảng thời gian của đường cong bệnh dịch là tuần.</p>
<div class="sourceCode" id="cb1524"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create incidence object, with data grouped by age category</span>
<span class="va">age_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">linelist</span>,                <span class="co"># dataset</span>
  date_index <span class="op">=</span> <span class="va">date_onset</span>, <span class="co"># date column</span>
  interval <span class="op">=</span> <span class="st">"week"</span>,       <span class="co"># Monday weekly aggregation of cases</span>
  groups <span class="op">=</span> <span class="va">age_cat</span>,        <span class="co"># age_cat is set as a group</span>
  na_as_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>      <span class="co"># missing values assigned their own group</span>

<span class="co"># plot the grouped incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">age_outbreak</span>,             <span class="co"># incidence object with age_cat as group</span>
  fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span><span class="op">+</span>          <span class="co"># age_cat is used for bar fill color (must have been set as a groups column above)</span>
<span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Age Category"</span><span class="op">)</span> <span class="co"># change legend title from default "age_cat" (this is a ggplot2 modification)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1124-1.png" width="672"></div>
<p><span style="color: darkgreen;"><strong><em>MẸO</em></strong>: Thay đổi tiêu đề của chú giải bằng cách thêm <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> lệnh <strong>ggplot2</strong> <code>labs(fill = "your title")</code> vào biểu đồ <strong>incidence2</strong>.</span></p>
<p>Bạn cũng có thể để các cột được nhóm hiển thị cạnh nhau bằng cách đặt <code>stack = FALSE</code> trong <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>, như được hiển thị bên dưới:</p>
<div class="sourceCode" id="cb1525"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make incidence object of monthly counts. </span>
<span class="va">monthly_gender</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
 <span class="va">linelist</span>,
 date_index <span class="op">=</span> <span class="va">date_onset</span>,
 interval <span class="op">=</span> <span class="st">"month"</span>,
 groups <span class="op">=</span> <span class="va">gender</span>            <span class="co"># set gender as grouping column</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">monthly_gender</span>,   <span class="co"># incidence object</span>
  fill <span class="op">=</span> <span class="va">gender</span>,    <span class="co"># display bars colored by gender</span>
  stack <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>    <span class="co"># side-by-side (not stacked)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1125-1.png" width="672"></div>
<p>Bạn có thể đặt đối số <code>na_as_group =</code> thành FALSE trong lệnh <code>incidence()</code> để loại bỏ các hàng có giá trị bị thiếu khỏi biểu đồ.</p>
</div>
<div id="lọc-dữ-liệu" class="section level3 unnumbered">
<h3>Lọc dữ liệu<a class="anchor" aria-label="anchor" href="#l%E1%BB%8Dc-d%E1%BB%AF-li%E1%BB%87u"><i class="fas fa-link"></i></a>
</h3>
<p>Để vẽ biểu đồ đường cong dịch bệnh của một bộ dữ liệu con:</p>
<ol style="list-style-type: decimal">
<li>Lọc bộ số liệu <code>linelist</code><br>
</li>
<li>Cung cấp dữ liệu đã lọc vào lệnh <code>incidence()</code><br>
</li>
<li>Vẽ biểu đồ incidence object</li>
</ol>
<p>Ví dụ dưới đây sử dụng dữ liệu được lọc để chỉ hiển thị các trường hợp tại Central Hospital.</p>
<div class="sourceCode" id="cb1526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter the linelist</span>
<span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span>

<span class="co"># create incidence object using filtered data</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span><span class="va">central_data</span>, date_index <span class="op">=</span> <span class="va">date_onset</span>, interval <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>

<span class="co"># plot the incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">central_outbreak</span>, title <span class="op">=</span> <span class="st">"Weekly case incidence at Central Hospital"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1126-1.png" width="672"></div>
</div>
<div id="số-lượng-tổng-hợp" class="section level3 unnumbered">
<h3>Số lượng tổng hợp<a class="anchor" aria-label="anchor" href="#s%E1%BB%91-l%C6%B0%E1%BB%A3ng-t%E1%BB%95ng-h%E1%BB%A3p"><i class="fas fa-link"></i></a>
</h3>
<p>Nếu dữ liệu ban đầu của bạn được tổng hợp (số lượng), hãy cung cấp tên của cột chứa thông tin về số lượng ca tới đối số <code>count =</code> khi tạo incidence object với hàm <code>incidence()</code>.</p>
<p>Ví dụ, data frame <code>count_data</code> này được tổng hợp từ linelist theo số lượng hàng ngày theo bệnh viện. 50 hàng đầu tiên hiển thị như sau:</p>
<div id="htmlwidget-5d9db20d5b022259fb9f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5d9db20d5b022259fb9f">{"x":{"filter":"none","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Nếu bạn đang bắt đầu phân tích với dữ liệu đếm hàng ngày như bộ dữ liệu ở trên, thì lệnh <code>incidence()</code> để chuyển đổi dữ liệu này thành đường cong dịch bệnh hàng tuần theo bệnh viện sẽ trông như sau:</p>
<div class="sourceCode" id="cb1527"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">epi_counts</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>              <span class="co"># create weekly incidence object</span>
  <span class="va">count_data</span>,                         <span class="co"># dataset with counts aggregated by day</span>
  date_index <span class="op">=</span> <span class="va">date_hospitalisation</span>,  <span class="co"># column with dates</span>
  count <span class="op">=</span> <span class="va">n_cases</span>,                    <span class="co"># column with counts</span>
  interval <span class="op">=</span> <span class="st">"week"</span>,                  <span class="co"># aggregate daily counts up to weeks</span>
  groups <span class="op">=</span> <span class="va">hospital</span>                   <span class="co"># group by hospital</span>
  <span class="op">)</span>

<span class="co"># plot the weekly incidence epi curve, with stacked bars by hospital</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">epi_counts</span>,                      <span class="co"># incidence object</span>
     fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>                 <span class="co"># color the bars by hospital</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1128-1.png" width="672"></div>
</div>
<div id="facetscác-biểu-đồ-nhỏ" class="section level3 unnumbered">
<h3>Facets/Các biểu đồ nhỏ<a class="anchor" aria-label="anchor" href="#facetsc%C3%A1c-bi%E1%BB%83u-%C4%91%E1%BB%93-nh%E1%BB%8F"><i class="fas fa-link"></i></a>
</h3>
<p>Để facet dữ liệu theo nhóm (ví dụ tạo “các biểu đồ nhỏ”):</p>
<ol style="list-style-type: decimal">
<li>Xác định các cột dùng để facet tới đối số <code>groups =</code> khi bạn tạo incidence object<br>
</li>
<li>Sử dụng lệnh <code>facet_plot()</code> thay cho <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code><br>
</li>
<li>Xác định cột nhóm nào được sử dụng cho <code>fill =</code> và cho <code>facets =</code>
</li>
</ol>
<p>Dưới đây, chúng ta thiết lập cả hai cột <code>hospital</code> và <code>outcome</code> làm cột chia nhóm trong lệnh <code>incidence()</code>. Sau đó, trong lệnh <code>facet_plot()</code>, chúng ta vẽ biểu đồ đường cong dịch bệnh, chỉ rõ rằng chúng ta muốn có các đường cong dịch bệnh khác nhau cho mỗi bệnh viện và trong mỗi đường cong dịch bệnh, các cột được xếp chồng lên nhau và được tô màu theo outcome.</p>
<div class="sourceCode" id="cb1528"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">epi_wks_hosp_out</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">linelist</span>,                      <span class="co"># dataset</span>
  date_index <span class="op">=</span> <span class="va">date_onset</span>,       <span class="co"># date column</span>
  interval <span class="op">=</span> <span class="st">"month"</span>,            <span class="co"># monthly bars  </span>
  groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">hospital</span><span class="op">)</span>  <span class="co"># both outcome and hospital are given as grouping columns</span>
  <span class="op">)</span>

<span class="co"># plot</span>
<span class="fu">incidence2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/incidence2/man/plot.incidence2.html">facet_plot</a></span><span class="op">(</span>
  <span class="va">epi_wks_hosp_out</span>,      <span class="co"># incidence object</span>
  facets <span class="op">=</span> <span class="va">hospital</span>,     <span class="co"># facet column</span>
  fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>        <span class="co"># fill column</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1129-1.png" width="672"></div>
<p>Lưu ý rằng package <strong>ggtree</strong> (được sử dụng để trực quan cây phả hệ) cũng có một hàm là <code>facet_plot()</code> - đây là lý do tại sao chúng ta phải cụ thể <code><a href="https://rdrr.io/pkg/incidence2/man/plot.incidence2.html">incidence2::facet_plot()</a></code> như ở trên.</p>
</div>
<div id="hiệu-chỉnh-với-plot" class="section level3 unnumbered">
<h3>Hiệu chỉnh với <code>plot()</code><a class="anchor" aria-label="anchor" href="#hi%E1%BB%87u-ch%E1%BB%89nh-v%E1%BB%9Bi-plot"><i class="fas fa-link"></i></a>
</h3>
<p>Một đường cong dịch bệnh được tạo ra bởi <strong>incidence2</strong> có thể được sửa đổi thông qua các đối số <em>trong hàm <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code></em>.</p>
<p><strong>Dưới đây là các đối số của hàm <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> dùng để điều chỉnh hình thức cột:</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="8%">
<col width="58%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Đối số</th>
<th>Mô tả</th>
<th>Ví dụ</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>fill =</code></td>
<td>Màu cột. Tên màu hoặc tên cột đã được chỉ định trước đó tới đối số <code>groups =</code> trong lệnh <code>incidence()</code>
</td>
<td>
<code>fill = "red"</code>, hoặc <code>fill = gender</code>
</td>
</tr>
<tr class="even">
<td><code>color =</code></td>
<td>Tô màu xung quanh mỗi cột hoặc xung quanh mỗi nhóm trong một cột</td>
<td><code>border = "white"</code></td>
</tr>
<tr class="odd">
<td><code>legend =</code></td>
<td>Vị trí danh mục</td>
<td>Một trong các lựa chọn “bottom”, “top”, “left”, “right”, hoặc “none”</td>
</tr>
<tr class="even">
<td><code>alpha =</code></td>
<td>Độ trong suốt của cột</td>
<td>1 là đục hoàn toàn, 0 là trong suốt hoàn toàn</td>
</tr>
<tr class="odd">
<td><code>width =</code></td>
<td>Giá trị từ 0 đến 1 cho biết kích thước tương đối của các cột với khoảng thời gian của chúng</td>
<td><code>width = .7</code></td>
</tr>
<tr class="even">
<td><code>show_cases =</code></td>
<td>Giá trị logic; nếu TRUE, mỗi trường hợp hiển thị như một hộp. Cách hiển thị này là tốt nhất trên các đợt bùng phát nhỏ.</td>
<td><code>show_cases = TRUE</code></td>
</tr>
</tbody>
</table></div>
<p><strong>Dưới đây là các đối số của hàm <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> để sửa đổi trục ngày tháng:</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="12%">
<col width="87%">
</colgroup>
<thead><tr class="header">
<th>Đối số</th>
<th>Mô tả</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>centre_dates =</code></td>
<td>TRUE/FALSE tương đương với việc hiển thị ngày tháng xuất hiện ở dưới trung tâm các cột hay ở trên đỉnh các cột</td>
</tr>
<tr class="even">
<td><code>date_format =</code></td>
<td>Điều chỉnh định dạng hiển thị ngày bằng cú pháp <code><a href="https://rdrr.io/r/base/strptime.html">strptime("%")</a></code>. Chỉ hoạt động nếu <code>centre_dates = FALSE</code> (chi tiết bên dưới).</td>
</tr>
<tr class="odd">
<td><code>n.breaks =</code></td>
<td>Khoảng số lượng nhãn ngắt khoảng trên trục x mong muốn.</td>
</tr>
<tr class="even">
<td><code>angle =</code></td>
<td>Góc nghiêng của nhãn ngày trên trục x (số độ)</td>
</tr>
<tr class="odd">
<td><code>size =</code></td>
<td>Kích thước của văn bản tính bằng điểm</td>
</tr>
</tbody>
</table></div>
<p>Lưu ý rằng đối số <code>date_breaks =</code> chỉ hoạt động nếu <code>centre_dates = FALSE</code>. Cung cấp giá trị ký tự trong dấu ngoặc kép bằng cú pháp strptime như bên dưới, như đã được trình bày chi tiết trong chương <a href="dates.html#dates">Làm việc với ngày tháng</a>. Bạn có thể sử dụng <code>\n</code> để tạo “dòng mới”.</p>
<p>%d = Số ngày của tháng (5, 17, 28, …)<br>
%j = Số ngày của năm (ngày Julian 001-366)<br>
%a = Ngày trong tuần viết tắt (Mon, Tue, Wed, …)<br>
%A = Ngày trong tuần viết đầy đủ (Monday, Tuesday, …)<br>
%w = Số thứ tự ngày của tuần (0-6, Chủ nhật là 0)<br>
%u = Số thứ tự ngày của tuần (1-7, Thứ hai là 1)<br>
%W = Số thứ tự tuần (00-53, Thứ hai là ngày bắt đầu tuần mới)<br>
%U = Số thứ tự tuần (01-53, Chủ nhật là ngày bắt đầu tuần mới)<br>
%m = Số thứ tự tháng (Ví dụ 01, 02, 03, 04)<br>
%b = Tháng viết tắt (Jan, Feb, …)<br>
%B = Tháng viết đầy đủ (January, February, …)<br>
%y = Năm viết dạng 2 ký tự (Ví dụ 89)<br>
%Y = Năm viết dạng 2 ký tự (Ví dụ 1989)<br>
%H = giờ (khung 24 giờ)<br>
%M = phút<br>
%S = giây<br>
%z = bù từ múi giờ GMT<br>
%Z = Múi giờ (ký tự)</p>
<!--<span style="color: darkgreen;">**_MẸO:_** Đối với ngắt mỗi khoảng "thứ n" (ví dụ: mỗi khoảng thứ 4), hãy sử dụng `n.breaks = nrow(i)/n` (trong đó "i" là tên chỉ số tỷ lệ mắc bệnh và "n" là một số). Nếu dữ liệu của bạn được nhóm lại, bạn sẽ cần nhân "n" với số nhóm duy nhất.</span>-->
<p><strong>Dưới đây là các đối số trong hàm <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> để hiệu chỉnh các nhãn trong biểu đồ:</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="7%">
<col width="92%">
</colgroup>
<thead><tr class="header">
<th>Đối số</th>
<th>Mô tả</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>title =</code></td>
<td>Tiêu đề của biểu đồ</td>
</tr>
<tr class="even">
<td><code>xlab =</code></td>
<td>Tiêu đề của trục x</td>
</tr>
<tr class="odd">
<td><code>ylab =</code></td>
<td>Tiêu đề của trục y</td>
</tr>
<tr class="even">
<td><code>size =</code></td>
<td>Kích thước của đoạn văn bản trên trục x tính bằng đơn vị pts (sử dụng hàm <code>theme()</code> trong ggplot để điều chỉnh các thông số kích thước khác)</td>
</tr>
</tbody>
</table></div>
<p>Một ví dụ sử dụng kết hợp các đối số ở trên:</p>
<div class="sourceCode" id="cb1529"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter the linelist</span>
<span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span>

<span class="co"># create incidence object using filtered data</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">central_data</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>,
  interval <span class="op">=</span> <span class="st">"week"</span>,
  groups <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>

<span class="co"># plot incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">central_outbreak</span>,
  fill <span class="op">=</span> <span class="va">outcome</span>,                       <span class="co"># box/bar color</span>
  legend <span class="op">=</span> <span class="st">"top"</span>,                       <span class="co"># legend on top</span>
  title <span class="op">=</span> <span class="st">"Cases at Central Hospital"</span>,  <span class="co"># title</span>
  xlab <span class="op">=</span> <span class="st">"Week of onset"</span>,               <span class="co"># x-axis label</span>
  ylab <span class="op">=</span> <span class="st">"Week of onset"</span>,               <span class="co"># y-axis label</span>
  show_cases <span class="op">=</span> <span class="cn">TRUE</span>,                    <span class="co"># show each case as an individual box</span>
  alpha <span class="op">=</span> <span class="fl">0.7</span>,                          <span class="co"># transparency </span>
  border <span class="op">=</span> <span class="st">"grey"</span>,                      <span class="co"># box border</span>
  angle <span class="op">=</span> <span class="fl">30</span>,                           <span class="co"># angle of date labels</span>
  centre_dates <span class="op">=</span> <span class="cn">FALSE</span>,                 <span class="co"># date labels at edge of bar</span>
  date_format <span class="op">=</span> <span class="st">"%a %d %b %Y\n(Week %W)"</span> <span class="co"># adjust how dates are displayed</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1130-1.png" width="672"></div>
<p>Để điều chỉnh thêm giao diện hiển thị của biểu đồ, hãy xem mục bên dưới về các hiệu chỉnh với hàm <code>ggplot()</code>.</p>
</div>
<div id="hiệu-chỉnh-với-ggplot2" class="section level3 unnumbered">
<h3>Hiệu chỉnh với ggplot2<a class="anchor" aria-label="anchor" href="#hi%E1%BB%87u-ch%E1%BB%89nh-v%E1%BB%9Bi-ggplot2"><i class="fas fa-link"></i></a>
</h3>
<p>Bạn có thể hiệu chỉnh biểu đồ được tạo bởi <strong>incidence2</strong> bằng cách thêm các hiệu chỉnh <strong>ggplot2</strong> với dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> sau khi đóng ngoặc hàm biểu diễn tỷ lệ mắc bệnh <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>, như được minh họa bên dưới.</p>
<p>Dưới đây, biểu đồ <strong>incidence2</strong> kết thúc và ngay sau đó các lệnh <strong>ggplot2</strong> được sử dụng để sửa đổi các trục, thêm chú thích và điều chỉnh phông chữ đậm và kích thước chữ.</p>
<p>Lưu ý rằng nếu bạn thêm <code>scale_x_date()</code>, hầu hết các định dạng ngày từ <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> sẽ bị ghi đè. Xem mục đường cong dịch bệnh với <code>ggplot()</code> và chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a> để có thêm lựa chọn.</p>
<div class="sourceCode" id="cb1530"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter the linelist</span>
<span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span>

<span class="co"># create incidence object using filtered data</span>
<span class="va">central_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">central_data</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>,
  interval <span class="op">=</span> <span class="st">"week"</span>,
  groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">central_outbreak</span>,
  fill <span class="op">=</span> <span class="va">outcome</span>,                       <span class="co"># box/bar color</span>
  legend <span class="op">=</span> <span class="st">"top"</span>,                       <span class="co"># legend on top</span>
  title <span class="op">=</span> <span class="st">"Cases at Central Hospital"</span>,  <span class="co"># title</span>
  xlab <span class="op">=</span> <span class="st">"Week of onset"</span>,               <span class="co"># x-axis label</span>
  ylab <span class="op">=</span> <span class="st">"Week of onset"</span>,               <span class="co"># y-axis label</span>
  show_cases <span class="op">=</span> <span class="cn">TRUE</span>,                    <span class="co"># show each case as an individual box</span>
  alpha <span class="op">=</span> <span class="fl">0.7</span>,                          <span class="co"># transparency </span>
  border <span class="op">=</span> <span class="st">"grey"</span>,                      <span class="co"># box border</span>
  centre_dates <span class="op">=</span> <span class="cn">FALSE</span>,                   
  date_format <span class="op">=</span> <span class="st">"%a %d %b\n%Y (Week %W)"</span>, 
  angle <span class="op">=</span> <span class="fl">30</span>                           <span class="co"># angle of date labels</span>
  <span class="op">)</span><span class="op">+</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">30</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,  <span class="co"># specify y-axis increments by 5</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                         <span class="co"># remove excess space below 0 on y-axis</span>
  
  <span class="co"># add dynamic caption</span>
  <span class="fu">labs</span><span class="op">(</span>
    fill <span class="op">=</span> <span class="st">"Patient outcome"</span>,                               <span class="co"># Legend title</span>
    caption <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span>                            <span class="co"># dynamic caption - see page on characters and strings for details</span>
      <span class="st">"n = {central_cases} from Central Hospital
      Case onsets range from {earliest_date} to {latest_date}. {missing_onset} cases are missing date of onset and not shown"</span>,
      central_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span>,
      earliest_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">'%a %d %b %Y'</span><span class="op">)</span>,
      latest_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">'%a %d %b %Y'</span><span class="op">)</span>,      
      missing_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">central_data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># adjust bold face, and caption position</span>
  <span class="fu">theme</span><span class="op">(</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,    <span class="co"># axis titles larger and bold</span>
    axis.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,     <span class="co"># axis text size and bold</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>, face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span> <span class="co"># move caption to left</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1131-1.png" width="672"></div>
</div>
<div id="đổi-màu" class="section level3 unnumbered">
<h3>Đổi màu<a class="anchor" aria-label="anchor" href="#%C4%91%E1%BB%95i-m%C3%A0u"><i class="fas fa-link"></i></a>
</h3>
<div id="chỉ-định-bảng-màu" class="section level4 unnumbered">
<h4>Chỉ định bảng màu<a class="anchor" aria-label="anchor" href="#ch%E1%BB%89-%C4%91%E1%BB%8Bnh-b%E1%BA%A3ng-m%C3%A0u"><i class="fas fa-link"></i></a>
</h4>
<p>Cung cấp tên của bảng màu đã được định danh trước tới tham số <code>col_pal =</code> trong hàm <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>. Package <strong>incidence2</strong> đi kèm với 2 bảng màu được xác định trước: “vibrant” và “muted”. Trong “vibrant”, có 6 màu đầu tiên là riêng biệt và trong “muted” có 9 màu đầu tiên là khác biệt. Sau những con số này, các màu là sự thêm vào/trung gian của các màu khác. Bạn có thể tìm thấy những bảng màu được xác định trước này tại <a href="https://personal.sron.nl/~pault/#sec:qualitative">website này</a>. Các bảng màu loại trừ màu xám, do nó được dành riêng cho dữ liệu bị thiếu (sử dụng <code>na_color =</code> để thay đổi mặc định này).</p>
<div class="sourceCode" id="cb1531"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create incidence object, with data grouped by age category  </span>
<span class="va">age_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">linelist</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>,   <span class="co"># date of onset for x-axis</span>
  interval <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># weekly aggregation of cases</span>
  groups <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>

<span class="co"># plot the epicurve with default palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, title <span class="op">=</span> <span class="st">"'vibrant' default incidence2 palette"</span><span class="op">)</span>

<span class="co"># plot with different color palette</span>
<span class="co">#plot(age_outbreak, fill = age_cat, col_pal = muted, title = "'muted' incidence2 palette")</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1132-1.png" width="50%"></div>
<p>Bạn cũng có thể sử dụng một trong các bảng màu trong <strong>base</strong> R (đặt tên của bảng màu <em>không</em> có dấu ngoặc kép).</p>
<div class="sourceCode" id="cb1532"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot with base R palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, col_pal <span class="op">=</span> <span class="va">heat.colors</span>, title <span class="op">=</span> <span class="st">"base R heat.colors palette"</span><span class="op">)</span>

<span class="co"># plot with base R palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, col_pal <span class="op">=</span> <span class="va">rainbow</span>, title <span class="op">=</span> <span class="st">"base R rainbow palette"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1133-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1133-2.png" width="50%"></p>
<p>Bạn cũng có thể thêm bảng màu từ package <strong>viridis</strong> hoặc package <strong>RColorBrewer</strong>. Đầu tiên các package đó cần được tải, sau đó thêm các hàm <code>scale_fill_*()</code> tương ứng của chúng bằng dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, như bên dưới đây.</p>
<div class="sourceCode" id="cb1533"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">RColorBrewer</span>, <span class="va">viridis</span><span class="op">)</span>

<span class="co"># plot with color palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, title <span class="op">=</span> <span class="st">"Viridis palette"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>
    option <span class="op">=</span> <span class="st">"inferno"</span>,     <span class="co"># color scheme, try also "plasma" or the default</span>
    name <span class="op">=</span> <span class="st">"Age Category"</span>,  <span class="co"># legend name</span>
    na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>      <span class="co"># for missing values</span>

<span class="co"># plot with color palette</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, title <span class="op">=</span> <span class="st">"RColorBrewer palette"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>
    palette <span class="op">=</span> <span class="st">"Dark2"</span>,      <span class="co"># color palette, try also Accent, Dark2, Paired, Pastel1, Pastel2, Set1, Set2, Set3</span>
    name <span class="op">=</span> <span class="st">"Age Category"</span>,  <span class="co"># legend name</span>
    na.value <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>      <span class="co"># for missing values</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1134-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1134-2.png" width="50%"></p>
</div>
<div id="xác-định-thủ-công" class="section level4 unnumbered">
<h4>Xác định thủ công<a class="anchor" aria-label="anchor" href="#x%C3%A1c-%C4%91%E1%BB%8Bnh-th%E1%BB%A7-c%C3%B4ng"><i class="fas fa-link"></i></a>
</h4>
<p>Để chỉ định màu theo cách thủ công, hãy thêm hàm <code>scale_fill_manual()</code> trong <strong>ggplot2</strong> sau hàm <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> bằng dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> và cung cấp vectơ tên màu hoặc mã HEX tới đối số <code>values =</code>. Số lượng màu được liệt kê phải bằng số nhóm. Hãy lưu ý, các giá trị bị thiếu có phải là một nhóm hay không - chúng có thể được chuyển đổi thành giá trị dạng ký tự chẳng hạn như “Missing” trong quá trình chuẩn bị dữ liệu của bạn bằng hàm <code>fct_explicit_na()</code>, như đã được giải thích trong chương <a href="factors.html#factors">Factors</a>.</p>
<div class="sourceCode" id="cb1534"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># manual colors</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">age_outbreak</span>, fill <span class="op">=</span> <span class="va">age_cat</span>, title <span class="op">=</span> <span class="st">"Manually-specified colors"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"darkblue"</span>, <span class="st">"purple"</span>, <span class="st">"grey"</span>, <span class="st">"yellow"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>, <span class="st">"lightblue"</span><span class="op">)</span>,  <span class="co"># colors</span>
    name <span class="op">=</span> <span class="st">"Age Category"</span><span class="op">)</span>      <span class="co"># Name for legend</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1135-1.png" width="50%"></div>
<p>Như đã đề cập trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>, bạn có thể tạo bảng màu của riêng mình bằng cách sử dụng hàm <code><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette()</a></code> trên một vectơ chứa tên các màu sắc và chỉ định số màu bạn muốn trả về. Đây là một cách tốt để có thể thu được nhiều màu trong một lần bằng cách chỉ định một vài màu.</p>
<div class="sourceCode" id="cb1535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"darkblue"</span>, <span class="st">"purple"</span>, <span class="st">"grey"</span>, <span class="st">"yellow"</span>, <span class="st">"orange"</span><span class="op">)</span>
<span class="va">my_palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="va">my_cols</span><span class="op">)</span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>  <span class="co"># expand the 6 colors above to 12 colors</span>
<span class="va">my_palette</span></code></pre></div>
<pre><code>##  [1] "#006400" "#00363F" "#00097E" "#3A0BAF" "#821ADD" "#A84BE2" "#B592CB" "#C9C99B" "#E7E745" "#FFF600" "#FFCD00" "#FFA500"</code></pre>
</div>
</div>
<div id="điều-chỉnh-thứ-bậc" class="section level3 unnumbered">
<h3>Điều chỉnh thứ bậc<a class="anchor" aria-label="anchor" href="#%C4%91i%E1%BB%81u-ch%E1%BB%89nh-th%E1%BB%A9-b%E1%BA%ADc"><i class="fas fa-link"></i></a>
</h3>
<p>Để điều chỉnh thứ tự xuất hiện của nhóm (trên biểu đồ và trong chú giải), cột phân nhóm cần phải là kiểu Factor. Xem chương <a href="factors.html#factors">Factors</a> để biết thêm thông tin.</p>
<p>Đầu tiên, chúng ta hãy quan sát một đường cong dịch bệnh hàng tuần theo bệnh viện với thứ tự mặc định:</p>
<div class="sourceCode" id="cb1537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ORIGINAL - hospital NOT as factor</span>
<span class="co">###################################</span>

<span class="co"># create weekly incidence object, rows grouped by hospital and week</span>
<span class="va">hospital_outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">linelist</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>, 
  interval <span class="op">=</span> <span class="st">"week"</span>, 
  groups <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>

<span class="co"># plot incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hospital_outbreak</span>, fill <span class="op">=</span> <span class="va">hospital</span>, title <span class="op">=</span> <span class="st">"ORIGINAL - hospital not a factor"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1137-1.png" width="672"></div>
<p>Bây giờ, để điều chỉnh thứ tự sao cho nhóm phân loại “Missing” và “Other” ở trên cùng của đường cong dịch bệnh, chúng ta có thể làm như sau:</p>
<ul>
<li><p>Gọi package <strong>forcats</strong>, để làm việc với cột định dạng factor<br></p></li>
<li>
<p>Điều chỉnh bộ dữ liệu - trong trường hợp này, chúng tôi sẽ xác định một bộ dữ liệu mới (<code>plot_data</code>) trong đó:</p>
<ul>
<li>Cột <code>gender</code> được xác định là một biến phân loại có thứ bậc được thiết lập bằng hàm <code>fct_relevel()</code> sao cho “Other” và “Missing” đứng đầu tiên, do đó chúng xuất hiện ở trên đầu các cột<br>
</li>
</ul>
</li>
<li><p>Incidence object được tạo và vẽ biểu đồ như trước đó<br></p></li>
<li>
<p>Chúng ta thêm các điều chỉnh <strong>ggplot2</strong></p>
<ul>
<li>
<code>scale_fill_manual()</code> để gán màu theo cách thủ công sao cho “Missing” là màu xám và “Other” là màu be</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb1538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># MODIFIED - hospital as factor</span>
<span class="co">###############################</span>

<span class="co"># load forcats package for working with factors</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">forcats</span><span class="op">)</span>

<span class="co"># Convert hospital column to factor and adjust levels</span>
<span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">hospital</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Missing"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Set "Missing" and "Other" as top levels</span>


<span class="co"># Create weekly incidence object, grouped by hospital and week</span>
<span class="va">hospital_outbreak_mod</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">plot_data</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>, 
  interval <span class="op">=</span> <span class="st">"week"</span>, 
  groups <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>

<span class="co"># plot incidence object</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hospital_outbreak_mod</span>, fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># manual specify colors</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"beige"</span>, <span class="st">"darkgreen"</span>, <span class="st">"green2"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span>, <span class="st">"pink"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                      

  <span class="co"># labels added via ggplot</span>
  <span class="fu">labs</span><span class="op">(</span>
      title <span class="op">=</span> <span class="st">"MODIFIED - hospital as factor"</span>,   <span class="co"># plot title</span>
      subtitle <span class="op">=</span> <span class="st">"Other &amp; Missing at top of epicurve"</span>,
      y <span class="op">=</span> <span class="st">"Weekly case incidence"</span>,               <span class="co"># y axis title  </span>
      x <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,               <span class="co"># x axis title</span>
      fill <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span>                         <span class="co"># title of legend     </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1138-1.png" width="672"></div>
<p><span style="color: darkgreen;"><strong><em>MẸO</em></strong>: Nếu bạn chỉ muốn đảo ngược thứ tự của chú giải, hãy thêm lệnh <strong>ggplot2</strong> này <code>guides(fill = guide_legend(reverse = TRUE))</code>.</span></p>
</div>
<div id="đường-lưới-dọc" class="section level3 unnumbered">
<h3>Đường lưới dọc<a class="anchor" aria-label="anchor" href="#%C4%91%C6%B0%E1%BB%9Dng-l%C6%B0%E1%BB%9Bi-d%E1%BB%8Dc"><i class="fas fa-link"></i></a>
</h3>
<p>Nếu bạn vẽ biểu đồ với các thiết lập mặc định của <strong>incidence2</strong>, bạn có thể nhận thấy rằng các đường lưới dọc xuất hiện ở từng nhãn ngày và giữa mỗi nhãn ngày. Điều này có thể dẫn đến các đường lưới giao nhau với đỉnh của một số cột.</p>
<!--[Lưu ý đoạn này không áp dụng với phiên bản 1.0.0 của incidence2]. Bạn có thể chỉ định khoảng thời gian cho các đường lưới bằng cách thêm lệnh **ggplot2**'s `scale_x_date()` vào biểu đồ **incidence2**. Trong đó, chỉ định khoảng thời gian cho `date_breaks = ` và `date_minor_breaks = ` (ví dụ: "tuần" hoặc "3 tuần" hoặc "tháng"). Lưu ý rằng việc sử dụng `scale_x_date()` sẽ làm sai bất kỳ định dạng nào của nhãn ngày trong `plot()`, vì vậy bạn sẽ cần chỉ định bất kỳ định dạng chuỗi nào cho `date_labels = ` như bên dưới.-->
<p>Bạn có thể xóa tất cả các đường lưới bằng cách thêm lệnh <strong>ggplot2</strong> <code>theme_classic()</code>.</p>
<div class="sourceCode" id="cb1539"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make incidence object</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>
  <span class="va">central_data</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>,
  interval <span class="op">=</span> <span class="st">"Monday weeks"</span>
<span class="op">)</span>

<span class="co"># Default gridlines</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">a</span>, title <span class="op">=</span> <span class="st">"Default lines"</span><span class="op">)</span>

<span class="co"># Specified gridline intervals</span>
<span class="co"># NOT WORKING WITH INCIDENCE2 1.0.0</span>
<span class="co"># plot(a, title = "Weekly lines")+</span>
<span class="co">#   scale_x_date(</span>
<span class="co">#     date_breaks = "4 weeks",      # major vertical lines align on weeks</span>
<span class="co">#     date_minor_breaks = "weeks",  # minor vertical lines every week</span>
<span class="co">#     date_labels = "%a\n%d\n%b")   # format of date labels</span>

<span class="co"># No gridlines</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">a</span>, title <span class="op">=</span> <span class="st">"No lines"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span>                 <span class="co"># remove all gridlines</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1139-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1139-2.png" width="50%"></p>
<p>Tuy nhiên, lưu ý rằng nếu sử dụng tuần, các đối số <code>date_breaks</code> và <code>date_minor_breaks</code> chỉ hoạt động cho các tuần được quy định bắt đầu vào <em>Thứ Hai</em>. Nếu các tuần của bạn bắt đầu vào một ngày khác trong tuần, thay vào đó, bạn sẽ cần cung cấp vectơ ngày cho các đối số <code>breaks =</code> và <code>minor_breaks =</code> theo cách thủ công. Xem mục <strong>ggplot2</strong> để biết các ví dụ về điều này bằng cách sử dụng hàm <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code>.</p>
</div>
<div id="số-mới-mắc-tích-lũy" class="section level3 unnumbered">
<h3>Số mới mắc tích lũy<a class="anchor" aria-label="anchor" href="#s%E1%BB%91-m%E1%BB%9Bi-m%E1%BA%AFc-t%C3%ADch-l%C5%A9y"><i class="fas fa-link"></i></a>
</h3>
<!-- Bạn có thể dễ dàng tạo ra một biểu đồ số mới mắc tích lũy bằng cách chuyển incidence object đến lệnh **incidence2** `cumulate()` và sau đó đến lệnh `plot()`. Điều này cũng tương tự với lệnh `facet_plot()`. -->
<!-- ```{r} -->
<!-- # make weekly incidence object -->
<!-- wkly_inci <- incidence( -->
<!--   linelist, -->
<!--   date_index = date_onset, -->
<!--   interval = "week" -->
<!-- ) -->
<!-- # plot cumulative incidence -->
<!-- wkly_inci %>%  -->
<!--   cumulate() %>%  -->
<!--   plot() -->
<!-- ``` -->
<p>Xem phần sau để biết phương pháp thay thế để vẽ biểu đồ số mới mắc tích lũy với <strong>ggplot2</strong> - ví dụ: để chồng một đường số mới mắc tích lũy lên trên đường cong dịch bệnh.</p>
</div>
<div id="trung-bình-động" class="section level3 unnumbered">
<h3>Trung bình động<a class="anchor" aria-label="anchor" href="#trung-b%C3%ACnh-%C4%91%E1%BB%99ng"><i class="fas fa-link"></i></a>
</h3>
<p>Bạn có thể thêm đường trung bình động vào biểu đồ tạo bởi <strong>incidence2</strong> một cách dễ dàng với hàm <code>add_rolling_average()</code> từ package <strong>i2extras</strong>. Chuyển đối tượng incidence2 của bạn tới hàm này, và sau đó vẽ bằng hàm <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>. Thiết lập <code>before =</code> là số ngày trước đó bạn muốn đưa vào đường trung bình động (mặc định là 2). Nếu dữ liệu của bạn được nhóm lại, trung bình động sẽ được tính cho mỗi nhóm.</p>
<div class="sourceCode" id="cb1540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rolling_avg</span> <span class="op">&lt;-</span> <span class="fu">incidence</span><span class="op">(</span>                    <span class="co"># make incidence object</span>
  <span class="va">linelist</span>,
  date_index <span class="op">=</span> <span class="va">date_onset</span>,
  interval <span class="op">=</span> <span class="st">"week"</span>,
  groups <span class="op">=</span> <span class="va">gender</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="fu">i2extras</span><span class="fu">::</span><span class="fu"><a href="https://www.reconverse.org/i2extras/reference/add_rolling_average.html">add_rolling_average</a></span><span class="op">(</span>before <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>  <span class="co"># add rolling averages (in this case, by gender)</span>

<span class="co"># plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rolling_avg</span>, n.breaks <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># faceted automatically because rolling average on groups</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1140-1.png" width="672"></div>
<p>Để tìm hiểu cách áp dụng đường trung bình động một cách tổng quát hơn trên dữ liệu, hãy xem chương <a href="moving-average.html#moving-average">Đường trung bình động</a>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="đường-cong-dịch-bệnh-với-ggplot2" class="section level2" number="32.3">
<h2>
<span class="header-section-number">32.3</span> Đường cong dịch bệnh với ggplot2<a class="anchor" aria-label="anchor" href="#%C4%91%C6%B0%E1%BB%9Dng-cong-d%E1%BB%8Bch-b%E1%BB%87nh-v%E1%BB%9Bi-ggplot2"><i class="fas fa-link"></i></a>
</h2>
<p>Sử dụng <code>ggplot()</code> để xây dựng đường cong dịch bệnh cho phép sự linh hoạt và tùy chỉnh nhiều hơn, nhưng đòi hỏi nhiều nỗ lực và hiểu biết hơn về sử dụng <code>ggplot()</code>.</p>
<p>Không giống như sử dụng package <strong>incidence2</strong>, bạn phải kiểm soát <em>thủ công</em> việc tổng hợp các trường hợp theo thời gian (theo tuần, tháng, v.v.) <em>và</em> khoảng thời gian của các nhãn trên trục ngày thág. Việc này phải được quản lý rất cẩn thận.</p>
<p>Các ví dụ này sử dụng một tập con của bộ dữ liệu <code>linelist</code> - chỉ các trường hợp từ Central Hospital.</p>
<div class="sourceCode" id="cb1541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">central_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span></code></pre></div>
<p>Để tạo ra một đường cong dịch bệnh với <code>ggplot()</code>, có ba yếu tố chính:</p>
<ul>
<li>Một histogram, với các ca bệnh <code>linelist</code> được tổng hợp thành các “bins” được phân biệt bằng các điểm “ngắt” cụ thể<br>
</li>
<li>Cân chỉnh các trục và nhãn<br>
</li>
<li>Chủ đề của biểu đồ, bao gồm tiêu đề, nhãn, chú thích, v.v.</li>
</ul>
<div id="xác-định-bins-của-số-liệu" class="section level3 unnumbered">
<h3>Xác định bins của số liệu<a class="anchor" aria-label="anchor" href="#x%C3%A1c-%C4%91%E1%BB%8Bnh-bins-c%E1%BB%A7a-s%E1%BB%91-li%E1%BB%87u"><i class="fas fa-link"></i></a>
</h3>
<p>Ở đây chúng ta trình bày cách xác định các ca bệnh sẽ được tổng hợp thành các bins của một histogram (“cột”). Điều quan trọng cần nhận ra là việc tổng hợp số ca bệnh thành các bins của một histogram không nhất thiết phải có cùng khoảng với thời gian xuất hiện trên trục x.</p>
<p>Dưới đây có lẽ là đoạn code đơn giản nhất để tạo ra các đường cong dịch bệnh hàng ngày và hàng tuần.</p>
<p>Trong lệnh <code>ggplot()</code> tổng quát, bộ dữ liệu được đưa vào <code>data =</code>. Trên nền tảng này, dạng hình học của histogram được thêm bằng một dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>. Trong <code>geom_histogram()</code>, chúng ta ánh xạ các yếu tố thẩm mỹ sao cho cột <code>date_onset</code> được ánh xạ tới trục x. Cũng trong hàm <code>geom_histogram()</code> nhưng <em>không</em> phải trong đối số <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, chúng ta đặt <code>binwidth =</code> bằng số bins của histogram, tính bằng ngày. Nếu cú pháp <strong>ggplot2</strong> này khó hiểu, hãy xem lại chương <a href="ggplot-basics.html#ggplot-basics">ggplot cơ bản</a>.</p>
<p><span style="color: orange;"><strong><em>THẬN TRỌNG</em></strong>: Lập biểu đồ các trường hợp hàng tuần bằng cách sử dụng <code>binwidth = 7</code> bắt đầu cột 7 ngày đầu tiên ở ca bệnh đầu tiên, mà có thể là bất kỳ ngày nào trong tuần! Để tạo các tuần cụ thể, hãy xem phần bên dưới.</span></p>
<div class="sourceCode" id="cb1542"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># daily </span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>          <span class="co"># set data</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>                      <span class="co"># add histogram</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,     <span class="co"># map date column to x-axis</span>
    binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>                     <span class="co"># cases binned by 1 day </span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Central Hospital - Daily"</span><span class="op">)</span>                <span class="co"># title</span>

<span class="co"># weekly</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>          <span class="co"># set data </span>
  <span class="fu">geom_histogram</span><span class="op">(</span>                      <span class="co"># add histogram</span>
      mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,   <span class="co"># map date column to x-axis</span>
      binwidth <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># cases binned every 7 days, starting from first case (!) </span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Central Hospital - 7-day bins, starting at first case"</span><span class="op">)</span> <span class="co"># title</span></code></pre></div>
<p><img src="_main_files/figure-html/ggplot_simple-1.png" width="50%"><img src="_main_files/figure-html/ggplot_simple-2.png" width="50%"></p>
<p>Chúng tôi xin lưu ý rằng ca bệnh đầu tiên trong bộ dữ liệu của Central Hospital có triệu chứng khởi phát vào ngày:</p>
<div class="sourceCode" id="cb1543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"%A %d %b, %Y"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Thursday 01 May, 2014"</code></pre>
<p><strong>Để chỉ định thủ công chia biểu đồ cột, <em>không</em> sử dụng argument <code>binwidth =</code> và thay vào đó cung cấp vectơ ngày để <code>breaks =</code>.</strong></p>
<p>Tạo vectơ ngày tháng với hàm <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> trong <strong>base</strong> R. Hàm này sử dụng các đối số <code>to =</code>, <code>from =</code>, và <code>by =</code>. Ví dụ: lệnh bên dưới trả về ngày mỗi tháng bắt đầu từ ngày 15 Tháng 1 và kết thúc trước ngày 28 Tháng 6.</p>
<div class="sourceCode" id="cb1545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">monthly_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-02-01"</span><span class="op">)</span>,
                           to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-07-15"</span><span class="op">)</span>,
                           by <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span>

<span class="va">monthly_breaks</span>   <span class="co"># print</span></code></pre></div>
<pre><code>##  [1] "2014-02-01" "2014-03-01" "2014-04-01" "2014-05-01" "2014-06-01" "2014-07-01" "2014-08-01" "2014-09-01" "2014-10-01" "2014-11-01" "2014-12-01"
## [12] "2015-01-01" "2015-02-01" "2015-03-01" "2015-04-01" "2015-05-01" "2015-06-01" "2015-07-01"</code></pre>
<p>Vectơ này có được cung cấp cho hàm <code>geom_histogram()</code> dưới dạng <code>breaks =</code>:</p>
<div class="sourceCode" id="cb1547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># monthly </span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    breaks <span class="op">=</span> <span class="va">monthly_breaks</span><span class="op">)</span><span class="op">+</span>         <span class="co"># provide the pre-defined vector of breaks                    </span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Monthly case bins"</span><span class="op">)</span>   <span class="co"># title</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1146-1.png" width="672"></div>
<p>Một chuỗi ngày hàng tuần đơn giản có thể được trả về bằng cách đặt <code>by = "week"</code>. Ví dụ:</p>
<div class="sourceCode" id="cb1548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">weekly_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-02-01"</span><span class="op">)</span>,
                          to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-07-15"</span><span class="op">)</span>,
                          by <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></code></pre></div>
<p>Một giải pháp thay thế cho việc xác định ngày bắt đầu và ngày kết thúc cụ thể là viết code <em>động</em> để các cột hàng tuần bắt đầu vào <em>thứ Hai trước ca đầu tiên</em>. <strong>Chúng tôi sẽ sử dụng các vectơ ngày này trong suốt các ví dụ dưới đây</strong>.</p>
<div class="sourceCode" id="cb1549"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sequence of weekly Monday dates for CENTRAL HOSPITAL</span>
<span class="va">weekly_breaks_central</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
  from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># monday before first case</span>
  to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># monday after last case</span>
  by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></code></pre></div>
<p>Hãy giải mã đoạn code khá “khoai” ở trên:</p>
<ul>
<li>Giá trị “from” (ngày sớm nhất của chuỗi) được tạo như sau: giá trị ngày nhỏ nhất (<code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code> với <code>na.rm=TRUE</code>) trong cột <code>date_onset</code> được đưa vào hàm <code>floor_date()</code> thuộc package <strong>lubridate</strong>. <code>floor_date()</code> được đặt thành “tuần” trả về ngày bắt đầu của “tuần” của trường hợp đó, với điều kiện là ngày bắt đầu của mỗi tuần là Thứ Hai (<code>week_start = 1</code>).<br>
</li>
<li>Tương tự như vậy, giá trị “to” (ngày kết thúc của chuỗi) được tạo bằng cách sử dụng hàm ngược lại <code>ceiling_date()</code> để trả về thứ hai <em>sau</em> ca cuối cùng.<br>
</li>
<li>Đối số “by” của <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> có thể được đặt thành bất kỳ số ngày, tuần hoặc tháng nào.<br>
</li>
<li>Sử dụng <code>week_start = 7</code> cho tuần bắt đầu vào Chủ nhật</li>
</ul>
<p>Vì chúng ta sẽ sử dụng các vectơ ngày dạng này trong toàn bộ chương này, chúng ta cũng xác định một vectơ cho toàn bộ đợt bùng phát (ở trên chỉ dành cho Central Hospital).</p>
<div class="sourceCode" id="cb1550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sequence for the entire outbreak</span>
<span class="va">weekly_breaks_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
  from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># monday before first case</span>
  to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># monday after last case</span>
  by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></code></pre></div>
<p>Các kết quả trả về của <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> có thể được sử dụng để tạo các khoảng chia bins trong histogram, cũng như khoảng chia cho các nhãn ngày mà có thể độc lập với các bins. Đọc thêm về nhãn ngày trong các phần sau.</p>
<p><span style="color: darkgreen;"><strong><em>MẸO</em></strong>: Đối với lệnh <code>ggplot()</code> đơn giản hơn, hãy lưu các khoảng chia bins và khoảng chia nhãn ngày dưới dạng các vectơ đã đặt tên trước và gán tên này vào đối số <code>breaks =</code>.</span></p>
</div>
<div id="ví-dụ-về-đường-cong-dịch-bệnh-theo-tuần" class="section level3 unnumbered">
<h3>Ví dụ về đường cong dịch bệnh theo tuần<a class="anchor" aria-label="anchor" href="#v%C3%AD-d%E1%BB%A5-v%E1%BB%81-%C4%91%C6%B0%E1%BB%9Dng-cong-d%E1%BB%8Bch-b%E1%BB%87nh-theo-tu%E1%BA%A7n"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Dưới đây là code ví dụ chi tiết để tạo đường cong dịch bệnh hàng tuần cho các tuần bắt đầu vào Thứ Hai, với các cột, nhãn ngày và đường lưới dọc đã được căn chỉnh</strong>. Phần này dành cho người dùng có nhu cầu code nhanh. Để hiểu sâu từng khía cạnh (chủ đề, nhãn ngày, v.v.), hãy tiếp tục xem các phần tiếp theo. Chú ý:</p>
<ul>
<li>Các <em>đoạn chia bins của histogram</em> được xác định bằng hàm <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code> như được giải thích ở trên để bắt đầu vào thứ Hai trước ca sớm nhất và kết thúc vào thứ Hai sau ca cuối cùng<br>
</li>
<li>Khoảng <em>nhãn ngày</em> được xác định bởi <code>date_breaks =</code> bên trong <code>scale_x_date()</code><br>
</li>
<li>Khoảng đường lưới dọc nhỏ giữa các nhãn ngày được xác định bởi <code>date_minor_breaks =</code><br>
</li>
<li>
<code>expand = c(0,0)</code> trong trục x và y loại bỏ không gian thừa trên mỗi cạnh của trục, điều này cũng đảm bảo các nhãn ngày bắt đầu từ cột đầu tiên.</li>
</ul>
<div class="sourceCode" id="cb1551"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># TOTAL MONDAY WEEK ALIGNMENT</span>
<span class="co">#############################</span>
<span class="co"># Define sequence of weekly breaks</span>
<span class="va">weekly_breaks_central</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># Monday before first case</span>
      to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co"># Monday after last case</span>
      by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>    <span class="co"># bins are 7-days </span>


<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># make histogram: specify bin break points: starts the Monday before first case, end Monday after last case</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    
    <span class="co"># mapping aesthetics</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,  <span class="co"># date column mapped to x-axis</span>
    
    <span class="co"># histogram bin breaks</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>, <span class="co"># histogram bin breaks defined previously</span>
    
    <span class="co"># bars</span>
    color <span class="op">=</span> <span class="st">"darkblue"</span>,     <span class="co"># color of lines around bars</span>
    fill <span class="op">=</span> <span class="st">"lightblue"</span>      <span class="co"># color of fill within bars</span>
  <span class="op">)</span><span class="op">+</span> 
    
  <span class="co"># x-axis labels</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,           <span class="co"># remove excess x-axis space before and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"4 weeks"</span>,        <span class="co"># date labels and major vertical gridlines appear every 3 Monday weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,           <span class="co"># minor vertical lines appear every Monday week</span>
    date_labels       <span class="op">=</span> <span class="st">"%a\n%d %b\n%Y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>             <span class="co"># remove excess y-axis space below 0 (align histogram flush with x-axis)</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                <span class="co"># simplify plot background</span>
  
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>,        <span class="co"># caption on left side</span>
                                face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>, <span class="co"># caption in italics</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>    <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels including dynamic caption</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases (Monday weeks)"</span>,
    subtitle <span class="op">=</span> <span class="st">"Note alignment of bars, vertical gridlines, and axis labels on Monday weeks"</span>,
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1150-1.png" width="672"></div>
<div id="tuần-bắt-đầu-bằng-chủ-nhật" class="section level4 unnumbered">
<h4>Tuần bắt đầu bằng Chủ nhật<a class="anchor" aria-label="anchor" href="#tu%E1%BA%A7n-b%E1%BA%AFt-%C4%91%E1%BA%A7u-b%E1%BA%B1ng-ch%E1%BB%A7-nh%E1%BA%ADt"><i class="fas fa-link"></i></a>
</h4>
<p>Để vẽ được biểu đồ cho các tuần bắt đầu bằng Chủ nhật, cần có một số sửa đổi, vì <code>date_breaks = "weeks"</code> chỉ hoạt động cho các tuần bắt đầu bằng thứ Hai.</p>
<ul>
<li>Các điểm ngắt của các <em>histogram bins</em> phải được đặt thành Chủ nhật (<code>week_start = 7</code>)<br>
</li>
<li>Trong <code>scale_x_date()</code>, các đoạn ngắt ngày tương tự nên được gắn với <code>breaks =</code> và <code>minor_breaks =</code> để đảm bảo các nhãn ngày và đường lưới dọc căn chỉnh vào ngày Chủ nhật.</li>
</ul>
<p>Ví dụ: lệnh <code>scale_x_date()</code> cho các tuần bắt đầu vào Chủ nhật có thể trông như sau:</p>
<div class="sourceCode" id="cb1552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1552-1"><a href="epicurves.html#cb1552-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_date</span>(</span>
<span id="cb1552-2"><a href="epicurves.html#cb1552-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb1552-3"><a href="epicurves.html#cb1552-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1552-4"><a href="epicurves.html#cb1552-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># specify interval of date labels and major vertical gridlines</span></span>
<span id="cb1552-5"><a href="epicurves.html#cb1552-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb1552-6"><a href="epicurves.html#cb1552-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T),   <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">7</span>), <span class="co"># Sunday before first case</span></span>
<span id="cb1552-7"><a href="epicurves.html#cb1552-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">to   =</span> <span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">7</span>), <span class="co"># Sunday after last case</span></span>
<span id="cb1552-8"><a href="epicurves.html#cb1552-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">by   =</span> <span class="st">"4 weeks"</span>),</span>
<span id="cb1552-9"><a href="epicurves.html#cb1552-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1552-10"><a href="epicurves.html#cb1552-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># specify interval of minor vertical gridline </span></span>
<span id="cb1552-11"><a href="epicurves.html#cb1552-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">minor_breaks =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb1552-12"><a href="epicurves.html#cb1552-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T),   <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">7</span>), <span class="co"># Sunday before first case</span></span>
<span id="cb1552-13"><a href="epicurves.html#cb1552-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">to   =</span> <span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">7</span>), <span class="co"># Sunday after last case</span></span>
<span id="cb1552-14"><a href="epicurves.html#cb1552-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">by   =</span> <span class="st">"week"</span>),</span>
<span id="cb1552-15"><a href="epicurves.html#cb1552-15" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb1552-16"><a href="epicurves.html#cb1552-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># date label format</span></span>
<span id="cb1552-17"><a href="epicurves.html#cb1552-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%a</span><span class="sc">\n</span><span class="st">%d %b</span><span class="sc">\n</span><span class="st">%Y"</span>)<span class="sc">+</span>         <span class="co"># day, above month abbrev., above 2-digit year</span></span></code></pre></div>
</div>
</div>
<div id="nhómtô-màu-theo-giá-trị" class="section level3 unnumbered">
<h3>Nhóm/tô màu theo giá trị<a class="anchor" aria-label="anchor" href="#nh%C3%B3mt%C3%B4-m%C3%A0u-theo-gi%C3%A1-tr%E1%BB%8B"><i class="fas fa-link"></i></a>
</h3>
<p>Các cột histogram có thể được tô màu theo nhóm và “xếp chồng lên nhau”. Để chỉ định cột nhóm, hãy thực hiện các thay đổi sau. Xem chương <a href="ggplot-basics.html#ggplot-basics">ggplot cơ bản</a> để biết thêm chi tiết.</p>
<ul>
<li>Bên trong đối số <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> của hàm vẽ histogram, ánh xạ tên cột tới đối số <code>group =</code> và <code>fill =</code><br>
</li>
<li>Loại bỏ bất kỳ tham số <code>fill =</code> nào bên ngoài đối số <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, vì nó sẽ ghi đè giá trị bên trong<br>
</li>
<li>Đối số <em>bên trong</em> <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> sẽ áp dụng <em>theo nhóm</em>, trong khi bất kỳ đối số <em>bên ngoài</em> nào đều sẽ áp dụng cho tất cả các cột (ví dụ: bạn có thể vẫn muốn tô màu <code>color =</code> bên ngoài, vì vậy mỗi cột có cùng một đường viền)</li>
</ul>
<p>Đây là lệnh <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> hiển thị nhóm và tô màu các cột theo giới tính:</p>
<div class="sourceCode" id="cb1553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, group <span class="op">=</span> <span class="va">gender</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span></code></pre></div>
<p>Đây là kết quả khi áp dụng:</p>
<div class="sourceCode" id="cb1554"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span> <span class="op">+</span>     <span class="co"># begin with linelist (many hospitals)</span>
  
  <span class="co"># make histogram: specify bin break points: starts the Monday before first case, end Monday after last case</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">date_onset</span>,
      group <span class="op">=</span> <span class="va">hospital</span>,       <span class="co"># set data to be grouped by hospital</span>
      fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,       <span class="co"># bar fill (inside color) by hospital</span>
    
    <span class="co"># bin breaks are Monday weeks</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span>,   <span class="co"># sequence of weekly Monday bin breaks for whole outbreak, defined in previous code       </span>
    
    <span class="co"># Color around bars</span>
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1153-1.png" width="672"></div>
</div>
<div id="hiệu-chỉnh-màu" class="section level3 unnumbered">
<h3>Hiệu chỉnh màu<a class="anchor" aria-label="anchor" href="#hi%E1%BB%87u-ch%E1%BB%89nh-m%C3%A0u"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>
<p>Để thiết lập <em>thủ công</em> tô màu cho từng nhóm, hãy sử dụng <code>scale_fill_manual()</code> (lưu ý: <code>scale_color_manual()</code> là một cái khác!)</p>
<ul>
<li>Sử dụng đối số <code>values =</code> để áp dụng một vectơ màu<br>
</li>
<li>Sử dụng <code>na.value =</code> để xác định màu cho giá trị <code>NA</code><br>
</li>
<li>Sử dụng đối số <code>labels =</code> để thay đổi văn bản trong mục chú thích. Để cho an toàn, sử dụng một vectơ được đặt tên kiểu như <code><a href="https://rdrr.io/r/base/c.html">c("old" = "new", "old" = "new")</a></code> hoặc điều chỉnh giá trị trong bộ dữ liệu<br>
</li>
<li>Sử dụng <code>name =</code> để đặt một tiêu đề thích hợp cho mục chú thích<br>
</li>
</ul>
</li>
<li><p>Để biết thêm mẹo về thang màu và bảng màu, hãy xem chương <a href="ggplot-basics.html#ggplot-basics">ggplot cơ bản</a>.</p></li>
</ul>
<div class="sourceCode" id="cb1555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>           <span class="co"># begin with linelist (many hospitals)</span>
  
  <span class="co"># make histogram</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>,
        group <span class="op">=</span> <span class="va">hospital</span>,          <span class="co"># cases grouped by hospital</span>
        fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,          <span class="co"># bar fill by hospital</span>
    
    <span class="co"># bin breaks</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span>,        <span class="co"># sequence of weekly Monday bin breaks, defined in previous code</span>
    
    <span class="co"># Color around bars</span>
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>              <span class="co"># border color of each bar</span>
  
  <span class="co"># manual specification of colors</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"orange"</span>, <span class="st">"grey"</span>, <span class="st">"beige"</span>, <span class="st">"blue"</span>, <span class="st">"brown"</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's"</span><span class="op">)</span>,
    name <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span> <span class="co"># specify fill colors ("values") - attention to order!</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1154-1.png" width="672"></div>
</div>
<div id="hiệu-chỉnh-thứ-bậc" class="section level3 unnumbered">
<h3>Hiệu chỉnh thứ bậc<a class="anchor" aria-label="anchor" href="#hi%E1%BB%87u-ch%E1%BB%89nh-th%E1%BB%A9-b%E1%BA%ADc"><i class="fas fa-link"></i></a>
</h3>
<p>Thứ tự mà các cột được nhóm xếp chồng lên nhau được điều chỉnh tốt nhất bằng cách phân loại cột nhóm dưới dạng Factor. Sau đó, bạn có thể chỉ định thứ tự cấp độ phân loại (và nhãn hiển thị của chúng). Xem chương về <a href="factors.html#factors">Factors</a> hoặc <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a> để biết thêm chi tiết.</p>
<p>Trước khi tạo biểu đồ, hãy sử dụng hàm <code>fct_relevel()</code> từ package <strong>forcats</strong> để chuyển đổi cột phân nhóm thành kiểu Factor và điều chỉnh thứ tự cấp độ theo cách thủ công, như được trình bày chi tiết trong chương về <a href="factors.html#factors">Factors</a>.</p>
<div class="sourceCode" id="cb1556"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load forcats package for working with factors</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">forcats</span><span class="op">)</span>

<span class="co"># Define new dataset with hospital as factor</span>
<span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">hospital</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Missing"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Convert to factor and set "Missing" and "Other" as top levels to appear on epicurve top</span>

<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span> <span class="co"># print levels in order</span></code></pre></div>
<pre><code>## [1] "Missing"                              "Other"                                "Central Hospital"                    
## [4] "Military Hospital"                    "Port Hospital"                        "St. Mark's Maternity Hospital (SMMH)"</code></pre>
<p>Trong biểu đồ dưới đây, điểm khác biệt duy nhất so với trước đó là cột <code>hospital</code> đã được hợp nhất như trên và chúng ta sử dụng các <code>guides()</code> để đảo ngược thứ tự chú thích, do đó “nhãn Missing” nằm ở cuối chú thích.</p>
<div class="sourceCode" id="cb1558"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span> <span class="op">+</span>                     <span class="co"># Use NEW dataset with hospital as re-ordered factor</span>
  
  <span class="co"># make histogram</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>,
        group <span class="op">=</span> <span class="va">hospital</span>,               <span class="co"># cases grouped by hospital</span>
        fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,               <span class="co"># bar fill (color) by hospital</span>
    
    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span>,         <span class="co"># sequence of weekly Monday bin breaks for whole outbreak, defined at top of ggplot section</span>
    
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># border color around each bar</span>
    
  <span class="co"># x-axis labels</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space before and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># labels appear every 3 Monday weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># vertical lines appear every Monday week</span>
    date_labels       <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># remove excess y-axis space below 0</span>
  
  <span class="co"># manual specification of colors, ! attention to order</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"beige"</span>, <span class="st">"black"</span>, <span class="st">"orange"</span>, <span class="st">"blue"</span>, <span class="st">"brown"</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"St. Mark's Maternity Hospital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's"</span><span class="op">)</span>,
    name <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span><span class="op">+</span> 
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                      <span class="co"># simplify plot background</span>
  
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, <span class="co"># caption on left side in italics</span>
                                hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, 
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases by hospital"</span>,
    subtitle <span class="op">=</span> <span class="st">"Hospital as re-ordered factor"</span>,
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly cases"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1156-1.png" width="672"></div>
<p><span style="color: darkgreen;"><strong><em>MẸO</em></strong>: Để chỉ đảo ngược thứ tự của chú thích, hãy thêm lệnh <strong>ggplot2</strong> này: <code>guides(fill = guide_legend(reverse = TRUE))</code>.</span></p>
</div>
<div id="hiệu-chỉnh-chú-thích" class="section level3 unnumbered">
<h3>Hiệu chỉnh chú thích<a class="anchor" aria-label="anchor" href="#hi%E1%BB%87u-ch%E1%BB%89nh-ch%C3%BA-th%C3%ADch"><i class="fas fa-link"></i></a>
</h3>
<p>Đọc thêm về chú thích và scale trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>. Dưới đây là một vài điểm nổi bật:</p>
<ul>
<li><p>Chỉnh sửa tiêu đề chú thích trong hàm scale hoặc với <code>labs(fill = "Legend title")</code> (nếu bạn đang sử dụng <code>color =</code>, thì hãy sử dụng <code>labs(color = "")</code>)<br></p></li>
<li><p><code>theme(legend.title = element_blank())</code> để bỏ trống tiêu đề chú thích<br></p></li>
<li><p><code>theme(legend.position = "top")</code> (“bottom”, “left”, “right”, hoặc “none” để bỏ chú thích)</p></li>
<li><p><code>theme(legend.direction = "horizontal")</code> xoay ngang chú thích</p></li>
<li><p><code>guides(fill = guide_legend(reverse = TRUE))</code> để đảo ngược thứ tự các mục chú thích</p></li>
</ul>
</div>
<div id="cột-kề-cột" class="section level3 unnumbered">
<h3>Cột kề cột<a class="anchor" aria-label="anchor" href="#c%E1%BB%99t-k%E1%BB%81-c%E1%BB%99t"><i class="fas fa-link"></i></a>
</h3>
<p>Hiển thị song song các cột nhóm (trái ngược với xếp chồng lên nhau) được chỉ định trong <code>geom_histogram()</code> với <code>position = "dodge"</code> được đặt bên ngoài <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>.</p>
<p>Nếu có nhiều hơn hai nhóm giá trị, nó có thể gây khó đọc. Thay vào đó, hãy cân nhắc sử dụng một biểu đồ được chia nhỏ (gồm nhiều biểu đồ nhỏ). Để dễ xem trong ví dụ này, các giá trị giới tính bị thiếu sẽ bị xóa.</p>
<div class="sourceCode" id="cb1559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># begin with Central Hospital cases dropping missing gender</span>
    <span class="fu">geom_histogram</span><span class="op">(</span>
        mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">date_onset</span>,
          group <span class="op">=</span> <span class="va">gender</span>,         <span class="co"># cases grouped by gender</span>
          fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>,         <span class="co"># bars filled by gender</span>
        
        <span class="co"># histogram bin breaks</span>
        breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,   <span class="co"># sequence of weekly dates for Central outbreak - defined at top of ggplot section</span>
        
        color <span class="op">=</span> <span class="st">"black"</span>,          <span class="co"># bar edge color</span>
        
        position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># SIDE-BY-SIDE bars</span>
                      
  
  <span class="co"># The labels on the x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
               date_breaks       <span class="op">=</span> <span class="st">"3 weeks"</span>,      <span class="co"># labels appear every 3 Monday weeks</span>
               date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,         <span class="co"># vertical lines appear every Monday week</span>
               date_labels       <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span> <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>             <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co">#scale of colors and legend labels</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"brown"</span>, <span class="st">"orange"</span><span class="op">)</span>,  <span class="co"># specify fill colors ("values") - attention to order!</span>
                    na.value <span class="op">=</span> <span class="st">"grey"</span> <span class="op">)</span><span class="op">+</span>     

  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                               <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
        axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>               <span class="co"># axis titles in bold</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by gender"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
       fill     <span class="op">=</span> <span class="st">"Gender"</span>,                                      <span class="co"># provide new title for legend</span>
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1157-1.png" width="672"></div>
</div>
<div id="giới-hạn-trục" class="section level3 unnumbered">
<h3>Giới hạn trục<a class="anchor" aria-label="anchor" href="#gi%E1%BB%9Bi-h%E1%BA%A1n-tr%E1%BB%A5c"><i class="fas fa-link"></i></a>
</h3>
<p>Có hai cách để giới hạn phạm vi các giá trị trên trục.</p>
<p>Nói chung, cách khuyến khích sử dụng là lệnh <code>coord_cartesian()</code>, chấp nhận <code>xlim = c(min, max)</code> và <code>ylim = c(min, max)</code> (trong đó bạn cung cấp giá trị nhỏ nhất và lớn nhất). Cách này hoạt động như một “thu phóng kích thước” mà không thực sự loại bỏ bất kỳ dữ liệu nào, điều này rất quan trọng đối với các số liệu thống kê và các thang đo tổng hợp.</p>
<p>Ngoài ra, bạn có thể thiết lập giá trị ngày tối đa và tối thiểu bằng cách sử dụng <code>limits = c()</code> bên trong hàm <code>scale_x_date()</code>. Ví dụ:</p>
<div class="sourceCode" id="cb1560"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">scale_x_date</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-04-01"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="co"># sets a minimum date but leaves the maximum open.  </span></code></pre></div>
<p>Tương tự như vậy, nếu bạn muốn trục x kéo dài đến một ngày cụ thể (ví dụ: ngày hiện tại), ngay cả khi không có trường hợp mới nào được báo cáo, bạn có thể sử dụng:</p>
<div class="sourceCode" id="cb1561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1561-1"><a href="epicurves.html#cb1561-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_date</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">Sys.Date</span>()) <span class="co"># ensures date axis will extend until current date  </span></span></code></pre></div>
<p><span style="color: red;"><strong><em>LƯU Ý</em></strong>: Hãy thận trọng khi đặt giới hạn hoặc chia tỷ lệ trục y (ví dụ: 0 đến 30 với khoảng là 5: <code><a href="https://rdrr.io/r/base/seq.html">seq(0, 30, 5)</a></code>). Những con số tĩnh như vậy có thể cắt bớt biểu đồ quá ngắn nếu dữ liệu thay đổi vượt quá giới hạn!.</span></p>
</div>
<div id="nhãnđường-lưới-của-trục-ngày" class="section level3 unnumbered">
<h3>Nhãn/đường lưới của trục ngày<a class="anchor" aria-label="anchor" href="#nh%C3%A3n%C4%91%C6%B0%E1%BB%9Dng-l%C6%B0%E1%BB%9Bi-c%E1%BB%A7a-tr%E1%BB%A5c-ng%C3%A0y"><i class="fas fa-link"></i></a>
</h3>
<p><span style="color: darkgreen;"><strong><em>MẸO</em></strong>: Hãy nhớ rằng các <strong>nhãn</strong> trục ngày độc lập với việc tổng hợp dữ liệu thành các cột, nhưng về mặt trực quan, điều quan trọng là phải căn chỉnh các cột, nhãn ngày và các đường lưới dọc.</span></p>
<p>Để <strong>sửa đổi nhãn ngày và đường lưới</strong>, hãy sử dụng <code>scale_x_date()</code> theo một trong những cách sau:</p>
<ul>
<li>
<p><strong>Nếu histogram bins là ngày, tuần bắt đầu vào thứ hai, tháng hoặc năm:</strong></p>
<ul>
<li>Sử dụng <code>date_breaks =</code> để xác định khoảng thời gian của các nhãn và đường lưới chính (ví dụ: “day”, “week”, “3 weeks”, “month” hoặc “year”)</li>
<li>Sử dụng <code>date_minor_breaks =</code> để xác định khoảng của các đường lưới dọc nhỏ (giữa các nhãn ngày)<br>
</li>
<li>Thêm <code>expand = c(0,0)</code> để bắt đầu các nhãn ở cột đầu tiên<br>
</li>
<li>Sử dụng <code>date_labels =</code> để xác định định dạng của nhãn ngày - hãy xem chương Ngày để biết các mẹo (sử dụng <code>\n</code> cho một dòng mới)<br>
</li>
</ul>
</li>
<li>
<p><strong>Nếu histogram bins là các tuần bắt đầu vào Chủ nhật:</strong></p>
<ul>
<li>Sử dụng <code>breaks =</code> và <code>minor_breaks =</code> bằng cách cung cấp một chuỗi ngày cho mỗi khoảng chia</li>
<li>Vẫn có thể sử dụng <code>date_labels =</code> và <code>expand =</code> để định dạng như mô tả ở trên</li>
</ul>
</li>
</ul>
<p>Một số ghi chú:</p>
<ul>
<li>Xem phần mở đầu của mục ggplot về hướng dẫn cách tạo chuỗi ngày bằng <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code>.<br>
</li>
<li>Xem <a href="https://rdrr.io/r/base/strptime.html">trang này</a> hoặc chương <a href="dates.html#dates">Làm việc với ngày tháng</a> để biết thêm mẹo tạo nhãn ngày.</li>
</ul>
<div id="minh-họa" class="section level4 unnumbered">
<h4>Minh họa<a class="anchor" aria-label="anchor" href="#minh-h%E1%BB%8Da"><i class="fas fa-link"></i></a>
</h4>
<p>Dưới đây là minh họa biểu đồ trong đó các cột và nhãn biểu đồ/đường lưới được căn chỉnh thẳng hàng và không thẳng hàng:</p>
<div class="sourceCode" id="cb1562"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7-day bins + Monday labels</span>
<span class="co">#############################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    binwidth <span class="op">=</span> <span class="fl">7</span>,                 <span class="co"># 7-day bins with start at first case</span>
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,               <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>,       <span class="co"># Monday every 3 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,    <span class="co"># Monday weeks</span>
    date_labels <span class="op">=</span> <span class="st">"%a\n%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>  <span class="co"># label format</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>              <span class="co"># remove excess space under x-axis, make flush</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"MISALIGNED"</span>,
    subtitle <span class="op">=</span> <span class="st">"! CAUTION: 7-day bars start Thursdays at first case\nDate labels and gridlines on Mondays\nNote how ticks don't align with bars"</span><span class="op">)</span>



<span class="co"># 7-day bins + Months</span>
<span class="co">#####################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    binwidth <span class="op">=</span> <span class="fl">7</span>,
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                  <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"months"</span>,           <span class="co"># 1st of month</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,       <span class="co"># Monday weeks</span>
    date_labels <span class="op">=</span> <span class="st">"%a\n%d %b\n%Y"</span><span class="op">)</span><span class="op">+</span>    <span class="co"># label format</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                <span class="co"># remove excess space under x-axis, make flush </span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"MISALIGNED"</span>,
    subtitle <span class="op">=</span> <span class="st">"! CAUTION: 7-day bars start Thursdays with first case\nMajor gridlines and date labels at 1st of each month\nMinor gridlines weekly on Mondays\nNote uneven spacing of some gridlines and ticks unaligned with bars"</span><span class="op">)</span>


<span class="co"># TOTAL MONDAY ALIGNMENT: specify manual bin breaks to be mondays</span>
<span class="co">#################################################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    
    <span class="co"># histogram breaks set to 7 days beginning Monday before first case</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,    <span class="co"># defined earlier in this page</span>
    
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"4 weeks"</span>,           <span class="co"># Monday every 4 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># Monday weeks </span>
    date_labels <span class="op">=</span> <span class="st">"%a\n%d %b\n%Y"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># label format</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                <span class="co"># remove excess space under x-axis, make flush </span>
  
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"ALIGNED Mondays"</span>,
    subtitle <span class="op">=</span> <span class="st">"7-day bins manually set to begin Monday before first case (28 Apr)\nDate labels and gridlines on Mondays as well"</span><span class="op">)</span>


<span class="co"># TOTAL MONDAY ALIGNMENT WITH MONTHS LABELS:</span>
<span class="co">############################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    
    <span class="co"># histogram breaks set to 7 days beginning Monday before first case</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,            <span class="co"># defined earlier in this page</span>
    
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"months"</span>,            <span class="co"># Monday every 4 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># Monday weeks </span>
    date_labels <span class="op">=</span> <span class="st">"%b\n%Y"</span><span class="op">)</span><span class="op">+</span>          <span class="co"># label format</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                <span class="co"># remove excess space under x-axis, make flush </span>
  
  <span class="fu">theme</span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># Remove major gridlines (fall on 1st of month)</span>
          
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"ALIGNED Mondays with MONTHLY labels"</span>,
    subtitle <span class="op">=</span> <span class="st">"7-day bins manually set to begin Monday before first case (28 Apr)\nDate labels on 1st of Month\nMonthly major gridlines removed"</span><span class="op">)</span>


<span class="co"># TOTAL SUNDAY ALIGNMENT: specify manual bin breaks AND labels to be Sundays</span>
<span class="co">############################################################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    
    <span class="co"># histogram breaks set to 7 days beginning Sunday before first case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
    <span class="co"># date label breaks and major gridlines set to every 3 weeks beginning Sunday before first case</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
                      to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
                      by   <span class="op">=</span> <span class="st">"3 weeks"</span><span class="op">)</span>,
    
    <span class="co"># minor gridlines set to weekly beginning Sunday before first case</span>
    minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,   <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
                            to   <span class="op">=</span> <span class="fu">ceiling_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="st">"week"</span>, week_start <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,
                            by   <span class="op">=</span> <span class="st">"7 days"</span><span class="op">)</span>,
    
    date_labels <span class="op">=</span> <span class="st">"%a\n%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>  <span class="co"># label format</span>
  
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                <span class="co"># remove excess space under x-axis, make flush </span>
  
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"ALIGNED Sundays"</span>,
       subtitle <span class="op">=</span> <span class="st">"7-day bins manually set to begin Sunday before first case (27 Apr)\nDate labels and gridlines manually set to Sundays as well"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1160-1.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-1160-2.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-1160-3.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-1160-4.png" width="672"><img src="_main_files/figure-html/unnamed-chunk-1160-5.png" width="672"></p>
</div>
</div>
<div id="dữ-liệu-tổng-hợp" class="section level3 unnumbered">
<h3>Dữ liệu tổng hợp<a class="anchor" aria-label="anchor" href="#d%E1%BB%AF-li%E1%BB%87u-t%E1%BB%95ng-h%E1%BB%A3p"><i class="fas fa-link"></i></a>
</h3>
<p>Thông thường, thay vì bắt đầu với bộ số liệu <code>linelist</code>, bạn có thể bắt đầu với số lượng tổng hợp từ các cơ sở y tế, quận, huyện, v.v. Bạn có thể tạo đường cong dịch bệnh với <code>ggplot()</code> nhưng code sẽ hơi khác một chút. Phần này sẽ tận dụng bộ dữ liệu <code>count_data</code> đã được nạp trước đó trong mục chuẩn bị dữ liệu. Bộ dữ liệu này là <code>linelist</code> được tổng hợp thành số lượng bệnh viện theo ngày. 50 hàng đầu tiên được hiển thị dưới đây.</p>
<div id="htmlwidget-0532c7f62ddef01bc7c8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0532c7f62ddef01bc7c8">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399334400000\" data-max=\"1410307200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1\" data-max=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><div id="vẽ-biểu-đồ-dữ-liệu-đếm-hàng-ngày" class="section level4 unnumbered">
<h4>Vẽ biểu đồ dữ liệu đếm hàng ngày<a class="anchor" aria-label="anchor" href="#v%E1%BA%BD-bi%E1%BB%83u-%C4%91%E1%BB%93-d%E1%BB%AF-li%E1%BB%87u-%C4%91%E1%BA%BFm-h%C3%A0ng-ng%C3%A0y"><i class="fas fa-link"></i></a>
</h4>
<p>Chúng ta có thể vẽ biểu đồ đường cong dịch bệnh từ <em>dữ liệu đếm hàng ngày</em>. Dưới đây là sự khác biệt trong đoạn code:</p>
<ul>
<li><p>Khi ánh xạ các yếu tố trong hàm <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, hãy cụ thể <code>y =</code> bằng một cột đếm (trong trường hợp này, tên cột là <code>n_cases</code>)</p></li>
<li><p>Thêm đối số <code>stat = "identity"</code> trong <code>geom_histogram()</code>, giúp xác định rằng chiều cao cột phải là giá trị <code>y =</code>, không phải số hàng như mặc định<br></p></li>
<li><p>Thêm đối số <code>width =</code> để tránh các đường trắng dọc giữa các cột. Đối với dữ liệu hàng ngày được đặt thành 1. Đối với dữ liệu đếm hàng tuần được đặt thành 7. Đối với dữ liệu đếm hàng tháng, các đường màu trắng là một vấn đề (mỗi tháng có số ngày khác nhau) - hãy xem xét chuyển đổi trục x của bạn thành cột phân loại (factor) theo thứ tự (tháng) và sử dụng <code>geom_col()</code>.</p></li>
</ul>
<div class="sourceCode" id="cb1563"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
   mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_hospitalisation</span>, y <span class="op">=</span> <span class="va">n_cases</span><span class="op">)</span>,
   stat <span class="op">=</span> <span class="st">"identity"</span>,
   width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>                <span class="co"># for daily counts, set width = 1 to avoid white space between bars</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Date of report"</span>, 
    y <span class="op">=</span> <span class="st">"Number of cases"</span>,
    title <span class="op">=</span> <span class="st">"Daily case incidence, from daily count data"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1162-1.png" width="672"></div>
</div>
<div id="vẽ-biểu-đồ-dữ-liệu-đếm-hàng-tuần" class="section level4 unnumbered">
<h4>Vẽ biểu đồ dữ liệu đếm hàng tuần<a class="anchor" aria-label="anchor" href="#v%E1%BA%BD-bi%E1%BB%83u-%C4%91%E1%BB%93-d%E1%BB%AF-li%E1%BB%87u-%C4%91%E1%BA%BFm-h%C3%A0ng-tu%E1%BA%A7n"><i class="fas fa-link"></i></a>
</h4>
<p>Nếu dữ liệu của bạn đã là số lượng ca bệnh đếm theo tuần, chúng có thể trông giống như bộ dữ liệu này (được gọi là <code>count_data_weekly</code>):</p>
<p>50 hàng đầu tiên của <code>count_data_weekly</code> được hiển thị bên dưới. Bạn có thể thấy rằng số lượng đếm đã được tổng hợp thành các tuần. Mỗi tuần được hiển thị theo ngày đầu tiên của tuần (mặc định là Thứ Hai).</p>
<div id="htmlwidget-a8108c341350c7247b40" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a8108c341350c7247b40">{"x":{"filter":"none","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)"],["2014-05-04","2014-05-11","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-07-06","2014-07-13","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-13","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-20","2014-05-04","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-05-04","2014-05-18","2014-05-25","2014-06-01","2014-06-15","2014-06-22","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26"],[2,1,2,1,2,1,3,7,5,6,6,13,9,15,12,23,24,23,25,26,23,19,25,19,14,9,10,9,8,12,5,10,5,6,6,4,8,9,8,2,5,3,4,5,6,3,6,5,1,6,3,4,2,3,3,2,3,4,6,13,11,17,18,16,18,31,33,46,44,43,42,39,36,39,51,22,15,31,27,23,24,12,15,22,22,20,17,16,8,13,9,15,13,6,10,4,5,4,5,4,2,1,4,2,5,8,5,9,11,7,12,8,10,12,27,21,34,40,48,53,75,79,85,84,80,77,54,43,41,31,33,37,26,39,30,31,24,33,20,21,21,22,19,20,23,10,13,19,18,10,12,12,8,1,1,1,3,3,3,2,4,2,5,3,8,10,8,11,16,11,15,25,23,39,46,50,49,40,53,44,38,29,29,23,26,26,19,17,19,14,18,16,15,14,17,6,6,9,11,8,11,12,5,5,7,6,3,1,4,3,8,6,3,9,9,9,11,14,15,21,25,22,37,59,53,70,93,107,103,87,64,77,74,75,59,56,58,49,46,34,40,24,20,27,27,28,24,22,15,28,24,18,23,13,22,11,10,12,13,2,3,1,3,1,2,5,3,6,5,7,4,8,7,12,20,27,19,22,23,15,18,13,16,20,10,17,6,13,8,8,8,9,1,8,7,6,6,8,6,4,13,5,2,3,5,2,3,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>epiweek<\/th>\n      <th>n_cases_weekly<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Bây giờ vẽ biểu đồ sao cho <code>x =</code> cột epiweek. Hãy nhớ thêm <code>y =</code> cột đếm khi ánh xạ trục và thêm <code>stat = "identity"</code> như đã giải thích ở trên.</p>
<div class="sourceCode" id="cb1564"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">count_data_weekly</span><span class="op">)</span><span class="op">+</span>
  
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">epiweek</span>,           <span class="co"># x-axis is epiweek (as class Date)</span>
      y <span class="op">=</span> <span class="va">n_cases_weekly</span>,    <span class="co"># y-axis height in the weekly case counts</span>
      group <span class="op">=</span> <span class="va">hospital</span>,      <span class="co"># we are grouping the bars and coloring by hospital</span>
      fill <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span>,
    stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># this is also required when plotting count data</span>
     
  <span class="co"># labels for x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    date_breaks <span class="op">=</span> <span class="st">"2 months"</span>,      <span class="co"># labels every 2 months </span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>, <span class="co"># gridlines every month</span>
    date_labels <span class="op">=</span> <span class="st">'%b\n%Y'</span><span class="op">)</span><span class="op">+</span>       <span class="co">#labeled by month with year below</span>
     
  <span class="co"># Choose color palette (uses RColorBrewer package)</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Pastel2"</span><span class="op">)</span><span class="op">+</span> 
  
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Week of onset"</span>, 
    y <span class="op">=</span> <span class="st">"Weekly case incidence"</span>,
    fill <span class="op">=</span> <span class="st">"Hospital"</span>,
    title <span class="op">=</span> <span class="st">"Weekly case incidence, from aggregated count data by hospital"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1165-1.png" width="672"></div>
</div>
</div>
<div id="đường-trung-bình-động" class="section level3 unnumbered">
<h3>Đường trung bình động<a class="anchor" aria-label="anchor" href="#%C4%91%C6%B0%E1%BB%9Dng-trung-b%C3%ACnh-%C4%91%E1%BB%99ng"><i class="fas fa-link"></i></a>
</h3>
<p>Xem chương về <a href="moving-average.html#moving-average">Đường trung bình động</a> để có mô tả chi tiết và một số tùy chọn. Dưới đây là một tùy chọn để tính toán đường trung bình động với package <strong>slider</strong>. Theo cách tiếp cận này, <em>trung bình động được tính toán trong bộ dữ liệu trước khi vẽ biểu đồ</em>:</p>
<ol style="list-style-type: decimal">
<li>Tổng hợp dữ liệu thành số lượng nếu cần thiết (hàng ngày, hàng tuần, v.v.) (xem chương <a href="grouping.html#grouping">Nhóm dữ liệu</a>)<br>
</li>
<li>Tạo một cột mới để giữ đường trung bình động, được tạo bằng hàm <code>slide_index()</code> từ package <strong>slider</strong><br>
</li>
<li>Vẽ đường trung bình động dưới dạng một <code>geom_line()</code> ở trên đỉnh (phía sau) histogram đường cong dịch bệnh</li>
</ol>
<p>Tham khảo thêm tại <a href="https://cran.r-project.org/web/packages/slider/vignettes/slider.html">vignette của package <strong>slider</strong></a></p>
<div class="sourceCode" id="cb1565"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load package</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">slider</span><span class="op">)</span>  <span class="co"># slider used to calculate rolling averages</span>

<span class="co"># make dataset of daily counts and 7-day moving average</span>
<span class="co">#######################################################</span>
<span class="va">ll_counts_7day</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>    <span class="co"># begin with linelist</span>
  
  <span class="co">## count cases by date</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">date_onset</span>, name <span class="op">=</span> <span class="st">"new_cases"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># name new column with counts as "new_cases"</span>
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>                     <span class="co"># remove cases with missing date_onset</span>
  
  <span class="co">## calculate the average number of cases in 7-day window</span>
  <span class="fu">mutate</span><span class="op">(</span>
    avg_7day <span class="op">=</span> <span class="fu">slider</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/slider/man/slide_index.html">slide_index</a></span><span class="op">(</span>    <span class="co"># create new column</span>
      <span class="va">new_cases</span>,                       <span class="co"># calculate based on value in new_cases column</span>
      .i <span class="op">=</span> <span class="va">date_onset</span>,                 <span class="co"># index is date_onset col, so non-present dates are included in window </span>
      .f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,    <span class="co"># function is mean() with missing values removed</span>
      .before <span class="op">=</span> <span class="fl">6</span>,                     <span class="co"># window is the day and 6-days before</span>
      .complete <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,              <span class="co"># must be FALSE for unlist() to work in next step</span>
    avg_7day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">avg_7day</span><span class="op">)</span><span class="op">)</span>       <span class="co"># convert class list to class numeric</span>


<span class="co"># plot</span>
<span class="co">######</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ll_counts_7day</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># begin with new dataset defined above </span>
    <span class="fu">geom_histogram</span><span class="op">(</span>              <span class="co"># create epicurve histogram</span>
      mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
        x <span class="op">=</span> <span class="va">date_onset</span>,          <span class="co"># date column as x-axis</span>
        y <span class="op">=</span> <span class="va">new_cases</span><span class="op">)</span>,          <span class="co"># height is number of daily new cases</span>
        stat <span class="op">=</span> <span class="st">"identity"</span>,       <span class="co"># height is y value</span>
        fill<span class="op">=</span><span class="st">"#92a8d1"</span>,          <span class="co"># cool color for bars</span>
        colour <span class="op">=</span> <span class="st">"#92a8d1"</span>,      <span class="co"># same color for bar border</span>
        <span class="op">)</span><span class="op">+</span> 
    <span class="fu">geom_line</span><span class="op">(</span>                   <span class="co"># make line for rolling average</span>
      mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
        x <span class="op">=</span> <span class="va">date_onset</span>,          <span class="co"># date column for x-axis</span>
        y <span class="op">=</span> <span class="va">avg_7day</span>,            <span class="co"># y-value set to rolling average column</span>
        lty <span class="op">=</span> <span class="st">"7-day \nrolling avg"</span><span class="op">)</span>, <span class="co"># name of line in legend</span>
      color<span class="op">=</span><span class="st">"red"</span>,               <span class="co"># color of line</span>
      size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>                <span class="co"># width of line</span>
    <span class="fu">scale_x_date</span><span class="op">(</span>                <span class="co"># date scale</span>
      date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,
      date_labels <span class="op">=</span> <span class="st">'%d/%m'</span>,
      expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_y_continuous</span><span class="op">(</span>          <span class="co"># y-axis scale</span>
      expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
      limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>       
    <span class="fu">labs</span><span class="op">(</span>
      x<span class="op">=</span><span class="st">""</span>,
      y <span class="op">=</span><span class="st">"Number of confirmed cases"</span>,
      fill <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span><span class="op">+</span> 
    <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co"># removes title of legend</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1166-1.png" width="672"></div>
</div>
<div id="facetingchia-nhỏ-biểu-đồ" class="section level3 unnumbered">
<h3>Faceting/chia nhỏ biểu đồ<a class="anchor" aria-label="anchor" href="#facetingchia-nh%E1%BB%8F-bi%E1%BB%83u-%C4%91%E1%BB%93"><i class="fas fa-link"></i></a>
</h3>
<p>Như với các ggplots khác, bạn có thể tạo các biểu đồ được chia nhỏ (“nhiều biểu đồ con”). Như đã giải thích trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a> trong cuốn sách này, bạn có thể sử dụng <code>facet_wrap()</code> hoặc <code>facet_grid()</code>. Ở đây chúng tôi sẽ minh họa bằng hàm <code>facet_wrap()</code>. Đối với đường cong dịch bệnh, sử dụng <code>facet_wrap()</code> thường dễ dàng hơn vì khả năng bạn thường chỉ cần chia nhỏ biểu đồ theo một biến.</p>
<p>Cú pháp chung là <code>facet_wrap(rows ~ cols)</code>, trong đó bên trái dấu ngã (~) là tên của biến sẽ được trải trên các “hàng” của biểu đồ chia nhỏ và ở bên phải dấu ngã là tên của biến sẽ được trải trên các “cột” của biểu đồ chia nhỏ. Đơn giản nhất, chỉ cần sử dụng một tên cột, ở bên phải dấu ngã: <code>facet_wrap(~age_cat)</code>.</p>
<p><strong>Trục tự do</strong><br>
Bạn sẽ cần phải quyết định xem tỷ lệ của các trục cho mỗi biểu đồ nhỏ là “cố định” với cùng một kích thước (mặc định) hay “tự do” (nghĩa là chúng sẽ thay đổi dựa trên dữ liệu của chúng). Thực hiện điều này với đối số <code>scales =</code> trong hàm <code>facet_wrap()</code> bằng cách chỉ định “free_x” hoặc “free_y” hoặc “free”.</p>
<p><strong>Số cột và hàng của các biểu đồ con</strong><br>
Điều này có thể xác định với <code>ncol =</code> và <code>nrow =</code> trong hàm <code>facet_wrap()</code>.</p>
<p><strong>Thứ tự các biểu đồ con</strong><br>
Để thay đổi thứ tự xuất hiện, hãy thay đổi thứ tự cơ bản của các cấp của cột phân loại được sử dụng để tạo các biểu đồ con.</p>
<p><strong>Đinh dạng trục</strong><br>
Kích thước phông chữ và mặt biểu đồ, dải màu, v.v. có thể được sửa đổi thông qua <code>theme()</code> với các đối số như:</p>
<ul>
<li><p><code>strip.text = element_text()</code> (kích thước, màu sắc, mặt, góc …)</p></li>
<li><p><code>strip.background = element_rect()</code> (ví dụ: <code>element_rect(fill = "grey")</code>)<br></p></li>
<li><p><code>strip.position =</code> (vị trị “dưới”, “trên”, “trái”, hoặc “phải”)</p></li>
</ul>
<p><strong>Dải nhãn</strong><br>
Nhãn của các biểu đồ con có thể được sửa đổi thông qua “nhãn” của cột như một factor hoặc bằng cách sử dụng một “người dán nhãn - labeller”.</p>
<p>Để tạo một labeller như thế, sử dụng hàm <code>as_labeller()</code> từ <strong>ggplot2</strong>. Sau đó, cung cấp labeller cho đối số <code>labeller =</code> của <code>facet_wrap()</code> như dưới đây.</p>
<div class="sourceCode" id="cb1566"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_labels</span> <span class="op">&lt;-</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
     <span class="st">"0-4"</span>   <span class="op">=</span> <span class="st">"Ages 0-4"</span>,
     <span class="st">"5-9"</span>   <span class="op">=</span> <span class="st">"Ages 5-9"</span>,
     <span class="st">"10-14"</span> <span class="op">=</span> <span class="st">"Ages 10-14"</span>,
     <span class="st">"15-19"</span> <span class="op">=</span> <span class="st">"Ages 15-19"</span>,
     <span class="st">"20-29"</span> <span class="op">=</span> <span class="st">"Ages 20-29"</span>,
     <span class="st">"30-49"</span> <span class="op">=</span> <span class="st">"Ages 30-49"</span>,
     <span class="st">"50-69"</span> <span class="op">=</span> <span class="st">"Ages 50-69"</span>,
     <span class="st">"70+"</span>   <span class="op">=</span> <span class="st">"Over age 70"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong>Một ví dụ về chia nhỏ biểu đồ</strong> - chia bằng cột <code>age_cat</code>.</p>
<div class="sourceCode" id="cb1567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make plot</span>
<span class="co">###########</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">date_onset</span>,
      group <span class="op">=</span> <span class="va">age_cat</span>,
      fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,    <span class="co"># arguments inside aes() apply by group</span>
      
    color <span class="op">=</span> <span class="st">"black"</span>,      <span class="co"># arguments outside aes() apply to all data</span>
        
    <span class="co"># histogram breaks</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span><span class="op">)</span><span class="op">+</span>  <span class="co"># pre-defined date vector (see earlier in this page)</span>
                      
  <span class="co"># The labels on the x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># labels appear every 2 months</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># vertical lines appear every 1 month </span>
    date_labels       <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                           <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
    strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
    strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>         <span class="co"># axis titles in bold</span>
  
  <span class="co"># create facets</span>
  <span class="fu">facet_wrap</span><span class="op">(</span>
    <span class="op">~</span><span class="va">age_cat</span>,
    ncol <span class="op">=</span> <span class="fl">4</span>,
    strip.position <span class="op">=</span> <span class="st">"top"</span>,
    labeller <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">+</span>             
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by age category"</span>,
    subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
    fill     <span class="op">=</span> <span class="st">"Age category"</span>,                                      <span class="co"># provide new title for legend</span>
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1168-1.png" width="672"></div>
<p>Xem <a href="https://ggplot2.tidyverse.org/reference/labellers.html">link</a> để biết thêm thông tin về labellers.</p>
<div id="tổng-vụ-dịch-trong-nền-của-biểu-đồ-con" class="section level4 unnumbered">
<h4>Tổng vụ dịch trong nền của biểu đồ con<a class="anchor" aria-label="anchor" href="#t%E1%BB%95ng-v%E1%BB%A5-d%E1%BB%8Bch-trong-n%E1%BB%81n-c%E1%BB%A7a-bi%E1%BB%83u-%C4%91%E1%BB%93-con"><i class="fas fa-link"></i></a>
</h4>
<p>Để hiển thị tổng vụ dịch trong nền của mỗi biểu đồ con, hãy thêm hàm <code><a href="https://rdrr.io/pkg/gghighlight/man/gghighlight.html">gghighlight()</a></code> với dấu ngoặc đơn trống vào ggplot. Hàm này thuộc package <strong>gghighlight</strong>. Lưu ý rằng trục y tối đa trong tất cả các biểu đồ con hiện dựa vào đỉnh của toàn bộ vụ dịch. Có nhiều ví dụ hơn về package này trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>.</p>
<div class="sourceCode" id="cb1568"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># epicurves by group</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">date_onset</span>,
      group <span class="op">=</span> <span class="va">age_cat</span>,
      fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,  <span class="co"># arguments inside aes() apply by group</span>
    
    color <span class="op">=</span> <span class="st">"black"</span>,    <span class="co"># arguments outside aes() apply to all data</span>
    
    <span class="co"># histogram breaks</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span><span class="op">)</span><span class="op">+</span>     <span class="co"># pre-defined date vector (see top of ggplot section)                </span>
  
  <span class="co"># add grey epidemic in background to each facet</span>
  <span class="fu">gghighlight</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gghighlight/man/gghighlight.html">gghighlight</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># labels on x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># labels appear every 2 months</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># vertical lines appear every 1 month </span>
    date_labels       <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># removes excess y-axis space below 0</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                           <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
    strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
    strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>        <span class="co"># axis titles in bold</span>
  
  <span class="co"># create facets</span>
  <span class="fu">facet_wrap</span><span class="op">(</span>
    <span class="op">~</span><span class="va">age_cat</span>,                          <span class="co"># each plot is one value of age_cat</span>
    ncol <span class="op">=</span> <span class="fl">4</span>,                          <span class="co"># number of columns</span>
    strip.position <span class="op">=</span> <span class="st">"top"</span>,            <span class="co"># position of the facet title/strip</span>
    labeller <span class="op">=</span> <span class="va">my_labels</span><span class="op">)</span><span class="op">+</span>             <span class="co"># labeller defines above</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
    title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by age category"</span>,
    subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
    fill     <span class="op">=</span> <span class="st">"Age category"</span>,                                      <span class="co"># provide new title for legend</span>
    x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
    caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1169-1.png" width="672"></div>
</div>
<div id="dữ-liệu-một-biểu-đồ-con" class="section level4 unnumbered">
<h4>Dữ liệu một biểu đồ con<a class="anchor" aria-label="anchor" href="#d%E1%BB%AF-li%E1%BB%87u-m%E1%BB%99t-bi%E1%BB%83u-%C4%91%E1%BB%93-con"><i class="fas fa-link"></i></a>
</h4>
<p>Nếu bạn muốn có một hộp biểu đồ con chứa tất cả dữ liệu, hãy sao chép toàn bộ dữ liệu và coi các bản sao như một giá trị cho các biểu đồ con. Hàm “trợ giúp” <code>CreateAllFacet()</code> bên dưới có thể hỗ trợ việc này (nhờ bài đăng trên <a href="https://stackoverflow.com/questions/18933575/easily-add-an-all-facet-to-facet-wrap-in-ggplot2">blog</a> này). Khi nó được chạy, số hàng tăng gấp đôi và sẽ có một cột mới được gọi là <code>facet</code>, trong đó các hàng được sao chép sẽ có giá trị “tất cả” và các hàng ban đầu có giá trị ban đầu của cột phân chia. Bây giờ bạn chỉ cần phân chia cột <code>facet</code> .</p>
<p>Dưới đây là hàm trợ giúp. Chạy code này và nó sẽ luôn sẵn sàng để bạn sử dụng.</p>
<div class="sourceCode" id="cb1569"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define helper function</span>
<span class="va">CreateAllFacet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">col</span><span class="op">)</span><span class="op">{</span>
     <span class="va">df</span><span class="op">$</span><span class="va">facet</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span>
     <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">df</span>
     <span class="va">temp</span><span class="op">$</span><span class="va">facet</span> <span class="op">&lt;-</span> <span class="st">"all"</span>
     <span class="va">merged</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">df</span><span class="op">)</span>
     
     <span class="co"># ensure the facet value is a factor</span>
     <span class="va">merged</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">merged</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
     
     <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">merged</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Bây giờ hãy áp dụng hàm trợ giúp cho bộ dữ liệu, trên cột <code>age_cat</code>:</p>
<div class="sourceCode" id="cb1570"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create dataset that is duplicated and with new column "facet" to show "all" age categories as another facet level</span>
<span class="va">central_data2</span> <span class="op">&lt;-</span> <span class="fu">CreateAllFacet</span><span class="op">(</span><span class="va">central_data</span>, col <span class="op">=</span> <span class="st">"age_cat"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co"># set factor levels</span>
  <span class="fu">mutate</span><span class="op">(</span>facet <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">facet</span>, <span class="st">"all"</span>, <span class="st">"0-4"</span>, <span class="st">"5-9"</span>,
                             <span class="st">"10-14"</span>, <span class="st">"15-19"</span>, <span class="st">"20-29"</span>,
                             <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70+"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Unknown levels in `f`: 70+</code></pre>
<div class="sourceCode" id="cb1572"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># check levels</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">central_data2</span><span class="op">$</span><span class="va">facet</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   all   0-4   5-9 10-14 15-19 20-29 30-49 50-69  &lt;NA&gt; 
##   454    84    84    82    58    73    57     7     9</code></pre>
<p>Những thay đổi đáng chú ý đối với lệnh <code>ggplot()</code> là:</p>
<ul>
<li><p>Dữ liệu được sử dụng bây giờ là <code>central_data2</code> (nhân đôi các hàng, với cột mới là “facet”)</p></li>
<li><p>Labeller sẽ cần được cập nhật, nếu được sử dụng<br></p></li>
<li><p>Tùy chọn: để có các biểu đồ con xếp chồng lên nhau theo chiều dọc: cột chia được chuyển sang các hàng bên cạnh của phương trình và ở bên phải được thay thế bằng “.” (<code>facet_wrap(facet~.)</code>), và <code>ncol = 1</code>. Bạn cũng có thể cần điều chỉnh chiều rộng và chiều cao của ảnh biểu đồ đã lưu dưới dạng png (xem <code>ggsave()</code> trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>).</p></li>
</ul>
<div class="sourceCode" id="cb1574"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data2</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># actual epicurves by group</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
        mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">date_onset</span>,
          group <span class="op">=</span> <span class="va">age_cat</span>,
          fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span>,  <span class="co"># arguments inside aes() apply by group</span>
        color <span class="op">=</span> <span class="st">"black"</span>,    <span class="co"># arguments outside aes() apply to all data</span>
        
        <span class="co"># histogram breaks</span>
        breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span><span class="op">)</span><span class="op">+</span>    <span class="co"># pre-defined date vector (see top of ggplot section)</span>
                     
  <span class="co"># Labels on x-axis</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,         <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks       <span class="op">=</span> <span class="st">"2 months"</span>,     <span class="co"># labels appear every 2 months</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,      <span class="co"># vertical lines appear every 1 month </span>
    date_labels       <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>     <span class="co"># date labels format</span>
  
  <span class="co"># y-axis</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># removes excess y-axis space between bottom of bars and the labels</span>
  
  <span class="co"># aesthetic themes</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                           <span class="co"># a set of themes to simplify plot</span>
  <span class="fu">theme</span><span class="op">(</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="co"># caption on left side in italics</span>
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span>               
  
  <span class="co"># create facets</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">facet</span><span class="op">~</span><span class="va">.</span> ,                            <span class="co"># each plot is one value of facet</span>
             ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>            

  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>title    <span class="op">=</span> <span class="st">"Weekly incidence of cases, by age category"</span>,
       subtitle <span class="op">=</span> <span class="st">"Subtitle"</span>,
       fill     <span class="op">=</span> <span class="st">"Age category"</span>,                                      <span class="co"># provide new title for legend</span>
       x        <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
       y        <span class="op">=</span> <span class="st">"Weekly incident cases reported"</span>,
       caption  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')} to {format(max(central_data$date_onset, na.rm=T), format = '%a %d %b %Y')}\n{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1172-1.png" width="480"></div>
</div>
</div>
</div>
<div id="dữ-liệu-dự-kiến" class="section level2" number="32.4">
<h2>
<span class="header-section-number">32.4</span> Dữ liệu dự kiến<a class="anchor" aria-label="anchor" href="#d%E1%BB%AF-li%E1%BB%87u-d%E1%BB%B1-ki%E1%BA%BFn"><i class="fas fa-link"></i></a>
</h2>
<p>Dữ liệu gần đây nhất được biểu thị trong đường cong dịch tễ nên được đánh dấu là dự kiến hoặc có thể báo cáo chậm trễ. Điều này có thể được thực hiện bằng cách thêm một đường thẳng đứng và/hoặc hình chữ nhật trong một số ngày cụ thể. Đây là hai tùy chọn:</p>
<ol style="list-style-type: decimal">
<li>
<p>Sử dụng <code>annotate()</code>:</p>
<ul>
<li>Để sử dụng dạng đường <code>annotate(geom = "segment")</code>. Cung cấp <code>x</code>, <code>xend</code>, <code>y</code>, và <code>yend</code>. Hiệu chỉnh kích thước, kiểu dòng (<code>lty</code>), và màu.<br>
</li>
<li>Để sử dụng dạng hình chữ nhật <code>annotate(geom = "rect")</code>. Cung cấp xmin/xmax/ymin/ymax. Hiệu chỉnh màu và hệ số alpha.<br>
</li>
</ul>
</li>
<li><p>Nhóm dữ liệu theo trạng thái tạm thời và tô màu các cột đó theo cách khác nhau</p></li>
</ol>
<p><span style="color: orange;"><strong><em>THẬN TRỌNG</em></strong>: Bạn có thể thử hàm <code>geom_rect()</code> để vẽ hình chữ nhật, nhưng việc điều chỉnh độ trong suốt không khả thi trong bối cảnh cảnh bộ số liệu <code>linelist</code>. Hàm này sẽ phủ lên một hình chữ nhật cho mỗi hàng/quan sát!. Sử dụng hệ số alpha rất thấp (ví dụ: 0.01) hoặc một cách tiếp cận khác.</span></p>
<div id="sử-dụng-annotate" class="section level3 unnumbered">
<h3>Sử dụng <code>annotate()</code><a class="anchor" aria-label="anchor" href="#s%E1%BB%AD-d%E1%BB%A5ng-annotate"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>Trong <code>annotate(geom = "rect")</code>, đối số <code>xmin</code> và <code>xmax</code> cần được định dạng phân lớp ngày<br>
</li>
<li>Lưu ý rằng vì những dữ liệu này được tổng hợp thành các cột hàng tuần và cột cuối cùng kéo dài đến Thứ Hai sau điểm dữ liệu cuối cùng, vùng được tô bóng có thể bao gồm 4 tuần<br>
</li>
<li>Đây là một <a href="https://ggplot2.tidyverse.org/reference/annotate.html">ví dụ trực tuyến</a> về <code>annotate()</code>
</li>
</ul>
<div class="sourceCode" id="cb1575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">central_data</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># histogram</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,   <span class="co"># pre-defined date vector - see top of ggplot section</span>
    
    color <span class="op">=</span> <span class="st">"darkblue"</span>,
    
    fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>

  <span class="co"># scales</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,           <span class="co"># 1st of month</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"1 month"</span>,     <span class="co"># 1st of month</span>
    date_labels <span class="op">=</span> <span class="st">"%b\n'%y"</span><span class="op">)</span><span class="op">+</span>          <span class="co"># label format</span>
  
  <span class="co"># labels and theme</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Using annotate()\nRectangle and line showing that data from last 21-days are tentative"</span>,
    x <span class="op">=</span> <span class="st">"Week of symptom onset"</span>,
    y <span class="op">=</span> <span class="st">"Weekly case indicence"</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># add semi-transparent red rectangle to tentative data</span>
  <span class="fu">annotate</span><span class="op">(</span>
    <span class="st">"rect"</span>,
    xmin  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span><span class="op">)</span>, <span class="co"># note must be wrapped in as.Date()</span>
    xmax  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">Inf</span><span class="op">)</span>,                                          <span class="co"># note must be wrapped in as.Date()</span>
    ymin  <span class="op">=</span> <span class="fl">0</span>,
    ymax  <span class="op">=</span> <span class="cn">Inf</span>,
    alpha <span class="op">=</span> <span class="fl">0.2</span>,          <span class="co"># alpha easy and intuitive to adjust using annotate()</span>
    fill  <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># add black vertical line on top of other layers</span>
  <span class="fu">annotate</span><span class="op">(</span>
    <span class="st">"segment"</span>,
    x     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>, <span class="co"># 21 days before last data</span>
    xend  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>, 
    y     <span class="op">=</span> <span class="fl">0</span>,         <span class="co"># line begins at y = 0</span>
    yend  <span class="op">=</span> <span class="cn">Inf</span>,       <span class="co"># line to top of plot</span>
    size  <span class="op">=</span> <span class="fl">2</span>,         <span class="co"># line size</span>
    color <span class="op">=</span> <span class="st">"black"</span>,
    lty   <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span><span class="op">+</span>   <span class="co"># linetype e.g. "solid", "dashed"</span>

  <span class="co"># add text in rectangle</span>
  <span class="fu">annotate</span><span class="op">(</span>
    <span class="st">"text"</span>,
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">15</span>,
    y <span class="op">=</span> <span class="fl">15</span>,
    label <span class="op">=</span> <span class="st">"Subject to reporting delays"</span>,
    angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1173-1.png" width="672"></div>
<p>Đường thẳng đứng màu đen có thể tạo ra với code bên dưới, nhưng sử dụng <code>geom_vline()</code>, bạn sẽ mất khả năng kiểm soát chiều cao:</p>
<div class="sourceCode" id="cb1576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">central_data</span><span class="op">$</span><span class="va">date_onset</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">21</span>,
           size <span class="op">=</span> <span class="fl">2</span>,
           color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
</div>
<div id="màu-cột" class="section level3 unnumbered">
<h3>Màu cột<a class="anchor" aria-label="anchor" href="#m%C3%A0u-c%E1%BB%99t"><i class="fas fa-link"></i></a>
</h3>
<p>Một cách tiếp cận thay thế có thể là điều chỉnh màu sắc hoặc cách hiển thị của chính các cột dữ liệu dự kiến. Bạn có thể tạo một cột mới trong giai đoạn chuẩn bị dữ liệu và sử dụng cột đó để nhóm dữ liệu, sao cho <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes(fill = )</a></code> của dữ liệu tạm thời có thể có màu hoặc hệ số alpha khác với các cột khác.</p>
<div class="sourceCode" id="cb1577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add column</span>
<span class="co">############</span>
<span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">central_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>tentative <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
    <span class="va">date_onset</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">-</span> <span class="fl">7</span> <span class="op">~</span> <span class="st">"Tentative"</span>, <span class="co"># tenative if in last 7 days</span>
    <span class="cn">TRUE</span>                                       <span class="op">~</span> <span class="st">"Reliable"</span><span class="op">)</span><span class="op">)</span> <span class="co"># all else reliable</span>

<span class="co"># plot</span>
<span class="co">######</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, fill <span class="op">=</span> <span class="va">tentative</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co"># histogram</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_central</span>,   <span class="co"># pre-defined data vector, see top of ggplot page</span>
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>

  <span class="co"># scales</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lightblue"</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,                   <span class="co"># remove excess x-axis space below and after case bars</span>
    date_breaks <span class="op">=</span> <span class="st">"3 weeks"</span>,           <span class="co"># Monday every 3 weeks</span>
    date_minor_breaks <span class="op">=</span> <span class="st">"week"</span>,        <span class="co"># Monday weeks </span>
    date_labels <span class="op">=</span> <span class="st">"%d\n%b\n'%y"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># label format</span>
  
  <span class="co"># labels and theme</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Show days that are tentative reporting"</span>,
    subtitle <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>                 <span class="co"># remove title of legend</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1175-1.png" width="672"></div>
</div>
</div>
<div id="nhãn-ngày-nhiều-cấp-độ" class="section level2" number="32.5">
<h2>
<span class="header-section-number">32.5</span> Nhãn ngày nhiều cấp độ<a class="anchor" aria-label="anchor" href="#nh%C3%A3n-ng%C3%A0y-nhi%E1%BB%81u-c%E1%BA%A5p-%C4%91%E1%BB%99"><i class="fas fa-link"></i></a>
</h2>
<p>Nếu bạn muốn phân nhiều cấp nhãn ngày (ví dụ: tháng và năm) mà <em>không sao chép các cấp nhãn cấp độ thấp hơn</em>, hãy xem xét một trong các cách tiếp cận bên dưới:</p>
<p>Hãy nhớ rằng - bạn có thể sử dụng các công cụ như <code>\n</code> <em>trong</em> các đối số <code>date_labels</code> hoặc <code>labels</code> để đặt các phần của mỗi nhãn trên một dòng mới bên dưới. Tuy nhiên, đoạn code dưới đây giúp bạn thực hiện nhiều năm hoặc tháng (ví dụ) ở dòng thấp hơn <em>và chỉ một lần</em>. Một số lưu ý về code bên dưới:</p>
<ul>
<li>Số lượng ca bệnh được tổng hợp thành các tuần vì lý do thẩm mỹ. Xem chương Đường cong dịch bệnh (tab dữ liệu tổng hợp) để biết chi tiết.<br>
</li>
<li>Một miền <code>geom_area()</code> được sử dụng thay vì một histogram, vì phương pháp tiếp cận chia biểu đồ dưới đây không hoạt động tốt với histogram.</li>
</ul>
<p><strong>Tổng hợp dữ đếm hàng tuần</strong></p>
<div class="sourceCode" id="cb1578"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create dataset of case counts by week</span>
<span class="co">#######################################</span>
<span class="va">central_weekly</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="st">"Central Hospital"</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># filter linelist</span>
  <span class="fu">mutate</span><span class="op">(</span>week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, unit <span class="op">=</span> <span class="st">"weeks"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu">count</span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op">%&gt;%</span>                              <span class="co"># summarize weekly case counts</span>
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op">%&gt;%</span>                            <span class="co"># remove cases with missing onset_date</span>
  <span class="fu">complete</span><span class="op">(</span>                                    <span class="co"># fill-in all weeks with no cases reported</span>
    week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>
      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,   
      to   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,
      by   <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>,
    fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>                        <span class="co"># convert new NA values to 0 counts</span></code></pre></div>
<p><strong>Vẽ biểu đồ</strong></p>
<div class="sourceCode" id="cb1579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot with box border on year</span>
<span class="co">##############################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_weekly</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_area</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,    <span class="co"># make line, specify x and y</span>
            stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>             <span class="co"># because line height is count number</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels<span class="op">=</span><span class="st">"%b"</span>,             <span class="co"># date label format show month </span>
               date_breaks<span class="op">=</span><span class="st">"month"</span>,          <span class="co"># date labels on 1st of each month</span>
               expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>              <span class="co"># remove excess space on each end</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># remove excess space below x-axis</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>, <span class="co"># facet on year (of Date class column)</span>
             space<span class="op">=</span><span class="st">"free_x"</span>,                
             scales<span class="op">=</span><span class="st">"free_x"</span>,                <span class="co"># x-axes adapt to data range (not "fixed")</span>
             switch<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span>                   <span class="co"># facet labels (year) on bottom</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,         <span class="co"># facet labels placement</span>
        strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># facet labels no fill grey border</span>
                                        colour <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,
        panel.spacing <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># no space between facet panels</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Nested year labels, grey label border"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1177-1.png" width="672"></div>
<div class="sourceCode" id="cb1580"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot with no box border on year</span>
<span class="co">#################################</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">central_weekly</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>              <span class="co"># establish x and y for entire plot</span>
  <span class="fu">geom_line</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,              <span class="co"># make line, line height is count number</span>
            color <span class="op">=</span> <span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span>            <span class="co"># line color</span>
  <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span>, color<span class="op">=</span><span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span>     <span class="co"># make points at the weekly data points</span>
  <span class="fu">geom_area</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#69b3a2"</span>,               <span class="co"># fill area below line</span>
            alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># fill transparency</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels<span class="op">=</span><span class="st">"%b"</span>,            <span class="co"># date label format show month </span>
               date_breaks<span class="op">=</span><span class="st">"month"</span>,         <span class="co"># date labels on 1st of each month</span>
               expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>             <span class="co"># remove excess space</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    expand  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                      <span class="co"># remove excess space below x-axis</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="op">~</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span>,        <span class="co"># facet on year (of Date class column)</span>
             space<span class="op">=</span><span class="st">"free_x"</span>,                
             scales<span class="op">=</span><span class="st">"free_x"</span>,               <span class="co"># x-axes adapt to data range (not "fixed")</span>
             switch<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span>                  <span class="co"># facet labels (year) on bottom</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>strip.placement <span class="op">=</span> <span class="st">"outside"</span>,                     <span class="co"># facet label placement</span>
          strip.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,            <span class="co"># no facet lable background</span>
          panel.grid.minor.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,          
          panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"grey40"</span><span class="op">)</span>,  <span class="co"># grey border to facet PANEL</span>
          panel.spacing<span class="op">=</span><span class="fu">unit</span><span class="op">(</span><span class="fl">0</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># No space between facet panels</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Nested year labels - points, shaded, no label border"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1177-2.png" width="672"></div>
<p>Các kỹ thuật trên được điều chỉnh từ <a href="https://stackoverflow.com/questions/44616530/axis-labels-on-two-lines-with-nested-x-variables-year-below-months">đây</a> và bài đăng <a href="https://stackoverflow.com/questions/20571306/multi-row-x-axis-labels-in-ggplot-line-chart">này</a> trên stackoverflow.com.</p>
<!-- ======================================================= -->
</div>
<div id="trục-kép-1" class="section level2" number="32.6">
<h2>
<span class="header-section-number">32.6</span> Trục kép<a class="anchor" aria-label="anchor" href="#tr%E1%BB%A5c-k%C3%A9p-1"><i class="fas fa-link"></i></a>
</h2>
<p>Mặc dù có những cuộc thảo luận gay gắt về tính hợp lệ của trục kép trong cộng đồng về trực quan hóa dữ liệu, nhiều chuyên gia dịch tễ vẫn muốn nhìn nhận biểu đồ đường cong dịch bệnh hoặc biểu đồ tương tự với phần trăm trên trục thứ hai. Điều này được thảo luận nhiều hơn trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>, nhưng một ví dụ sử dụng phương pháp <strong>cowplot</strong> được trình bày bên dưới:</p>
<ul>
<li>Hai biểu đồ riêng biệt được tạo, và sau đó được kết hợp với package <strong>cowplot</strong>.<br>
</li>
<li>Các biểu đồ phải có chính xác cùng trục x (đã đặt giới hạn), nếu không dữ liệu và nhãn sẽ không được căn chỉnh phù hợp<br>
</li>
<li>Mỗi biểu đồ sử dụng <code>theme_cowplot()</code> và một biểu đồ có trục y được di chuyển sang phía bên phải của biểu đồ</li>
</ul>
<div class="sourceCode" id="cb1581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load package</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span>

<span class="co"># Make first plot of epicurve histogram</span>
<span class="co">#######################################</span>
<span class="va">plot_cases</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># plot cases per week</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># create histogram  </span>
  <span class="fu">geom_histogram</span><span class="op">(</span>
    
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    
    <span class="co"># bin breaks every week beginning monday before first case, going to monday after last case</span>
    breaks <span class="op">=</span> <span class="va">weekly_breaks_all</span><span class="op">)</span><span class="op">+</span>  <span class="co"># pre-defined vector of weekly dates (see top of ggplot section)</span>
        
  <span class="co"># specify beginning and end of date axis to align with other plot</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># min/max of the pre-defined weekly breaks of histogram</span>
  
  <span class="co"># labels</span>
  <span class="fu">labs</span><span class="op">(</span>
      y <span class="op">=</span> <span class="st">"Daily cases"</span>,
      x <span class="op">=</span> <span class="st">"Date of symptom onset"</span>
    <span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span>


<span class="co"># make second plot of percent died per week</span>
<span class="co">###########################################</span>
<span class="va">plot_deaths</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>                        <span class="co"># begin with linelist</span>
  <span class="fu">group_by</span><span class="op">(</span>week <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># create week column</span>
  
  <span class="co"># summarise to get weekly percent of cases who died</span>
  <span class="fu">summarise</span><span class="op">(</span>n_cases <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
            died <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
            pct_died <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="va">died</span><span class="op">/</span><span class="va">n_cases</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># begin plot</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># line of weekly percent who died</span>
  <span class="fu">geom_line</span><span class="op">(</span>                                <span class="co"># create line of percent died</span>
    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">pct_died</span><span class="op">)</span>,  <span class="co"># specify y-height as pct_died column</span>
    stat <span class="op">=</span> <span class="st">"identity"</span>,                      <span class="co"># set line height to the value in pct_death column, not the number of rows (which is default)</span>
    size <span class="op">=</span> <span class="fl">2</span>,
    color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>
  
  <span class="co"># Same date-axis limits as the other plot - perfect alignment</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>
    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">weekly_breaks_all</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># min/max of the pre-defined weekly breaks of histogram</span>
  
  
  <span class="co"># y-axis adjustments</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>                <span class="co"># adjust y-axis</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>,         <span class="co"># set break intervals of percent axis</span>
    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,              <span class="co"># set extent of percent axis</span>
    position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span>             <span class="co"># move percent axis to the right</span>
  
  <span class="co"># Y-axis label, no x-axis label</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>,
       y <span class="op">=</span> <span class="st">"Percent deceased"</span><span class="op">)</span><span class="op">+</span>      <span class="co"># percent axis label</span>
  
  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span>                   <span class="co"># add this to make the two plots merge together nicely</span></code></pre></div>
<p>Bây giờ sử dụng <strong>cowplot</strong> để chồng lên hai biểu đồ. Sự chú ý đã được tập trung vào việc căn chỉnh trục x, cạnh của trục y và việc sử dụng <code>theme_cowplot()</code>.</p>
<div class="sourceCode" id="cb1582"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aligned_plots</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/align_plots.html">align_plots</a></span><span class="op">(</span><span class="va">plot_cases</span>, <span class="va">plot_deaths</span>, align<span class="op">=</span><span class="st">"hv"</span>, axis<span class="op">=</span><span class="st">"tblr"</span><span class="op">)</span>
<span class="fu">ggdraw</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">draw_plot</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1179-1.png" width="672"></div>
</div>
<div id="số-mới-mắc-tích-lũy-1" class="section level2" number="32.7">
<h2>
<span class="header-section-number">32.7</span> Số mới mắc tích lũy<a class="anchor" aria-label="anchor" href="#s%E1%BB%91-m%E1%BB%9Bi-m%E1%BA%AFc-t%C3%ADch-l%C5%A9y-1"><i class="fas fa-link"></i></a>
</h2>
<p>Lưu ý: Nếu sử dụng <strong>incidence2</strong>, hãy xem chương về cách bạn có thể tính số mới mắc tích lũy bằng một hàm đơn giản. Chương này sẽ đề cập đến cách tính số mới mắc tích lũy và vẽ biểu đồ bằng <code>ggplot()</code>.</p>
<p>Nếu bắt đầu bằng bộ số liệu <code>linelist</code>, hãy tạo một cột mới chứa số ca bệnh tích lũy mỗi ngày trong đợt bùng phát bằng cách sử dụng <code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code> từ <strong>base</strong> R:</p>
<div class="sourceCode" id="cb1583"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cumulative_case_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>                <span class="co"># count of rows per day (returned in column "n")   </span>
  <span class="fu">mutate</span><span class="op">(</span>                         
    cumulative_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>       <span class="co"># new column of the cumulative number of rows at each date</span>
    <span class="op">)</span></code></pre></div>
<p>10 hàng đầu tiên được hiển thị bên dưới:</p>
<div id="htmlwidget-dee7dd0206226d8260b9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-dee7dd0206226d8260b9">{"x":{"filter":"none","data":[["2014-04-07","2014-04-15","2014-04-21","2014-04-25","2014-04-26","2014-04-27","2014-05-01","2014-05-03","2014-05-04","2014-05-05"],[1,1,2,1,1,1,2,1,1,1],[1,2,4,5,6,7,9,10,11,12]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>date_onset<\/th>\n      <th>n<\/th>\n      <th>cumulative_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Sau đó, cột tích lũy này có thể được vẽ dựa trên <code>date_onset</code>, sử dụng <code>geom_line()</code>:</p>
<div class="sourceCode" id="cb1584"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_cumulative</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">cumulative_case_counts</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, y <span class="op">=</span> <span class="va">cumulative_cases</span><span class="op">)</span>,
    size <span class="op">=</span> <span class="fl">2</span>,
    color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>

<span class="va">plot_cumulative</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1182-1.png" width="672"></div>
<p>Nó cũng có thể được phủ đè lên đường cong dịch bệnh, với trục kép bằng cách sử dụng phương pháp <strong>cowplot</strong> được mô tả ở trên và trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>:</p>
<div class="sourceCode" id="cb1585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#load package</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cowplot</span><span class="op">)</span>

<span class="co"># Make first plot of epicurve histogram</span>
<span class="va">plot_cases</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>          
    data <span class="op">=</span> <span class="va">linelist</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span>,
    binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    y <span class="op">=</span> <span class="st">"Daily cases"</span>,
    x <span class="op">=</span> <span class="st">"Date of symptom onset"</span>
  <span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span>

<span class="co"># make second plot of cumulative cases line</span>
<span class="va">plot_cumulative</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">cumulative_case_counts</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, y <span class="op">=</span> <span class="va">cumulative_cases</span><span class="op">)</span>,
    size <span class="op">=</span> <span class="fl">2</span>,
    color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>
    position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>,
       y <span class="op">=</span> <span class="st">"Cumulative cases"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_cowplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>
    axis.line.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Bây giờ sử dụng <strong>cowplot</strong> để chồng lên hai biểu đồ. Sự chú ý đã được tập trung vào việc căn chỉnh trục x, cạnh của trục y và việc sử dụng <code>theme_cowplot()</code>.</p>
<div class="sourceCode" id="cb1586"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aligned_plots</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/align_plots.html">align_plots</a></span><span class="op">(</span><span class="va">plot_cases</span>, <span class="va">plot_cumulative</span>, align<span class="op">=</span><span class="st">"hv"</span>, axis<span class="op">=</span><span class="st">"tblr"</span><span class="op">)</span>
<span class="fu">ggdraw</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">draw_plot</span><span class="op">(</span><span class="va">aligned_plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1184-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="nguồn-tham-khảo-2" class="section level2" number="32.8">
<h2>
<span class="header-section-number">32.8</span> Nguồn tham khảo<a class="anchor" aria-label="anchor" href="#ngu%E1%BB%93n-tham-kh%E1%BA%A3o-2"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="ggplot-tips.html"><span class="header-section-number">31</span> Các tips với ggplot</a></div>
<div class="next"><a href="age-pyramid.html"><span class="header-section-number">33</span> Tháp dân số và thang đo Likert</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#epicurves"><span class="header-section-number">32</span> Đường cong dịch bệnh</a></li>
<li>
<a class="nav-link" href="#chu%E1%BA%A9n-b%E1%BB%8B-23"><span class="header-section-number">32.1</span> Chuẩn bị</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#packages-3">Packages</a></li>
<li><a class="nav-link" href="#nh%E1%BA%ADp-d%E1%BB%AF-li%E1%BB%87u-17">Nhập dữ liệu</a></li>
<li><a class="nav-link" href="#thi%E1%BA%BFt-l%E1%BA%ADp-c%C3%A1c-tham-s%E1%BB%91">Thiết lập các tham số</a></li>
<li><a class="nav-link" href="#x%C3%A1c-minh-ng%C3%A0y">Xác minh ngày</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%C4%91%C6%B0%E1%BB%9Dng-cong-d%E1%BB%8Bch-b%E1%BB%87nh-v%E1%BB%9Bi-package-incidence2"><span class="header-section-number">32.2</span> Đường cong dịch bệnh với package incidence2</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#v%C3%AD-d%E1%BB%A5-%C4%91%C6%A1n-gi%E1%BA%A3n">Ví dụ đơn giản</a></li>
<li><a class="nav-link" href="#thay-%C4%91%E1%BB%95i-kho%E1%BA%A3ng-th%E1%BB%9Di-gian-t%E1%BB%95ng-h%E1%BB%A3p-ca-b%E1%BB%87nh">Thay đổi khoảng thời gian tổng hợp ca bệnh</a></li>
<li><a class="nav-link" href="#nh%C3%B3m-1">Nhóm</a></li>
<li><a class="nav-link" href="#l%E1%BB%8Dc-d%E1%BB%AF-li%E1%BB%87u">Lọc dữ liệu</a></li>
<li><a class="nav-link" href="#s%E1%BB%91-l%C6%B0%E1%BB%A3ng-t%E1%BB%95ng-h%E1%BB%A3p">Số lượng tổng hợp</a></li>
<li><a class="nav-link" href="#facetsc%C3%A1c-bi%E1%BB%83u-%C4%91%E1%BB%93-nh%E1%BB%8F">Facets/Các biểu đồ nhỏ</a></li>
<li><a class="nav-link" href="#hi%E1%BB%87u-ch%E1%BB%89nh-v%E1%BB%9Bi-plot">Hiệu chỉnh với plot()</a></li>
<li><a class="nav-link" href="#hi%E1%BB%87u-ch%E1%BB%89nh-v%E1%BB%9Bi-ggplot2">Hiệu chỉnh với ggplot2</a></li>
<li><a class="nav-link" href="#%C4%91%E1%BB%95i-m%C3%A0u">Đổi màu</a></li>
<li><a class="nav-link" href="#%C4%91i%E1%BB%81u-ch%E1%BB%89nh-th%E1%BB%A9-b%E1%BA%ADc">Điều chỉnh thứ bậc</a></li>
<li><a class="nav-link" href="#%C4%91%C6%B0%E1%BB%9Dng-l%C6%B0%E1%BB%9Bi-d%E1%BB%8Dc">Đường lưới dọc</a></li>
<li><a class="nav-link" href="#s%E1%BB%91-m%E1%BB%9Bi-m%E1%BA%AFc-t%C3%ADch-l%C5%A9y">Số mới mắc tích lũy</a></li>
<li><a class="nav-link" href="#trung-b%C3%ACnh-%C4%91%E1%BB%99ng">Trung bình động</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%C4%91%C6%B0%E1%BB%9Dng-cong-d%E1%BB%8Bch-b%E1%BB%87nh-v%E1%BB%9Bi-ggplot2"><span class="header-section-number">32.3</span> Đường cong dịch bệnh với ggplot2</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#x%C3%A1c-%C4%91%E1%BB%8Bnh-bins-c%E1%BB%A7a-s%E1%BB%91-li%E1%BB%87u">Xác định bins của số liệu</a></li>
<li><a class="nav-link" href="#v%C3%AD-d%E1%BB%A5-v%E1%BB%81-%C4%91%C6%B0%E1%BB%9Dng-cong-d%E1%BB%8Bch-b%E1%BB%87nh-theo-tu%E1%BA%A7n">Ví dụ về đường cong dịch bệnh theo tuần</a></li>
<li><a class="nav-link" href="#nh%C3%B3mt%C3%B4-m%C3%A0u-theo-gi%C3%A1-tr%E1%BB%8B">Nhóm/tô màu theo giá trị</a></li>
<li><a class="nav-link" href="#hi%E1%BB%87u-ch%E1%BB%89nh-m%C3%A0u">Hiệu chỉnh màu</a></li>
<li><a class="nav-link" href="#hi%E1%BB%87u-ch%E1%BB%89nh-th%E1%BB%A9-b%E1%BA%ADc">Hiệu chỉnh thứ bậc</a></li>
<li><a class="nav-link" href="#hi%E1%BB%87u-ch%E1%BB%89nh-ch%C3%BA-th%C3%ADch">Hiệu chỉnh chú thích</a></li>
<li><a class="nav-link" href="#c%E1%BB%99t-k%E1%BB%81-c%E1%BB%99t">Cột kề cột</a></li>
<li><a class="nav-link" href="#gi%E1%BB%9Bi-h%E1%BA%A1n-tr%E1%BB%A5c">Giới hạn trục</a></li>
<li><a class="nav-link" href="#nh%C3%A3n%C4%91%C6%B0%E1%BB%9Dng-l%C6%B0%E1%BB%9Bi-c%E1%BB%A7a-tr%E1%BB%A5c-ng%C3%A0y">Nhãn/đường lưới của trục ngày</a></li>
<li><a class="nav-link" href="#d%E1%BB%AF-li%E1%BB%87u-t%E1%BB%95ng-h%E1%BB%A3p">Dữ liệu tổng hợp</a></li>
<li><a class="nav-link" href="#%C4%91%C6%B0%E1%BB%9Dng-trung-b%C3%ACnh-%C4%91%E1%BB%99ng">Đường trung bình động</a></li>
<li><a class="nav-link" href="#facetingchia-nh%E1%BB%8F-bi%E1%BB%83u-%C4%91%E1%BB%93">Faceting/chia nhỏ biểu đồ</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#d%E1%BB%AF-li%E1%BB%87u-d%E1%BB%B1-ki%E1%BA%BFn"><span class="header-section-number">32.4</span> Dữ liệu dự kiến</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#s%E1%BB%AD-d%E1%BB%A5ng-annotate">Sử dụng annotate()</a></li>
<li><a class="nav-link" href="#m%C3%A0u-c%E1%BB%99t">Màu cột</a></li>
</ul>
</li>
<li><a class="nav-link" href="#nh%C3%A3n-ng%C3%A0y-nhi%E1%BB%81u-c%E1%BA%A5p-%C4%91%E1%BB%99"><span class="header-section-number">32.5</span> Nhãn ngày nhiều cấp độ</a></li>
<li><a class="nav-link" href="#tr%E1%BB%A5c-k%C3%A9p-1"><span class="header-section-number">32.6</span> Trục kép</a></li>
<li><a class="nav-link" href="#s%E1%BB%91-m%E1%BB%9Bi-m%E1%BA%AFc-t%C3%ADch-l%C5%A9y-1"><span class="header-section-number">32.7</span> Số mới mắc tích lũy</a></li>
<li><a class="nav-link" href="#ngu%E1%BB%93n-tham-kh%E1%BA%A3o-2"><span class="header-section-number">32.8</span> Nguồn tham khảo</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Cẩm nang dịch tễ học với R</strong>" was written by the handbook team. It was last built on 2021-11-01.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
