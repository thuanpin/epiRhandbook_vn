<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>21 Tỷ suất chuẩn hóa | Cẩm nang dịch tễ học với R</title>
<meta name="author" content="the handbook team">
<meta name="description" content="Chương này sẽ hướng dẫn hai cách để chuẩn hóa một kết quả như là tỷ suất tử vong hoặc nhập viện theo các đặc điểm của tuổi và giới. Sử dụng package dsr Sử dụng package PHEindicatormethods Chúng ta...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="21 Tỷ suất chuẩn hóa | Cẩm nang dịch tễ học với R">
<meta property="og:type" content="book">
<meta property="og:description" content="Chương này sẽ hướng dẫn hai cách để chuẩn hóa một kết quả như là tỷ suất tử vong hoặc nhập viện theo các đặc điểm của tuổi và giới. Sử dụng package dsr Sử dụng package PHEindicatormethods Chúng ta...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="21 Tỷ suất chuẩn hóa | Cẩm nang dịch tễ học với R">
<meta name="twitter:description" content="Chương này sẽ hướng dẫn hai cách để chuẩn hóa một kết quả như là tỷ suất tử vong hoặc nhập viện theo các đặc điểm của tuổi và giới. Sử dụng package dsr Sử dụng package PHEindicatormethods Chúng ta...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.19/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-8.1.2/highcharts.js"></script><script src="libs/highcharts-8.1.2/highcharts-3d.js"></script><script src="libs/highcharts-8.1.2/highcharts-more.js"></script><script src="libs/highcharts-8.1.2/modules/stock.js"></script><script src="libs/highcharts-8.1.2/modules/map.js"></script><script src="libs/highcharts-8.1.2/modules/annotations.js"></script><script src="libs/highcharts-8.1.2/modules/data.js"></script><script src="libs/highcharts-8.1.2/modules/drilldown.js"></script><script src="libs/highcharts-8.1.2/modules/item-series.js"></script><script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script><script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-8.1.2/modules/exporting.js"></script><script src="libs/highcharts-8.1.2/modules/export-data.js"></script><script src="libs/highcharts-8.1.2/modules/funnel.js"></script><script src="libs/highcharts-8.1.2/modules/heatmap.js"></script><script src="libs/highcharts-8.1.2/modules/treemap.js"></script><script src="libs/highcharts-8.1.2/modules/sankey.js"></script><script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script><script src="libs/highcharts-8.1.2/modules/organization.js"></script><script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script><script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script><script src="libs/highcharts-8.1.2/modules/sunburst.js"></script><script src="libs/highcharts-8.1.2/modules/vector.js"></script><script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script><script src="libs/highcharts-8.1.2/modules/xrange.js"></script><script src="libs/highcharts-8.1.2/modules/tilemap.js"></script><script src="libs/highcharts-8.1.2/modules/venn.js"></script><script src="libs/highcharts-8.1.2/modules/gantt.js"></script><script src="libs/highcharts-8.1.2/modules/timeline.js"></script><script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script><script src="libs/highcharts-8.1.2/modules/bullet.js"></script><script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script><script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script><script src="libs/highcharts-8.1.2/modules/lollipop.js"></script><script src="libs/highcharts-8.1.2/modules/series-label.js"></script><script src="libs/highcharts-8.1.2/plugins/motion.js"></script><script src="libs/highcharts-8.1.2/custom/reset.js"></script><script src="libs/highcharts-8.1.2/modules/boost.js"></script><script src="libs/highchart-binding-0.8.2/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Cẩm nang dịch tễ học với R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Về cuốn sách này</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> Biên tập và ghi chú kỹ thuật</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> Tải sách và dữ liệu</a></li>
<li class="book-part">Nhập môn về R</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R Cơ bản</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Chuyển đổi sang R</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> Package đề xuất</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Dự án R</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> Nhập xuất dữ liệu</a></li>
<li class="book-part">Quản lý dữ liệu</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> Làm sạch số liệu và các hàm quan trọng</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> Làm việc với ngày tháng</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> Ký tự và chuỗi</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Factors</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> Xoay trục dữ liệu</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> Nhóm dữ liệu</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> Nối dữ liệu</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> Loại bỏ trùng lặp</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Lặp, vòng lặp, và danh sách</a></li>
<li class="book-part">Phân tích dữ liệu</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> Bảng mô tả</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> Các kiểm định thống kê cơ bản</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Hồi quy đơn và đa biến</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Dữ liệu Missing</a></li>
<li><a class="active" href="standardization.html"><span class="header-section-number">21</span> Tỷ suất chuẩn hóa</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> Đường trung bình động</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> Chuỗi thời gian và phát hiện ổ dịch</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> Mô hình hóa dịch bệnh</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> Truy vết tiếp xúc</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> Phân tích khảo sát</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> Phân tích sống còn</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS cơ bản</a></li>
<li class="book-part">Trực quan hóa dữ liệu</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> Trình bày bảng</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot cơ bản</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> Các tips với ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> Đường cong dịch bệnh</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> Tháp dân số và thang đo Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> Biểu đồ nhiệt</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> Sơ đồ và biểu đồ</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> Biểu đồ kết hợp</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Chuỗi lây nhiễm</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> Cây phả hệ</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Biểu đồ tương tác</a></li>
<li class="book-part">Báo cáo và dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> Báo cáo với R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> Tổ chức báo cáo định kỳ</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> Dashboards với R Markdown</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Dashboards với Shiny</a></li>
<li class="book-part">Tổng hợp</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> Viết hàm</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> Tương tác với thư mục làm việc</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Version control với Git và Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> Các lỗi thường gặp</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> Nhờ sự trợ giúp</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> R trên ổ cứng mạng</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> Data Table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="standardization" class="section level1" number="21">
<h1>
<span class="header-section-number">21</span> Tỷ suất chuẩn hóa<a class="anchor" aria-label="anchor" href="#standardization"><i class="fas fa-link"></i></a>
</h1>
<p>Chương này sẽ hướng dẫn hai cách để chuẩn hóa một kết quả như là tỷ suất tử vong hoặc nhập viện theo các đặc điểm của tuổi và giới.</p>
<ul>
<li>Sử dụng package <strong>dsr</strong>
</li>
<li>Sử dụng package <strong>PHEindicatormethods</strong>
</li>
</ul>
<p>Chúng ta bắt đầu bằng cách làm rõ quá trình chuẩn bị/làm sạch/kết nối số liệu, vì việc này thường được thực hiện khi kết nối số liệu dân số từ nhiều quốc gia, số liệu dân số chuẩn, tử vong,.v.v.</p>
<div id="tổng-quan-1" class="section level2" number="21.1">
<h2>
<span class="header-section-number">21.1</span> Tổng quan<a class="anchor" aria-label="anchor" href="#t%E1%BB%95ng-quan-1"><i class="fas fa-link"></i></a>
</h2>
<p>Có hai cách để chuẩn hóa: trực tiếp và gián tiếp. Giả sử chúng ta muốn chuẩn hóa tỷ suất tử vong theo tuổi và giới của quốc gia A và quốc gia B, và so sánh tỷ suất chuẩn hóa giữa hai quốc gia này</p>
<ul>
<li>Đối với chuẩn hóa trực tiếp, chúng ta phải biết dân số nguy cơ và số tử vong theo từng tầng của tuổi và giới của quốc gia A và B. Một tầng trong ví dụ của chúng ta là phụ nữ trong nhóm tuổi từ 15-44.<br>
</li>
<li>Đối với chuẩn hóa gián tiếp, chúng ta chỉ cần biết tổng số tử vong và cấu trúc tuổi và giới của mỗi quốc gia. Vì thế, phương án này là khả khi tỷ suất tử vong hoặc dân số theo tuổi và giới không có sẵn. Hơn nữa, chuẩn hóa gián tiếp được ưa chuộng hơn khi có số lượng nhỏ trong các tầng, vì các ước tính trong chuẩn hóa trực tiếp sẽ bị ảnh hưởng bởi các thay đổi quan trọng khi lấy mẫu.</li>
</ul>
<!-- ======================================================= -->
</div>
<div id="chuẩn-bị-11" class="section level2" number="21.2">
<h2>
<span class="header-section-number">21.2</span> Chuẩn bị<a class="anchor" aria-label="anchor" href="#chu%E1%BA%A9n-b%E1%BB%8B-11"><i class="fas fa-link"></i></a>
</h2>
<p>Để chỉ dẫn cách thực hiện chuẩn hóa, chúng ta tạo ra dân số và số tử vong của quốc gia A và B theo tuổi (trong các nhóm tuổi của mỗi 5 tuổi) và giới (nữ, nam). Để các bộ số liệu có thể sử dụng được, chúng ta sẽ thực hiện các bước chuẩn bị như sau:</p>
<ol style="list-style-type: decimal">
<li>Gọi các packages<br>
</li>
<li>Tải các bộ số liệu<br>
</li>
<li>Nối số liệu dân số và tử vong của hai quốc gia</li>
<li>Xoay trục bộ số liệu dọc/dài hơn để có một hàng là một tầng theo tuổi-giới</li>
<li>Làm sạch quần thể tham chiếu (dân số thế giới chuẩn) và kết nối nó với số liệu của quốc gia</li>
</ol>
<p>Trong trường hợp này, số liệu của chúng ta có thể có các định dạng khác nhau. Có lẽ số liệu của chúng ta theo tỉnh, thành phố, hoặc khu vực dịch vụ khác. Chúng ta có thể có một hàng cho mỗi ca tử vong và các thông tin về tuổi và giới cho mỗi trường hợp (hoặc một tỷ lệ có ý nghĩa) của các ca tử vong này. Trong trường hợp này, hãy xem các chương về <a href="grouping.html#grouping">Nhóm dữ liệu</a>, <a href="pivoting.html#pivoting">Xoay trục dữ liệu</a>, và <a href="tables-descriptive.html#tables-descriptive">Bảng mô tả</a> để tạo một bộ số liệu với số lượng tử vong và dân số theo tầng của tuổi-giới tính.</p>
<p>Chúng ta cũng cần một quần thể tham chiếu, dân số chuẩn. Với mục đích của thực hành này, chúng ta sẽ sử dụng bộ số liệu <code>world_standard_population_by_sex</code>. Dân số chuẩn này dựa trên dân số của 46 quốc gia và được tạo ra vào năm 1960. Có rất nhiều dân số “chuẩn” – ví dụ, trang web của <a href="https://www.opendata.nhs.scot/dataset/standard-populations">NHS Scotland</a> cung cấp khá nhiều thông tin về Dân số Chuẩn của châu u, Dân số Chuẩn Thế giới, Dân số Chuẩn của Scotland.</p>
<!-- ======================================================= -->
<div id="gọi-packages-6" class="section level3 unnumbered">
<h3>Gọi packages<a class="anchor" aria-label="anchor" href="#g%E1%BB%8Di-packages-6"><i class="fas fa-link"></i></a>
</h3>
<p>Đoạn code này hiển thị việc gọi các package cần thiết cho các phân tích. Trong cuốn sách này, chúng tôi nhấn mạnh việc sử dụng hàm <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> từ package <strong>pacman</strong>, giúp cài đặt các package cần thiết <em>và</em> gọi chúng ra để sử dụng. Bạn cũng có thể gọi các packages đã cài đặt với hàm <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> của <strong>base</strong> R. Xem thêm chương <a href="basics.html#basics">R cơ bản</a> để có thêm thông tin về các packages trong R.</p>
<div class="sourceCode" id="cb1080"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
     <span class="va">rio</span>,                 <span class="co"># import/export data</span>
     <span class="va">here</span>,                <span class="co"># locate files</span>
     <span class="va">tidyverse</span>,           <span class="co"># data management and visualization</span>
     <span class="va">stringr</span>,             <span class="co"># cleaning characters and strings</span>
     <span class="va">frailtypack</span>,         <span class="co"># needed for dsr, for frailty models</span>
     <span class="va">dsr</span>,                 <span class="co"># standardise rates</span>
     <span class="va">PHEindicatormethods</span><span class="op">)</span> <span class="co"># alternative for rate standardisation</span></code></pre></div>
<p><span style="color: orange;"><strong><em>CẨN TRỌNG:</em></strong> Nếu đang sử dụng một phiên bản mới hơn của R, chúng ta không thể tải gói lệnh <strong>dsr</strong> trực tiếp từ CRAN. Tuy nhiên, nó vẫn còn trong mục lưu trữ của CRAN. Chúng ta có thể cài đặt và sử dụng nó. </span></p>
<p>Đối với người không sử dụng hệ điều hành Mac:</p>
<div class="sourceCode" id="cb1081"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">packageurl</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/src/contrib/Archive/dsr/dsr_0.2.2.tar.gz"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">packageurl</span>, repos<span class="op">=</span><span class="cn">NULL</span>, type<span class="op">=</span><span class="st">"source"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb1082"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Other solution that may work</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_version</a></span><span class="op">(</span><span class="st">"dsr"</span>, version<span class="op">=</span><span class="st">"0.2.2"</span>, repos<span class="op">=</span><span class="st">"http:/cran.us.r.project.org"</span><span class="op">)</span></code></pre></div>
<p>Đối với người sử dụng hệ điều hành Mac:</p>
<div class="sourceCode" id="cb1083"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_version</a></span><span class="op">(</span><span class="st">"dsr"</span>, version<span class="op">=</span><span class="st">"0.2.2"</span>, repos<span class="op">=</span><span class="st">"https://mac.R-project.org"</span><span class="op">)</span></code></pre></div>
</div>
<div id="tải-số-liệu-dân-số" class="section level3 unnumbered">
<h3>Tải số liệu dân số<a class="anchor" aria-label="anchor" href="#t%E1%BA%A3i-s%E1%BB%91-li%E1%BB%87u-d%C3%A2n-s%E1%BB%91"><i class="fas fa-link"></i></a>
</h3>
<p>Xem chương <a href="data-used.html#data-used">Tải sách và dữ liệu</a> để biết các hướng dẫn về cách tải tất cả các bộ số liệu mẫu trong cuốn số tay này. Chúng ta có thể nhập trực tiếp dữ liệu trong chương Chuẩn hóa này tới R thông qua kho lưu trữ Github của chúng tôi bằng cách thực hiện lệnh sau <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code>:</p>
<div class="sourceCode" id="cb1084"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import demographics for country A directly from Github</span>
<span class="va">A_demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"https://github.com/appliedepi/epirhandbook_eng/raw/master/data/standardization/country_demographics.csv"</span><span class="op">)</span>

<span class="co"># import deaths for country A directly from Github</span>
<span class="va">A_deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"https://github.com/appliedepi/epirhandbook_eng/raw/master/data/standardization/deaths_countryA.csv"</span><span class="op">)</span>

<span class="co"># import demographics for country B directly from Github</span>
<span class="va">B_demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"https://github.com/appliedepi/epirhandbook_eng/raw/master/data/standardization/country_demographics_2.csv"</span><span class="op">)</span>

<span class="co"># import deaths for country B directly from Github</span>
<span class="va">B_deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/standardization/deaths_countryB.csv"</span><span class="op">)</span>

<span class="co"># import demographics for country B directly from Github</span>
<span class="va">standard_pop_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/standardization/world_standard_population_by_sex.csv"</span><span class="op">)</span></code></pre></div>
<p>Trước tiên, chúng ta tải số liệu nhân khẩu (số lượng nam và nữ theo nhóm mỗi 5 tuổi) của hai quốc gia mà chúng ta sẽ so sánh, “Quốc gia A” và “Quốc gia B”.</p>
<div class="sourceCode" id="cb1085"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Country A</span>
<span class="va">A_demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"country_demographics.csv"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-44f3bd369a774d323c55" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-44f3bd369a774d323c55">{"x":{"filter":"none","vertical":false,"data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[7828087,6705882,5601230,4576430,3734111,3111651,2571215,2121247,1735468,1418749,1145345,900239,685141,500248,347093,202240,94325,40402],[7674675,6592449,5522555,4533885,3726537,3118040,2592416,2150490,1771213,1459439,1193903,956070,745682,563894,416543,258538,130479,64656]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>m<\/th>\n      <th>f<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb1086"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Country B</span>
<span class="va">B_demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"country_demographics_2.csv"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-f2e805fd96a3c9683515" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f2e805fd96a3c9683515">{"x":{"filter":"none","vertical":false,"data":[["B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[513458,508728,673522,844532,965423,1243552,1400065,1428773,1546221,1562880,2355220,2324555,2988200,2527110,1552200,1466902,876251,1073611],[503262,559249,652455,145453,965237,1238640,1392676,1505040,1671213,1459439,2218733,3528103,3204770,2500130,1683925,1683828,987362,1147563]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>m<\/th>\n      <th>f<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="tải-số-liệu-tử-vong" class="section level3 unnumbered">
<h3>Tải số liệu tử vong<a class="anchor" aria-label="anchor" href="#t%E1%BA%A3i-s%E1%BB%91-li%E1%BB%87u-t%E1%BB%AD-vong"><i class="fas fa-link"></i></a>
</h3>
<p>Để thuận tiện cho việc thực hành, chúng ta cũng có số lượng tử vong theo tuổi và giới trong khoảng thời gian quan tâm. Số lượng tử vong của mỗi quốc gia nằm trong một tập tin riêng, được hiện thị bên dưới.</p>
<p>Số tử vong ở Quốc gia A</p>
<div id="htmlwidget-a5b3b9dbcd6f1bc3593b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a5b3b9dbcd6f1bc3593b">{"x":{"filter":"none","vertical":false,"data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[224,257,251,245,334,245,154,189,334,342,565,432,543,432,245,543,234,354],[194,254,232,214,316,224,163,167,354,354,463,574,493,295,175,380,177,392]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>AgeCat<\/th>\n      <th>Male<\/th>\n      <th>Female<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Số tử vong ở Quốc gia B</p>
<div id="htmlwidget-56395875b66efe3141d9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-56395875b66efe3141d9">{"x":{"filter":"none","vertical":false,"data":[["B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[34,37,51,145,434,120,100,143,307,354,463,639,706,232,275,543,234,274],[54,24,32,154,276,254,123,164,254,354,453,654,435,354,165,432,287,395]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>AgeCat<\/th>\n      <th>Male<\/th>\n      <th>Female<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="làm-sạch-số-liệu-dân-số-và-tử-vong" class="section level3 unnumbered">
<h3>Làm sạch số liệu dân số và tử vong<a class="anchor" aria-label="anchor" href="#l%C3%A0m-s%E1%BA%A1ch-s%E1%BB%91-li%E1%BB%87u-d%C3%A2n-s%E1%BB%91-v%C3%A0-t%E1%BB%AD-vong"><i class="fas fa-link"></i></a>
</h3>
<p>Chúng ta cần kết nối và chuyển đổi các số liệu này theo những cách sau:</p>
<ul>
<li>Liên kết dân số của các quốc gia vào một bộ số liệu và xoay trục thành bộ số liệu dạng “dọc/dài” để mỗi tầng tuổi-giới là một hàng<br>
</li>
<li>Liên kết số liệu tử vong của các quốc gia vào một bộ số liệu và xoay trục thành bộ số liệu dạng “dọc/dài” để mỗi tầng tuổi-giới là một hàng<br>
</li>
<li>Nối số liệu tử vong với số liệu dân số</li>
</ul>
<p>Đầu tiên, chúng ta liên kết các bộ số liệu dân số quốc gia, chuyển đổi thành số liệu dạng dọc/dài hơn, và làm sạch số liệu. Xem chương <a href="pivoting.html#pivoting">Xoay trục dữ liệu</a> để biết thêm chi tiết.</p>
<div class="sourceCode" id="cb1087"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pop_countries</span> <span class="op">&lt;-</span> <span class="va">A_demo</span> <span class="op">%&gt;%</span>  <span class="co"># begin with country A dataset</span>
     <span class="fu">bind_rows</span><span class="op">(</span><span class="va">B_demo</span><span class="op">)</span> <span class="op">%&gt;%</span>        <span class="co"># bind rows, because cols are identically named</span>
     <span class="fu">pivot_longer</span><span class="op">(</span>                       <span class="co"># pivot longer</span>
          cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">f</span><span class="op">)</span>,                   <span class="co"># columns to combine into one</span>
          names_to <span class="op">=</span> <span class="st">"Sex"</span>,                 <span class="co"># name for new column containing the category ("m" or "f") </span>
          values_to <span class="op">=</span> <span class="st">"Population"</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># name for new column containing the numeric values pivoted</span>
     <span class="fu">mutate</span><span class="op">(</span>Sex <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">Sex</span>,            <span class="co"># re-code values for clarity</span>
          <span class="st">"m"</span> <span class="op">=</span> <span class="st">"Male"</span>,
          <span class="st">"f"</span> <span class="op">=</span> <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Số liệu dân số đã liên kết bây giờ trông giống như sau (nhấp qua để xem cột quốc gia A và B):</p>
<div id="htmlwidget-5df1f343d8165670f66a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5df1f343d8165670f66a">{"x":{"filter":"none","vertical":false,"data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656,513458,503262,508728,559249,673522,652455,844532,145453,965423,965237,1243552,1238640,1400065,1392676,1428773,1505040,1546221,1671213,1562880,1459439,2355220,2218733,2324555,3528103,2988200,3204770,2527110,2500130,1552200,1683925,1466902,1683828,876251,987362,1073611,1147563]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Population<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Và bây giờ, chúng ta thực hiện các thao tác tương tự trên hai bộ số liệu tử vong.</p>
<div class="sourceCode" id="cb1088"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">deaths_countries</span> <span class="op">&lt;-</span> <span class="va">A_deaths</span> <span class="op">%&gt;%</span>    <span class="co"># begin with country A deaths dataset</span>
     <span class="fu">bind_rows</span><span class="op">(</span><span class="va">B_deaths</span><span class="op">)</span> <span class="op">%&gt;%</span>        <span class="co"># bind rows with B dataset, because cols are identically named</span>
     <span class="fu">pivot_longer</span><span class="op">(</span>                  <span class="co"># pivot longer</span>
          cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Male</span>, <span class="va">Female</span><span class="op">)</span>,        <span class="co"># column to transform into one</span>
          names_to <span class="op">=</span> <span class="st">"Sex"</span>,              <span class="co"># name for new column containing the category ("m" or "f") </span>
          values_to <span class="op">=</span> <span class="st">"Deaths"</span><span class="op">)</span> <span class="op">%&gt;%</span>      <span class="co"># name for new column containing the numeric values pivoted</span>
     <span class="fu">rename</span><span class="op">(</span>age_cat5 <span class="op">=</span> <span class="va">AgeCat</span><span class="op">)</span>      <span class="co"># rename for clarity</span></code></pre></div>
<p>Số liệu tử vong bây giờ trông giống như sau và chứa số liệu của cả hai quốc gia:</p>
<div id="htmlwidget-1d74ae25aef6a13c7b3b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1d74ae25aef6a13c7b3b">{"x":{"filter":"none","vertical":false,"data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[224,194,257,254,251,232,245,214,334,316,245,224,154,163,189,167,334,354,342,354,565,463,432,574,543,493,432,295,245,175,543,380,234,177,354,392,34,54,37,24,51,32,145,154,434,276,120,254,100,123,143,164,307,254,354,354,463,453,639,654,706,435,232,354,275,165,543,432,234,287,274,395]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Bây giờ, chúng ta nối số liệu tử vong và số liệu dân số dựa trên các cột chung <code>Country</code>, <code>age_cat5</code>, và <code>Sex</code>. Thao tác này sẽ thêm cột <code>Deaths</code>.</p>
<div class="sourceCode" id="cb1089"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">country_data</span> <span class="op">&lt;-</span> <span class="va">pop_countries</span> <span class="op">%&gt;%</span> 
     <span class="fu">left_join</span><span class="op">(</span><span class="va">deaths_countries</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"age_cat5"</span>, <span class="st">"Sex"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Bây giờ, chúng ta có thể phân loại các biến số <code>Sex</code>, <code>age_cat5</code>, và <code>Country</code> thành dạng factors và đặt thứ tự các giá trị của biến số bằng cách sử dụng hàm <code>fct_relevel()</code> từ package <strong>forcats</strong>, như được mô tả trong chương <a href="factors.html#factors">Factors</a>. Lưu ý rằng việc phân loại giá trị biến không thay đổi số liệu một cách rõ ràng, nhưng lệnh <code>arrange()</code> sẽ sắp xếp nó theo Quốc gia, nhóm tuổi và giới tính.</p>
<div class="sourceCode" id="cb1090"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">country_data</span> <span class="op">&lt;-</span> <span class="va">country_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    Country <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">Country</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,
      
    Sex <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">Sex</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span>,
        
    age_cat5 <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span>
      <span class="va">age_cat5</span>,
      <span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>,
      <span class="st">"20-24"</span>, <span class="st">"25-29"</span>,  <span class="st">"30-34"</span>, <span class="st">"35-39"</span>,
      <span class="st">"40-44"</span>, <span class="st">"45-49"</span>, <span class="st">"50-54"</span>, <span class="st">"55-59"</span>,
      <span class="st">"60-64"</span>, <span class="st">"65-69"</span>, <span class="st">"70-74"</span>,
      <span class="st">"75-79"</span>, <span class="st">"80-84"</span>, <span class="st">"85"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
          
  <span class="fu">arrange</span><span class="op">(</span><span class="va">Country</span>, <span class="va">age_cat5</span>, <span class="va">Sex</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-ad1d5d4bd2264c0c84bd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ad1d5d4bd2264c0c84bd">{"x":{"filter":"none","vertical":false,"data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656,513458,503262,508728,559249,673522,652455,844532,145453,965423,965237,1243552,1238640,1400065,1392676,1428773,1505040,1546221,1671213,1562880,1459439,2355220,2218733,2324555,3528103,2988200,3204770,2527110,2500130,1552200,1683925,1466902,1683828,876251,987362,1073611,1147563],[224,194,257,254,251,232,245,214,334,316,245,224,154,163,189,167,334,354,342,354,565,463,432,574,543,493,432,295,245,175,543,380,234,177,354,392,34,54,37,24,51,32,145,154,434,276,120,254,100,123,143,164,307,254,354,354,463,453,639,654,706,435,232,354,275,165,543,432,234,287,274,395]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Population<\/th>\n      <th>Deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><span style="color: orange;"><strong><em>CẨN TRỌNG:</em></strong> Nếu số trường hợp tử vong mỗi tầng là nhỏ, hãy cân nhắc chia nhóm tuổi mỗi 10-15 năm thay vì mỗi 5 năm cho các nhóm.</span></p>
</div>
<div id="tải-dân-số-tham-chiếu" class="section level3 unnumbered">
<h3>Tải dân số tham chiếu<a class="anchor" aria-label="anchor" href="#t%E1%BA%A3i-d%C3%A2n-s%E1%BB%91-tham-chi%E1%BA%BFu"><i class="fas fa-link"></i></a>
</h3>
<p>Cuối cùng, để chuẩn hóa trực tiếp, chúng ta nhập dân số tham chiếu (“dân số chuẩn” thế giới theo giới tính)</p>
<div class="sourceCode" id="cb1091"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Reference population</span>
<span class="va">standard_pop_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"world_standard_population_by_sex.csv"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-90cf58ffa85be3e536b5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-90cf58ffa85be3e536b5">{"x":{"filter":"none","vertical":false,"data":[["0-4 years","0-4 years","5-9 years","5-9 years","10-14 years","10-14 years","15-19 years","15-19 years","20-24 years","20-24 years","25-29 years","25-29 years","30-34 years","30-34 years","35-39 years","35-39 years","40-44 years","40-44 years","45-49 years","45-49 years","50-54 years","50-54 years","55-59 years","55-59 years","60-64 years","60-64 years","65-69 years","65-69 years","70-74 years","70-74 years","75-79 years","75-79 years","80-84 years","80-84 years","85plus years","85plus years"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[12000,12000,10000,10000,9000,9000,9000,9000,8000,8000,8000,8000,6000,6000,6000,6000,6000,6000,6000,6000,5000,5000,4000,4000,4000,4000,3000,3000,2000,2000,1000,1000,500,500,500,500]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>WorldStandardPopulation<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="làm-sach-dân-số-tham-chiếu" class="section level3 unnumbered">
<h3>Làm sach dân số tham chiếu<a class="anchor" aria-label="anchor" href="#l%C3%A0m-sach-d%C3%A2n-s%E1%BB%91-tham-chi%E1%BA%BFu"><i class="fas fa-link"></i></a>
</h3>
<p>Các giá trị của biến tuổi trong bộ số liệu <code>country_data</code> và <code>standard_pop_data</code> cần phải được căn chỉnh.</p>
<p>Hiện tại, các giá trị của cột biến phân loại <code>age_cat5</code> trong bộ số liệu <code>standard_pop_data</code> có chứa từ “years” và “plus”, trong khi không có các từ này trong trong bộ số liệu <code>country_data</code>. Chúng ta cần phải chuyển đổi các giá trị này giống nhau. Chúng ta sẽ sử dụng hàm <code>str_replace_all()</code> từ package <strong>stringr</strong>, như được mô tả trong chương <a href="characters-strings.html#characters-strings">Ký tự và chuỗi</a>, để thay thế thành những kiểu mẫu không có khoảng trắng <code>""</code>.</p>
<p>Hơn nữa, package <strong>dsr</strong> đòi hỏi cột chứa số lượng trong bộ số liệu dân số chuẩn phải được gọi là <code>"pop"</code>. Vì vậy, chúng ta đổi tên cột này cho phù hợp.</p>
<div class="sourceCode" id="cb1092"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Remove specific string from column values</span>
<span class="va">standard_pop_clean</span> <span class="op">&lt;-</span> <span class="va">standard_pop_data</span> <span class="op">%&gt;%</span>
     <span class="fu">mutate</span><span class="op">(</span>
          age_cat5 <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="va">age_cat5</span>, <span class="st">"years"</span>, <span class="st">""</span><span class="op">)</span>,   <span class="co"># remove "year"</span>
          age_cat5 <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="va">age_cat5</span>, <span class="st">"plus"</span>, <span class="st">""</span><span class="op">)</span>,    <span class="co"># remove "plus"</span>
          age_cat5 <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="va">age_cat5</span>, <span class="st">" "</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># remove " " space</span>
     
     <span class="fu">rename</span><span class="op">(</span>pop <span class="op">=</span> <span class="va">WorldStandardPopulation</span><span class="op">)</span>   <span class="co"># change col name to "pop", as this is expected by dsr package</span></code></pre></div>
<p><span style="color: orange;"><strong><em>CẨN TRỌNG:</em></strong> Nếu chúng ta cố gắng sử dụng hàm <code>str_replace_all()</code> để loại bỏ <em>biểu tượng</em> dấu cộng, hàm này sẽ không thực hiện bởi vì nó là một biểu tượng đặc biệt. “Xử lý” các biểu tượng này bằng cách đặt hai dấu gạch chéo phía trước như trong lệnh <code>str_replace_call(column, "\\+", "")</code>. </span></p>
</div>
<div id="standard_all" class="section level3 unnumbered">
<h3>Tạo bộ số liệu với dân số chuẩn<a class="anchor" aria-label="anchor" href="#standard_all"><i class="fas fa-link"></i></a>
</h3>
<p>Cuối cùng, sử dụng package <strong>PHEindicatormethods</strong>, được trình bày chi tiết <a href="standardization.html#standard_phe">bên dưới</a>, để nối dân số chuẩn vào biến tử vong và dân số của các quốc gia. Vì vậy, chúng ta sẽ tạo một bộ số liệu với tên <code>all_data</code> cho mục đích đó.</p>
<div class="sourceCode" id="cb1093"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_data</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">country_data</span>, <span class="va">standard_pop_clean</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age_cat5"</span>, <span class="st">"Sex"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Bộ số liệu hoàn chỉnh trông sẽ như thế này:</p>
<div id="htmlwidget-d5cf6c309cf1fdc6f43e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d5cf6c309cf1fdc6f43e">{"x":{"filter":"none","vertical":false,"data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656,513458,503262,508728,559249,673522,652455,844532,145453,965423,965237,1243552,1238640,1400065,1392676,1428773,1505040,1546221,1671213,1562880,1459439,2355220,2218733,2324555,3528103,2988200,3204770,2527110,2500130,1552200,1683925,1466902,1683828,876251,987362,1073611,1147563],[224,194,257,254,251,232,245,214,334,316,245,224,154,163,189,167,334,354,342,354,565,463,432,574,543,493,432,295,245,175,543,380,234,177,354,392,34,54,37,24,51,32,145,154,434,276,120,254,100,123,143,164,307,254,354,354,463,453,639,654,706,435,232,354,275,165,543,432,234,287,274,395],[12000,12000,10000,10000,9000,9000,9000,9000,8000,8000,8000,8000,6000,6000,6000,6000,6000,6000,6000,6000,5000,5000,4000,4000,4000,4000,3000,3000,2000,2000,1000,1000,500,500,500,500,12000,12000,10000,10000,9000,9000,9000,9000,8000,8000,8000,8000,6000,6000,6000,6000,6000,6000,6000,6000,5000,5000,4000,4000,4000,4000,3000,3000,2000,2000,1000,1000,500,500,500,500]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Population<\/th>\n      <th>Deaths<\/th>\n      <th>pop<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="package-dsr" class="section level2" number="21.3">
<h2>
<span class="header-section-number">21.3</span> Package <strong>dsr</strong><a class="anchor" aria-label="anchor" href="#package-dsr"><i class="fas fa-link"></i></a>
</h2>
<p>Bên dưới, chúng tôi trình bày việc tính toán và so sánh các tỷ suất được chuẩn hóa trực tiếp bằng cách sử dụng package <strong>dsr</strong>. Package <strong>dsr</strong> cho phép chúng ta tính toán và so sánh các tỷ suất được chuẩn hóa trực tiếp (không phải các tỷ suất được chuẩn hóa gián tiếp!).</p>
<p>Trong phần Chuẩn bị số liệu, chúng ta đã tạo các bộ số liệu riêng biệt cho các quốc gia và dân số chuẩn:</p>
<ol style="list-style-type: decimal">
<li>đối tượng <code>country_data</code> mà là một bảng dân số với số lượng dân số và số tử vong theo tầng cho mỗi quốc gia<br>
</li>
<li>đối tượng <code>standard_pop_clean</code>, bao gồm số lượng dân số theo tầng cho dân số tham chiếu, Dân số Chuẩn Thế giới</li>
</ol>
<p>Chúng ta sẽ sử dụng các bộ số liệu riêng rẽ này cho cách tiếp cận sử dụng package <strong>dsr</strong>.</p>
<!-- ======================================================= -->
<div id="tỷ-suất-chuẩn-hóa" class="section level3 unnumbered">
<h3>Tỷ suất chuẩn hóa<a class="anchor" aria-label="anchor" href="#t%E1%BB%B7-su%E1%BA%A5t-chu%E1%BA%A9n-h%C3%B3a"><i class="fas fa-link"></i></a>
</h3>
<p>Bên dưới, chúng ta tính toán các tỷ suất theo quốc gia được chuẩn hóa trực tiếp theo tuổi và giới. Chúng ta sử dụng hàm <code>dsr()</code>.</p>
<p>Lưu ý - <code>dsr()</code> đòi hỏi một bộ số liệu dân số của các quốc gia và số lượng sự kiện (tử vong), <em>và một bộ số liệu</em> <strong>riêng rẽ</strong> <em>với dân số tham chiếu</em>. Nó cũng đòi hỏi trong bộ số liệu của dân số tham chiếu này tên cột đơn vị-thời gian là “pop” (chúng ta đã đảm bảo điều này trong phần Chuẩn bị số liệu).</p>
<p>Có nhiều đối số, như được chú thích bên dưới. Đáng chú ý, đối số <code>event =</code> được đặt thành cột <code>Deaths</code>, và đối số <code>fu =</code> (“follow-up”) được đặt thành cột <code>Population</code>. Chúng ta đặt các nhóm so sánh là cột <code>Country</code> và chuẩn hóa dựa trên cột <code>age_cat5</code> và <code>Sex</code>. Hai cột cuối cùng này không được gán với một đối số có tên cụ thể. Gõ <code>?dsr</code> để biết thêm chi tiết.</p>
<div class="sourceCode" id="cb1094"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate rates per country directly standardized for age and sex</span>
<span class="va">mortality_rate</span> <span class="op">&lt;-</span> <span class="fu">dsr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dsr/man/dsr.html">dsr</a></span><span class="op">(</span>
     data <span class="op">=</span> <span class="va">country_data</span>,  <span class="co"># specify object containing number of deaths per stratum</span>
     event <span class="op">=</span> <span class="va">Deaths</span>,       <span class="co"># column containing number of deaths per stratum </span>
     fu <span class="op">=</span> <span class="va">Population</span>,      <span class="co"># column containing number of population per stratum</span>
     subgroup <span class="op">=</span> <span class="va">Country</span>,   <span class="co"># units we would like to compare</span>
     <span class="va">age_cat5</span>,             <span class="co"># other columns - rates will be standardized by these</span>
     <span class="va">Sex</span>,
     refdata <span class="op">=</span> <span class="va">standard_pop_clean</span>, <span class="co"># reference population data frame, with column called pop</span>
     method <span class="op">=</span> <span class="st">"gamma"</span>,      <span class="co"># method to calculate 95% CI</span>
     sig <span class="op">=</span> <span class="fl">0.95</span>,            <span class="co"># significance level</span>
     mp <span class="op">=</span> <span class="fl">100000</span>,           <span class="co"># we want rates per 100.000 population</span>
     decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>          <span class="co"># number of decimals)</span>


<span class="co"># Print output as nice-looking HTML table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_rate</span><span class="op">)</span> <span class="co"># show mortality rate before and after direct standardization</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Subgroup
</th>
<th style="text-align:right;">
Numerator
</th>
<th style="text-align:right;">
Denominator
</th>
<th style="text-align:right;">
Crude Rate (per 100000)
</th>
<th style="text-align:right;">
95% LCL (Crude)
</th>
<th style="text-align:right;">
95% UCL (Crude)
</th>
<th style="text-align:right;">
Std Rate (per 100000)
</th>
<th style="text-align:right;">
95% LCL (Std)
</th>
<th style="text-align:right;">
95% UCL (Std)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
11344
</td>
<td style="text-align:right;">
86790567
</td>
<td style="text-align:right;">
13.07
</td>
<td style="text-align:right;">
12.83
</td>
<td style="text-align:right;">
13.31
</td>
<td style="text-align:right;">
23.57
</td>
<td style="text-align:right;">
23.08
</td>
<td style="text-align:right;">
24.06
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
9955
</td>
<td style="text-align:right;">
52898281
</td>
<td style="text-align:right;">
18.82
</td>
<td style="text-align:right;">
18.45
</td>
<td style="text-align:right;">
19.19
</td>
<td style="text-align:right;">
19.33
</td>
<td style="text-align:right;">
18.46
</td>
<td style="text-align:right;">
20.22
</td>
</tr>
</tbody>
</table></div>
<p>Bên trên, chúng ta thấy rằng tỷ suất tử vong thô của quốc gia A thấp hơn quốc gia B, nhưng tỷ suất được chuẩn hóa trực tiếp theo tuổi và giới thì cao hơn.</p>
<!-- ======================================================= -->
</div>
<div id="tỷ-số-của-các-tỷ-suất-chuẩn-hóa" class="section level3 unnumbered">
<h3>Tỷ số của các tỷ suất chuẩn hóa<a class="anchor" aria-label="anchor" href="#t%E1%BB%B7-s%E1%BB%91-c%E1%BB%A7a-c%C3%A1c-t%E1%BB%B7-su%E1%BA%A5t-chu%E1%BA%A9n-h%C3%B3a"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1095"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate RR</span>
<span class="va">mortality_rr</span> <span class="op">&lt;-</span> <span class="fu">dsr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dsr/man/dsrr.html">dsrr</a></span><span class="op">(</span>
     data <span class="op">=</span> <span class="va">country_data</span>, <span class="co"># specify object containing number of deaths per stratum</span>
     event <span class="op">=</span> <span class="va">Deaths</span>,      <span class="co"># column containing number of deaths per stratum </span>
     fu <span class="op">=</span> <span class="va">Population</span>,     <span class="co"># column containing number of population per stratum</span>
     subgroup <span class="op">=</span> <span class="va">Country</span>,  <span class="co"># units we would like to compare</span>
     <span class="va">age_cat5</span>,
     <span class="va">Sex</span>,                 <span class="co"># characteristics to which we would like to standardize </span>
     refdata <span class="op">=</span> <span class="va">standard_pop_clean</span>, <span class="co"># reference population, with numbers in column called pop</span>
     refgroup <span class="op">=</span> <span class="st">"B"</span>,      <span class="co"># reference for comparison</span>
     estimate <span class="op">=</span> <span class="st">"ratio"</span>,  <span class="co"># type of estimate</span>
     sig <span class="op">=</span> <span class="fl">0.95</span>,          <span class="co"># significance level</span>
     mp <span class="op">=</span> <span class="fl">100000</span>,         <span class="co"># we want rates per 100.000 population</span>
     decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>        <span class="co"># number of decimals</span>

<span class="co"># Print table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_rr</span><span class="op">)</span> </code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Comparator
</th>
<th style="text-align:left;">
Reference
</th>
<th style="text-align:right;">
Std Rate (per 100000)
</th>
<th style="text-align:right;">
Rate Ratio (RR)
</th>
<th style="text-align:right;">
95% LCL (RR)
</th>
<th style="text-align:right;">
95% UCL (RR)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
23.57
</td>
<td style="text-align:right;">
1.22
</td>
<td style="text-align:right;">
1.17
</td>
<td style="text-align:right;">
1.27
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
19.33
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;">
1.06
</td>
</tr>
</tbody>
</table></div>
<p>Tỷ suất tử vong chuẩn hóa của quốc gia A cao gấp 1.22 lần so với quốc gia B (95% CI 1.17-1.27).</p>
<!-- ======================================================= -->
</div>
<div id="khác-biệt-của-các-tỷ-suất-chuẩn-hóa" class="section level3 unnumbered">
<h3>Khác biệt của các tỷ suất chuẩn hóa<a class="anchor" aria-label="anchor" href="#kh%C3%A1c-bi%E1%BB%87t-c%E1%BB%A7a-c%C3%A1c-t%E1%BB%B7-su%E1%BA%A5t-chu%E1%BA%A9n-h%C3%B3a"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1096"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate RD</span>
<span class="va">mortality_rd</span> <span class="op">&lt;-</span> <span class="fu">dsr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dsr/man/dsrr.html">dsrr</a></span><span class="op">(</span>
     data <span class="op">=</span> <span class="va">country_data</span>,       <span class="co"># specify object containing number of deaths per stratum</span>
     event <span class="op">=</span> <span class="va">Deaths</span>,            <span class="co"># column containing number of deaths per stratum </span>
     fu <span class="op">=</span> <span class="va">Population</span>,           <span class="co"># column containing number of population per stratum</span>
     subgroup <span class="op">=</span> <span class="va">Country</span>,        <span class="co"># units we would like to compare</span>
     <span class="va">age_cat5</span>,                  <span class="co"># characteristics to which we would like to standardize</span>
     <span class="va">Sex</span>,                        
     refdata <span class="op">=</span> <span class="va">standard_pop_clean</span>, <span class="co"># reference population, with numbers in column called pop</span>
     refgroup <span class="op">=</span> <span class="st">"B"</span>,            <span class="co"># reference for comparison</span>
     estimate <span class="op">=</span> <span class="st">"difference"</span>,   <span class="co"># type of estimate</span>
     sig <span class="op">=</span> <span class="fl">0.95</span>,                <span class="co"># significance level</span>
     mp <span class="op">=</span> <span class="fl">100000</span>,               <span class="co"># we want rates per 100.000 population</span>
     decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>              <span class="co"># number of decimals</span>

<span class="co"># Print table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_rd</span><span class="op">)</span> </code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Comparator
</th>
<th style="text-align:left;">
Reference
</th>
<th style="text-align:right;">
Std Rate (per 100000)
</th>
<th style="text-align:right;">
Rate Difference (RD)
</th>
<th style="text-align:right;">
95% LCL (RD)
</th>
<th style="text-align:right;">
95% UCL (RD)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
23.57
</td>
<td style="text-align:right;">
4.24
</td>
<td style="text-align:right;">
3.24
</td>
<td style="text-align:right;">
5.24
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
19.33
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-1.24
</td>
<td style="text-align:right;">
1.24
</td>
</tr>
</tbody>
</table></div>
<p>Quốc gia A có hơn 4,24 ca tử vong trên 100,000 dân (95% CI 3.24-5.24) so với quốc gia B.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="standard_phe" class="section level2" number="21.4">
<h2>
<span class="header-section-number">21.4</span> Package <strong>PHEindicatormethods</strong><a class="anchor" aria-label="anchor" href="#standard_phe"><i class="fas fa-link"></i></a>
</h2>
<p>Một cách khác để tính tỷ suất chuẩn hóa là dùng package <strong>PHEindicatormethods</strong>. Package này cho phép chúng ta tính toán tỷ suất chuẩn hóa trực tiếp cũng như gián tiếp. Chúng tôi sẽ hướng dẫn cả hai.</p>
<p>Phần này chúng ta sẽ sử dụng bộ số liệu <code>all_data</code> được tạo ở cuối phần Chuẩn bị. Bộ số liệu này bao gồm dân số quốc gia, số tử vong và dân số tham chiếu. Bạn có thể xem nó ở <a href="standardization.html#standard_all">đây</a>.</p>
<!-- ======================================================= -->
<div id="tỷ-suất-chuẩn-hóa-trực-tiếp" class="section level3 unnumbered">
<h3>Tỷ suất chuẩn hóa trực tiếp<a class="anchor" aria-label="anchor" href="#t%E1%BB%B7-su%E1%BA%A5t-chu%E1%BA%A9n-h%C3%B3a-tr%E1%BB%B1c-ti%E1%BA%BFp"><i class="fas fa-link"></i></a>
</h3>
<p>Đầu tiên, chúng ta nhóm số liệu theo Quốc gia như bên dưới và sau đó chuyển số liệu vào hàm <code>phe_dsr()</code> để có được tỷ suất chuẩn hóa trực tiếp theo quốc gia.</p>
<p>Lưu ý, dân số tham chiếu (chuẩn) có thể được cung cấp dưới dạng một <strong>cột bên trong số liệu của một quốc gia cụ thể</strong> hoặc dưới dạng một <strong>véctơ riêng biệt</strong>. Nếu được cung cấp bên trong số liệu của một quốc gia cụ thể, bạn phải đặt <code>stdpoptype = "field"</code>. Nếu được cung cấp như một véc tơ, đặt <code>stdpoptype = "vector"</code>. Trong trường hợp thứ hai, chúng ta phải đảm bảo thứ tự của các hàng theo tầng tương tự nhau trong cả khung số liệu quốc gia và dân số tham chiếu, vì vị trí các bản ghi/các hàng phải khớp với nhau. Trong ví dụ bên dưới, chúng tôi đã cung cấp dân số tham chiếu dưới dạng một cột bên trong khung số liệu của một quốc gia cụ thể.</p>
<p>Xem trợ giúp bằng cách gõ <code>?phr_dsr</code> hoặc các liên kết trong phần Tài nguyên học liệu để biết thêm thông tin.</p>
<div class="sourceCode" id="cb1097"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate rates per country directly standardized for age and sex</span>
<span class="va">mortality_ds_rate_phe</span> <span class="op">&lt;-</span> <span class="va">all_data</span> <span class="op">%&gt;%</span>
     <span class="fu">group_by</span><span class="op">(</span><span class="va">Country</span><span class="op">)</span> <span class="op">%&gt;%</span>
     <span class="fu">PHEindicatormethods</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PHEindicatormethods/man/phe_dsr.html">phe_dsr</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">Deaths</span>,                 <span class="co"># column with observed number of events</span>
          n <span class="op">=</span> <span class="va">Population</span>,             <span class="co"># column with non-standard pops for each stratum</span>
          stdpop <span class="op">=</span> <span class="va">pop</span>,               <span class="co"># standard populations for each stratum</span>
          stdpoptype <span class="op">=</span> <span class="st">"field"</span><span class="op">)</span>       <span class="co"># either "vector" for a standalone vector or "field" meaning std populations are in the data  </span>

<span class="co"># Print table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_ds_rate_phe</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Country
</th>
<th style="text-align:right;">
total_count
</th>
<th style="text-align:right;">
total_pop
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
lowercl
</th>
<th style="text-align:right;">
uppercl
</th>
<th style="text-align:left;">
confidence
</th>
<th style="text-align:left;">
statistic
</th>
<th style="text-align:left;">
method
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
11344
</td>
<td style="text-align:right;">
86790567
</td>
<td style="text-align:right;">
23.56686
</td>
<td style="text-align:right;">
23.08107
</td>
<td style="text-align:right;">
24.05944
</td>
<td style="text-align:left;">
95%
</td>
<td style="text-align:left;">
dsr per 100000
</td>
<td style="text-align:left;">
Dobson
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
9955
</td>
<td style="text-align:right;">
52898281
</td>
<td style="text-align:right;">
19.32549
</td>
<td style="text-align:right;">
18.45516
</td>
<td style="text-align:right;">
20.20882
</td>
<td style="text-align:left;">
95%
</td>
<td style="text-align:left;">
dsr per 100000
</td>
<td style="text-align:left;">
Dobson
</td>
</tr>
</tbody>
</table></div>
<!-- ======================================================= -->
</div>
<div id="standard_indirect" class="section level3 unnumbered">
<h3>Tỷ suất chuẩn hóa gián tiếp<a class="anchor" aria-label="anchor" href="#standard_indirect"><i class="fas fa-link"></i></a>
</h3>
<p>Để chuẩn hóa gián tiếp, chúng ta cần dân số tham chiếu có số lượng tử vong và dân số theo tầng. Trong ví dụ này, chúng ta sẽ tính tỷ suất của quốc gia A bằng cách <em>sử dụng quốc gia B làm dân số tham chiếu</em>, vì dân số tham chiếu trong bộ số liệu <code>standard_pop_clean</code> không có số lượng tử vong theo tầng.</p>
<p>Trước tiên, chúng ta tạo dân số tham chiếu từ quốc gia B như bên dưới. Sau đó, chúng ta chuyển số liệu tử vong và dân số của quốc gia A, kết nối nó với dân số tham chiếu và chuyển nó vào hàm <code>phe_isr()</code>, để có được tỷ suất chuẩn hóa gián tiếp. Dĩ nhiên, chúng ta cũng có thể làm ngược lại.</p>
<p>Lưu ý - trong ví dụ bên dưới, dân số tham chiếu được cung cấp dưới dạng một data frame riêng rẽ. Trong trường hợp này, chúng ta cần đảm bảo rằng các véctơ <code>x =</code>, <code>n =</code>, <code>x_ref =</code> và <code>n_ref =</code> tất cả được sắp đặt cùng giá trị với loại chuẩn hóa (theo đúng tầng) như được sắp đặt trong data frame quốc gia, vì vị trí các bản ghi/các hàng phải khớp với nhau.</p>
<p>Xem trợ giúp bằng cách gõ <code>?phr_isr</code> hoặc các liên kết trong phần Tài nguyên học liệu để biết thêm thông tin.</p>
<div class="sourceCode" id="cb1098"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create reference population</span>
<span class="va">refpopCountryB</span> <span class="op">&lt;-</span> <span class="va">country_data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"B"</span><span class="op">)</span> 

<span class="co"># Calculate rates for country A indirectly standardized by age and sex</span>
<span class="va">mortality_is_rate_phe_A</span> <span class="op">&lt;-</span> <span class="va">country_data</span> <span class="op">%&gt;%</span>
     <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">%&gt;%</span>
     <span class="fu">PHEindicatormethods</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PHEindicatormethods/man/phe_isr.html">phe_isr</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">Deaths</span>,                 <span class="co"># column with observed number of events</span>
          n <span class="op">=</span> <span class="va">Population</span>,             <span class="co"># column with non-standard pops for each stratum</span>
          x_ref <span class="op">=</span> <span class="va">refpopCountryB</span><span class="op">$</span><span class="va">Deaths</span>,  <span class="co"># reference number of deaths for each stratum</span>
          n_ref <span class="op">=</span> <span class="va">refpopCountryB</span><span class="op">$</span><span class="va">Population</span><span class="op">)</span>  <span class="co"># reference population for each stratum</span>

<span class="co"># Print table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_is_rate_phe_A</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
observed
</th>
<th style="text-align:right;">
expected
</th>
<th style="text-align:right;">
ref_rate
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
lowercl
</th>
<th style="text-align:right;">
uppercl
</th>
<th style="text-align:left;">
confidence
</th>
<th style="text-align:left;">
statistic
</th>
<th style="text-align:left;">
method
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
11344
</td>
<td style="text-align:right;">
15847.42
</td>
<td style="text-align:right;">
18.81914
</td>
<td style="text-align:right;">
13.47123
</td>
<td style="text-align:right;">
13.22446
</td>
<td style="text-align:right;">
13.72145
</td>
<td style="text-align:left;">
95%
</td>
<td style="text-align:left;">
isr per 100000
</td>
<td style="text-align:left;">
Byars
</td>
</tr></tbody>
</table></div>
<!-- ======================================================= -->
</div>
</div>
<div id="tài-nguyên-học-liệu-6" class="section level2" number="21.5">
<h2>
<span class="header-section-number">21.5</span> Tài nguyên học liệu<a class="anchor" aria-label="anchor" href="#t%C3%A0i-nguy%C3%AAn-h%E1%BB%8Dc-li%E1%BB%87u-6"><i class="fas fa-link"></i></a>
</h2>
<p>Nếu bạn muốn tìm thêm các ví dụ có thể tái lập được sử dụng package <strong>dsr</strong>, vui lòng xem <a href="https://mran.microsoft.com/snapshot/2020-02-12/web/packages/dsr/vignettes/dsr.html">hướng dẫn này</a></p>
<p>Với các ví dụ khác sử dụng package <strong>PHEindicatormethods</strong>, vui lòng xem tại <a href="https://mran.microsoft.com/snapshot/2018-10-22/web/packages/PHEindicatormethods/vignettes/IntroductiontoPHEindicatormethods.html">website này</a></p>
<p>Xem thêm <strong>PHEindicatormethods</strong> <a href="https://cran.r-project.org/web/packages/PHEindicatormethods/PHEindicatormethods.pdf">tài liệu dưới dạng tệp pdf</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="missing-data.html"><span class="header-section-number">20</span> Dữ liệu Missing</a></div>
<div class="next"><a href="moving-average.html"><span class="header-section-number">22</span> Đường trung bình động</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#standardization"><span class="header-section-number">21</span> Tỷ suất chuẩn hóa</a></li>
<li><a class="nav-link" href="#t%E1%BB%95ng-quan-1"><span class="header-section-number">21.1</span> Tổng quan</a></li>
<li>
<a class="nav-link" href="#chu%E1%BA%A9n-b%E1%BB%8B-11"><span class="header-section-number">21.2</span> Chuẩn bị</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#g%E1%BB%8Di-packages-6">Gọi packages</a></li>
<li><a class="nav-link" href="#t%E1%BA%A3i-s%E1%BB%91-li%E1%BB%87u-d%C3%A2n-s%E1%BB%91">Tải số liệu dân số</a></li>
<li><a class="nav-link" href="#t%E1%BA%A3i-s%E1%BB%91-li%E1%BB%87u-t%E1%BB%AD-vong">Tải số liệu tử vong</a></li>
<li><a class="nav-link" href="#l%C3%A0m-s%E1%BA%A1ch-s%E1%BB%91-li%E1%BB%87u-d%C3%A2n-s%E1%BB%91-v%C3%A0-t%E1%BB%AD-vong">Làm sạch số liệu dân số và tử vong</a></li>
<li><a class="nav-link" href="#t%E1%BA%A3i-d%C3%A2n-s%E1%BB%91-tham-chi%E1%BA%BFu">Tải dân số tham chiếu</a></li>
<li><a class="nav-link" href="#l%C3%A0m-sach-d%C3%A2n-s%E1%BB%91-tham-chi%E1%BA%BFu">Làm sach dân số tham chiếu</a></li>
<li><a class="nav-link" href="#standard_all">Tạo bộ số liệu với dân số chuẩn</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#package-dsr"><span class="header-section-number">21.3</span> Package dsr</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#t%E1%BB%B7-su%E1%BA%A5t-chu%E1%BA%A9n-h%C3%B3a">Tỷ suất chuẩn hóa</a></li>
<li><a class="nav-link" href="#t%E1%BB%B7-s%E1%BB%91-c%E1%BB%A7a-c%C3%A1c-t%E1%BB%B7-su%E1%BA%A5t-chu%E1%BA%A9n-h%C3%B3a">Tỷ số của các tỷ suất chuẩn hóa</a></li>
<li><a class="nav-link" href="#kh%C3%A1c-bi%E1%BB%87t-c%E1%BB%A7a-c%C3%A1c-t%E1%BB%B7-su%E1%BA%A5t-chu%E1%BA%A9n-h%C3%B3a">Khác biệt của các tỷ suất chuẩn hóa</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#standard_phe"><span class="header-section-number">21.4</span> Package PHEindicatormethods</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#t%E1%BB%B7-su%E1%BA%A5t-chu%E1%BA%A9n-h%C3%B3a-tr%E1%BB%B1c-ti%E1%BA%BFp">Tỷ suất chuẩn hóa trực tiếp</a></li>
<li><a class="nav-link" href="#standard_indirect">Tỷ suất chuẩn hóa gián tiếp</a></li>
</ul>
</li>
<li><a class="nav-link" href="#t%C3%A0i-nguy%C3%AAn-h%E1%BB%8Dc-li%E1%BB%87u-6"><span class="header-section-number">21.5</span> Tài nguyên học liệu</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Cẩm nang dịch tễ học với R</strong>" was written by the handbook team. It was last built on 2021-10-14.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
