<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>16 Lặp, vòng lặp, và danh sách | Cẩm nang dịch tễ học với R</title>
<meta name="author" content="the handbook team">
<meta name="description" content="Các nhà dịch tễ học thường phải phân tích lặp lại trên các phân nhóm như quốc gia, quận hoặc nhóm tuổi. Đây chỉ là một vài trong số rất nhiều tình huống yêu cầu việc lặp lại. Mã hóa các thao tác...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="16 Lặp, vòng lặp, và danh sách | Cẩm nang dịch tễ học với R">
<meta property="og:type" content="book">
<meta property="og:description" content="Các nhà dịch tễ học thường phải phân tích lặp lại trên các phân nhóm như quốc gia, quận hoặc nhóm tuổi. Đây chỉ là một vài trong số rất nhiều tình huống yêu cầu việc lặp lại. Mã hóa các thao tác...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="16 Lặp, vòng lặp, và danh sách | Cẩm nang dịch tễ học với R">
<meta name="twitter:description" content="Các nhà dịch tễ học thường phải phân tích lặp lại trên các phân nhóm như quốc gia, quận hoặc nhóm tuổi. Đây chỉ là một vài trong số rất nhiều tình huống yêu cầu việc lặp lại. Mã hóa các thao tác...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.19/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-8.1.2/highcharts.js"></script><script src="libs/highcharts-8.1.2/highcharts-3d.js"></script><script src="libs/highcharts-8.1.2/highcharts-more.js"></script><script src="libs/highcharts-8.1.2/modules/stock.js"></script><script src="libs/highcharts-8.1.2/modules/map.js"></script><script src="libs/highcharts-8.1.2/modules/annotations.js"></script><script src="libs/highcharts-8.1.2/modules/data.js"></script><script src="libs/highcharts-8.1.2/modules/drilldown.js"></script><script src="libs/highcharts-8.1.2/modules/item-series.js"></script><script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script><script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-8.1.2/modules/exporting.js"></script><script src="libs/highcharts-8.1.2/modules/export-data.js"></script><script src="libs/highcharts-8.1.2/modules/funnel.js"></script><script src="libs/highcharts-8.1.2/modules/heatmap.js"></script><script src="libs/highcharts-8.1.2/modules/treemap.js"></script><script src="libs/highcharts-8.1.2/modules/sankey.js"></script><script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script><script src="libs/highcharts-8.1.2/modules/organization.js"></script><script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script><script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script><script src="libs/highcharts-8.1.2/modules/sunburst.js"></script><script src="libs/highcharts-8.1.2/modules/vector.js"></script><script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script><script src="libs/highcharts-8.1.2/modules/xrange.js"></script><script src="libs/highcharts-8.1.2/modules/tilemap.js"></script><script src="libs/highcharts-8.1.2/modules/venn.js"></script><script src="libs/highcharts-8.1.2/modules/gantt.js"></script><script src="libs/highcharts-8.1.2/modules/timeline.js"></script><script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script><script src="libs/highcharts-8.1.2/modules/bullet.js"></script><script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script><script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script><script src="libs/highcharts-8.1.2/modules/lollipop.js"></script><script src="libs/highcharts-8.1.2/modules/series-label.js"></script><script src="libs/highcharts-8.1.2/plugins/motion.js"></script><script src="libs/highcharts-8.1.2/custom/reset.js"></script><script src="libs/highcharts-8.1.2/modules/boost.js"></script><script src="libs/highchart-binding-0.8.2/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Cẩm nang dịch tễ học với R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Về cuốn sách này</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> Biên tập và ghi chú kỹ thuật</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> Tải sách và dữ liệu</a></li>
<li class="book-part">Nhập môn về R</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R Cơ bản</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Chuyển đổi sang R</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> Package đề xuất</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Dự án R</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> Nhập xuất dữ liệu</a></li>
<li class="book-part">Quản lý dữ liệu</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> Làm sạch số liệu và các hàm quan trọng</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> Làm việc với ngày tháng</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> Ký tự và chuỗi</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Factors</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> Xoay trục dữ liệu</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> Nhóm dữ liệu</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> Nối dữ liệu</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> Loại bỏ trùng lặp</a></li>
<li><a class="active" href="iteration.html"><span class="header-section-number">16</span> Lặp, vòng lặp, và danh sách</a></li>
<li class="book-part">Phân tích dữ liệu</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> Bảng mô tả</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> Các kiểm định thống kê cơ bản</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Hồi quy đơn và đa biến</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Dữ liệu Missing</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> Tỷ suất chuẩn hóa</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> Đường trung bình động</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> Chuỗi thời gian và phát hiện ổ dịch</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> Mô hình hóa dịch bệnh</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> Truy vết tiếp xúc</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> Phân tích khảo sát</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> Phân tích sống còn</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS cơ bản</a></li>
<li class="book-part">Trực quan hóa dữ liệu</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> Trình bày bảng</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot cơ bản</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> Các tips với ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> Đường cong dịch bệnh</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> Tháp dân số và thang đo Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> Biểu đồ nhiệt</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> Sơ đồ và biểu đồ</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> Biểu đồ kết hợp</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Chuỗi lây nhiễm</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> Cây phả hệ</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Biểu đồ tương tác</a></li>
<li class="book-part">Báo cáo và dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> Báo cáo với R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> Tổ chức báo cáo định kỳ</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> Dashboards với R Markdown</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Dashboards với Shiny</a></li>
<li class="book-part">Tổng hợp</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> Viết hàm</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> Tương tác với thư mục làm việc</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Version control với Git và Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> Các lỗi thường gặp</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> Nhờ sự trợ giúp</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> R trên ổ cứng mạng</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> Data Table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="iteration" class="section level1" number="16">
<h1>
<span class="header-section-number">16</span> Lặp, vòng lặp, và danh sách<a class="anchor" aria-label="anchor" href="#iteration"><i class="fas fa-link"></i></a>
</h1>
<p>Các nhà dịch tễ học thường phải phân tích lặp lại trên các phân nhóm như quốc gia, quận hoặc nhóm tuổi. Đây chỉ là một vài trong số rất nhiều tình huống yêu cầu việc <em>lặp lại</em>. Mã hóa các thao tác lặp lại của bạn bằng cách sử dụng các phương pháp bên dưới sẽ giúp bạn thực hiện các tác vụ lặp đi lặp lại như vậy nhanh hơn, giảm khả năng xảy ra lỗi và giảm độ dài code.</p>
<p>Chương này sẽ giới thiệu hai cách tiếp cận đối với các thao tác lặp lại - sử dụng các <em>vòng lặp for</em> và package <strong>purrr</strong>.</p>
<ol style="list-style-type: decimal">
<li>
<em>vòng lặp for</em> lặp lại code trên một loạt đầu vào, nhưng ít phổ biến hơn trong R so với các ngôn ngữ lập trình khác. Tuy nhiên, chúng tôi giới thiệu chúng ở đây như một công cụ học tập và tham khảo<br>
</li>
<li>Package <strong>purrr</strong> là phương pháp tiếp cận <strong>tidyverse</strong> đối với các thao tác lặp lại - nó hoạt động bằng cách “maps” (áp dụng) một hàm trên nhiều đầu vào (giá trị, cột, datasets, v.v.)</li>
</ol>
<p>Trong chương này, chúng tôi sẽ lấy một số ví dụ như:</p>
<ul>
<li>Nhập và xuất nhiều tệp<br>
</li>
<li>Tạo các đường cong dịch bệnh cho nhiều tỉnh<br>
</li>
<li>Chạy T-tests cho nhiều cột trong dataframe</li>
</ul>
<p>Trong <a href="iteration.html#iter_purrr">phần</a> <strong>purrr</strong>, chúng tôi cũng sẽ cung cấp một số ví dụ về cách tạo và xử lý danh sách <code>lists</code>.</p>
<div id="chuẩn-bị-7" class="section level2" number="16.1">
<h2>
<span class="header-section-number">16.1</span> Chuẩn bị<a class="anchor" aria-label="anchor" href="#chu%E1%BA%A9n-b%E1%BB%8B-7"><i class="fas fa-link"></i></a>
</h2>
<div id="gọi-packages-3" class="section level3 unnumbered">
<h3>Gọi packages<a class="anchor" aria-label="anchor" href="#g%E1%BB%8Di-packages-3"><i class="fas fa-link"></i></a>
</h3>
<p>Đoạn code này hiển thị cách gọi các packages cần thiết cho phần phân tích. Trong sổ tay này, chúng tôi nhấn mạnh đến hàm <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> từ package <strong>pacman</strong>, cài đặt package nếu cần <em>và</em> gọi nó ra để sử dụng. Bạn cũng có thể gọi các package đã cài đặt với hàm <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> từ <strong>base</strong> R. Xem chương <a href="basics.html#basics">R cơ bản</a> để biết thêm thông tin về packages R.</p>
<div class="sourceCode" id="cb752"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
     <span class="va">rio</span>,         <span class="co"># import/export</span>
     <span class="va">here</span>,        <span class="co"># file locator</span>
     <span class="va">purrr</span>,       <span class="co"># iteration</span>
     <span class="va">tidyverse</span>    <span class="co"># data management and visualization</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="nhập-dữ-liệu-9" class="section level3 unnumbered">
<h3>Nhập dữ liệu<a class="anchor" aria-label="anchor" href="#nh%E1%BA%ADp-d%E1%BB%AF-li%E1%BB%87u-9"><i class="fas fa-link"></i></a>
</h3>
<p>Chúng tôi nhập dataset về các trường hợp từ một vụ dịch Ebola mô phỏng. Nếu bạn muốn làm theo, hãy <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">nhấp để tải xuống linelist “sạch”</a> (dưới dạng tệp .rds). Nhập dữ liệu bằng hàm <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> từ package <strong>rio</strong> (nó xử lý nhiều loại tệp như .xlsx, .csv, .rds - xem chương <a href="importing.html#importing">Nhập xuất dữ liệu</a> để biết chi tiết).</p>
<div class="sourceCode" id="cb753"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import the linelist</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></code></pre></div>
<p>50 hàng đầu tiên của linelist được hiển thị bên dưới.</p>
<div id="htmlwidget-88c74164ebac28042de3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-88c74164ebac28042de3">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="vòng-lặp-for" class="section level2" number="16.2">
<h2>
<span class="header-section-number">16.2</span> <em>vòng lặp for</em><a class="anchor" aria-label="anchor" href="#v%C3%B2ng-l%E1%BA%B7p-for"><i class="fas fa-link"></i></a>
</h2>
<div id="iter_loops" class="section level3 unnumbered">
<h3>
<em>vòng lặp for</em> trong R<a class="anchor" aria-label="anchor" href="#iter_loops"><i class="fas fa-link"></i></a>
</h3>
<p><em>Vòng lặp for</em> không được nhấn mạnh trong R, nhưng phổ biến trong các ngôn ngữ lập trình khác. Khi mới bắt đầu, chúng có thể hữu ích để học và thực hành vì chúng dễ “khám phá”, “gỡ lỗi” hơn và nắm bắt chính xác những gì đang xảy ra cho mỗi lần lặp, đặc biệt là khi bạn chưa cảm thấy thoải mái khi viết các hàm của riêng mình.</p>
<p>Bạn có thể chuyển nhanh qua phần <em>vòng lặp for</em> tới phần lặp với các hàm được tạo với <strong>purrr</strong> (xem <a href="iteration.html#iter_purrr">phần bên dưới</a>).</p>
</div>
<div id="cấu-phần-cốt-lõi" class="section level3 unnumbered">
<h3>Cấu phần cốt lõi<a class="anchor" aria-label="anchor" href="#c%E1%BA%A5u-ph%E1%BA%A7n-c%E1%BB%91t-l%C3%B5i"><i class="fas fa-link"></i></a>
</h3>
<p>Một <em>vòng lặp for</em> có ba phần cốt lõi:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Chuỗi</strong> các phần tử cần lặp lại</li>
<li>Các <strong>thao tác</strong> để tiến hành cho mỗi phần tử trong chuỗi<br>
</li>
<li>
<strong>Vùng chứa</strong> cho kết quả (tùy chọn)</li>
</ol>
<p>Cú pháp cơ bản là: <code>for (phần tử trong chuỗi) {các thao tác thực hiện với phần tử}</code>. Lưu ý dấu ngoặc đơn và dấu ngoặc nhọn. Kết quả có thể được in ra console hoặc được lưu trữ trong một đối tượng vùng chứa.</p>
<p>Dưới đây là một ví dụ đơn giản về <em>vòng lặp for</em>.</p>
<div class="sourceCode" id="cb754"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">num</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>  <span class="co"># the SEQUENCE is defined (numbers 1 to 5) and loop is opened with "{"</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">num</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span>             <span class="co"># The OPERATIONS (add two to each sequence number and print)</span>
<span class="op">}</span>                            <span class="co"># The loop is closed with "}"                            </span></code></pre></div>
<pre><code>## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7</code></pre>
<div class="sourceCode" id="cb756"><pre class="downlit sourceCode r">
<code class="sourceCode R">                             <span class="co"># There is no "container" in this example</span></code></pre></div>
</div>
<div id="chuỗi" class="section level3 unnumbered">
<h3>Chuỗi<a class="anchor" aria-label="anchor" href="#chu%E1%BB%97i"><i class="fas fa-link"></i></a>
</h3>
<p>Đây là phần “for” của <em>vòng lặp for</em> - các thao tác sẽ chạy “cho (for)” từng phần tử trong chuỗi. Chuỗi có thể là một loạt các giá trị (ví dụ: tên của khu vực pháp lý, bệnh, tên cột, phần tử danh sách, v.v.) hoặc nó có thể là một chuỗi các số liên tiếp (ví dụ: 1,2,3,4,5). Mỗi cách tiếp cận được mô tả dưới đây có các tiện ích riêng của chúng.</p>
<p>Cấu trúc cơ bản của biểu thức chuỗi là <code>item in vector</code>.</p>
<ul>
<li>Bạn có thể viết bất kỳ ký tự hoặc từ nào thay cho “item” (ví dụ: “i”, “num”, “hosp”, “district”, v.v.). Giá trị của “item” này thay đổi theo từng lần lặp lại của vòng lặp, tiếp tục qua từng giá trị trong vector.<br>
</li>
<li>
<em>Vector</em> có thể là các giá trị ký tự, tên cột hoặc có thể là một chuỗi số - đây là những giá trị sẽ thay đổi theo mỗi lần lặp. Bạn có thể sử dụng chúng trong các thao tác <em>vòng lặp for</em> bằng cách sử dụng thuật ngữ “item”.</li>
</ul>
<p><strong>Ví dụ: chuỗi giá trị ký tự</strong></p>
<p>Trong ví dụ này, một vòng lặp được thực hiện cho mỗi giá trị được xác định trước trong một vector ký tự của tên bệnh viện.</p>
<div class="sourceCode" id="cb757"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make vector of the hospital names</span>
<span class="va">hospital_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span>
<span class="va">hospital_names</span> <span class="co"># print</span></code></pre></div>
<pre><code>## [1] "Other"                                "Missing"                              "St. Mark's Maternity Hospital (SMMH)"
## [4] "Port Hospital"                        "Military Hospital"                    "Central Hospital"</code></pre>
<p>Chúng tôi đã chọn thuật ngữ <code>hosp</code> để đại diện cho các giá trị từ vector <code>hospital_names</code>. Đối với lần lặp đầu tiên của vòng lặp, giá trị của <code>hosp</code> sẽ là <code>hospital_names[[1]]</code>. Đối với vòng lặp thứ hai, nó sẽ là <code>hospital_names[[2]]</code>. Và cứ như thế…</p>
<div class="sourceCode" id="cb759"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># a 'for loop' with character sequence</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">hosp</span> <span class="kw">in</span> <span class="va">hospital_names</span><span class="op">)</span><span class="op">{</span>       <span class="co"># sequence</span>
  
       <span class="co"># OPERATIONS HERE</span>
  <span class="op">}</span></code></pre></div>
<p><strong>Ví dụ: chuỗi tên cột</strong></p>
<p>Đây là một biến thể của chuỗi ký tự ở trên, trong đó tên của một đối tượng R hiện có được trích xuất và trở thành vector. Ví dụ, tên cột của dataframe. Trong code hoạt động của <em>vòng lặp for</em>, tên cột có thể được sử dụng để <em>lập chỉ mục</em> (tập hợp con) dataframe ban đầu của chúng.</p>
<p>Dưới đây, chuỗi là <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> (tên cột) của dataframe <code>linelist</code>. Tên “item” của chúng ta là <code>col</code>, sẽ đại diện cho từng tên cột khi các vòng lặp diễn ra.</p>
<p>Với ví dụ này, chúng tôi bao gồm code thao tác bên trong <em>vòng lặp for</em>, được chạy cho mọi giá trị trong chuỗi. Trong code này, các giá trị trình tự (tên cột) được sử dụng để <em>chỉ mục</em> (tập hợp con) từng phần tử một trong <code>linelist</code>. Như đã dạy trong chương <a href="basics.html#basics">R cơ bản</a>, dấu ngoặc vuông kép <code>[[]]</code> được sử dụng cho tập hợp con. Cột kết quả được chuyển đến <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code>, sau đó đến <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> để tạo ra số giá trị trong cột bị thiếu. Kết quả được in ra console - một số cho mỗi cột.</p>
<p>Một lưu ý về lập chỉ mục với tên cột - bất cứ khi nào tham chiếu đến chính cột đó, <em>đừng chỉ viết “col”!</em> <code>col</code> chỉ đại diện cho tên cột ký tự! Để tham chiếu đến toàn bộ cột, bạn phải sử dụng tên cột dưới dạng <em>chỉ mục</em> trên <code>linelist</code> thông qua <code>linelist[[col]]</code>.</p>
<div class="sourceCode" id="cb760"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">col</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>        <span class="co"># loop runs for each column in linelist; column name represented by "col" </span>
  
  <span class="co"># Example operations code - print number of missing values in column</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># linelist is indexed by current value of "col"</span>
     
<span class="op">}</span></code></pre></div>
<pre><code>## [1] 0
## [1] 0
## [1] 2087
## [1] 256
## [1] 0
## [1] 936
## [1] 1323
## [1] 278
## [1] 86
## [1] 0
## [1] 86
## [1] 86
## [1] 86
## [1] 0
## [1] 0
## [1] 0
## [1] 2088
## [1] 2088
## [1] 0
## [1] 0
## [1] 0
## [1] 249
## [1] 249
## [1] 249
## [1] 249
## [1] 249
## [1] 149
## [1] 765
## [1] 0
## [1] 256</code></pre>
<p><strong>Dãy số</strong></p>
<p>Theo cách tiếp cận này, dãy số là một chuỗi các số liên tiếp. Do đó, giá trị của “item” không phải là giá trị ký tự (ví dụ: “Central Hospital” hoặc “date_onset”) mà là một số. Điều này rất hữu ích cho việc lặp qua các dataframes, vì bạn có thể sử dụng số “item” bên trong <em>vòng lặp for</em> để lập chỉ mục dataframe theo <em>số hàng</em>.</p>
<p>Ví dụ: giả sử bạn muốn lặp qua mọi hàng trong dataframe của mình và trích xuất thông tin nhất định. “Item” của bạn sẽ là số hàng số. Thông thường, “item” trong trường hợp này được viết là <code>i</code>.</p>
<p>Quá trình <em>vòng lặp for</em> có thể được giải thích bằng lời là “đối với mọi mục trong chuỗi số từ 1 đến tổng số hàng trong dataframe của tôi, hãy thực hiện X”. Đối với lần lặp đầu tiên của vòng lặp, giá trị của “item” <code>i</code> sẽ là 1. Đối với lần lặp thứ hai,<code>i</code> sẽ là 2, v.v.</p>
<p>Đây là hình thức của chuỗi trong code: <code>for (i in 1:nrow(linelist)) {OPERATIONS CODE}</code> trong đó <code>i</code> đại diện cho “item”và <code>1:nrow(linelist)</code> tạo ra một chuỗi liên tiếp số từ 1 đến số hàng trong <code>linelist</code>.</p>
<div class="sourceCode" id="cb762"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>  <span class="co"># use on a data frame</span>
  <span class="co"># OPERATIONS HERE</span>
<span class="op">}</span>  </code></pre></div>
<p>Nếu bạn muốn chuỗi là số, nhưng bạn đang bắt đầu từ một vector (không phải dataframe), hãy sử dụng hàm tắt <code><a href="https://rdrr.io/r/base/seq.html">seq_along()</a></code> để trả về một dãy số cho mỗi phần tử trong vector. Ví dụ: <code>for (i in seq_along(hospital_names) {OPERATIONS CODE}</code>.</p>
<p>Đoạn code dưới đây thực sự trả về các số, sẽ trở thành giá trị của <code>i</code> trong vòng lặp tương ứng của chúng.</p>
<div class="sourceCode" id="cb763"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">hospital_names</span><span class="op">)</span>  <span class="co"># use on a named vector</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6</code></pre>
<p>Một lợi thế của việc sử dụng các số trong chuỗi là cũng dễ dàng sử dụng số <code>i</code> để lập chỉ mục <em>vùng chứa</em> lưu trữ các kết quả đầu ra của vòng lặp. Có một ví dụ về điều này trong phần Thao tác bên dưới.</p>
</div>
<div id="các-thao-tác" class="section level3 unnumbered">
<h3>Các thao tác<a class="anchor" aria-label="anchor" href="#c%C3%A1c-thao-t%C3%A1c"><i class="fas fa-link"></i></a>
</h3>
<p>Đây là code trong dấu ngoặc nhọn <code>{}</code> của <em>vòng lặp for</em>. Bạn muốn code này chạy cho từng “item” trong <em>chuỗi</em>. Do đó, hãy thận trọng với mọi phần code của bạn thay đổi bởi “item” đều được mã hóa chính xác để nó thực sự thay đổi! Ví dụ. nhớ sử dụng <code>[[ ]]</code> để lập chỉ mục.</p>
<p>Trong ví dụ dưới đây, chúng tôi lặp lại từng hàng trong <code>linelist</code>. Giá trị <code>gender</code> và <code>age</code> của mỗi hàng được dán lại với nhau và được lưu trữ trong vector ký tự vùng chứa <code>cases_demographics</code>. Lưu ý cách chúng tôi cũng sử dụng lập chỉ mục <code>[[i]]</code> để lưu đầu ra của vòng lặp vào vị trí chính xác trong vector “container”.</p>
<div class="sourceCode" id="cb765"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create container to store results - a character vector</span>
<span class="va">cases_demographics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"character"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span><span class="op">)</span>

<span class="co"># the for loop</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
  <span class="co"># OPERATIONS</span>
  <span class="co"># extract values from linelist for row i, using brackets for indexing</span>
  <span class="va">row_gender</span>  <span class="op">&lt;-</span> <span class="va">linelist</span><span class="op">$</span><span class="va">gender</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
  <span class="va">row_age</span>     <span class="op">&lt;-</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>    <span class="co"># don't forget to index!</span>
     
  <span class="co"># combine gender-age and store in container vector at indexed location</span>
  <span class="va">cases_demographics</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">str_c</span><span class="op">(</span><span class="va">row_gender</span>, <span class="va">row_age</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span> 

<span class="op">}</span>  <span class="co"># end for loop</span>


<span class="co"># display first 10 rows of container</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cases_demographics</span>, <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "m,2"  "f,3"  "m,56" "f,18" "m,3"  "f,16" "f,16" "f,0"  "m,61" "f,27"</code></pre>
</div>
<div id="vùng-chứa" class="section level3 unnumbered">
<h3>Vùng chứa<a class="anchor" aria-label="anchor" href="#v%C3%B9ng-ch%E1%BB%A9a"><i class="fas fa-link"></i></a>
</h3>
<p>Đôi khi kết quả của <em>vòng lặp for</em> của bạn sẽ được in ra console hoặc cửa sổ RStudio Plots. Lần khác, bạn sẽ muốn lưu trữ các kết quả đầu ra trong một “vùng chứa” để sử dụng sau này. Một vùng chứa như vậy có thể là một vector, một data frame hoặc thậm chí là một danh sách.</p>
<p>Hiệu quả nhất là tạo vùng chứa cho các kết quả thậm chí <em>trước</em> khi bắt đầu <em>vòng lặp for</em>. Trong thực tế, điều này có nghĩa là tạo một vector, data frame hoặc danh sách trống. Chúng có thể được tạo bằng các hàm <code><a href="https://rdrr.io/r/base/vector.html">vector()</a></code> cho vectors hoặc danh sách, hoặc với <code><a href="https://rdrr.io/r/base/matrix.html">matrix()</a></code> và <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code> cho một data frame.</p>
<p><strong>Vector trống</strong></p>
<p>Sử dụng <code><a href="https://rdrr.io/r/base/vector.html">vector()</a></code> và chỉ định <code>mode =</code> dựa trên lớp phân loại dự kiến của các đối tượng mà bạn sẽ chèn - “double” (để giữ số), “ký tự” hoặc “logic”. Bạn cũng nên đặt trước <code>length =</code>. Đây phải là độ dài chuỗi <em>vòng lặp for</em> của bạn.</p>
<p>Giả sử bạn muốn lưu trữ thời gian nhập viện trễ trung bình cho mỗi bệnh viện. Bạn sẽ sử dụng “double” và đặt độ dài là số đầu ra dự kiến (số bệnh viện duy nhất trong data set).</p>
<div class="sourceCode" id="cb767"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">delays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>
  mode <span class="op">=</span> <span class="st">"double"</span>,                            <span class="co"># we expect to store numbers</span>
  length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># the number of unique hospitals in the dataset</span></code></pre></div>
<p><strong>Data frame trống</strong></p>
<p>Bạn có thể tạo một data frame trống bằng cách chỉ định số hàng và cột như sau:</p>
<div class="sourceCode" id="cb768"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">delays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong>Danh sách trống</strong></p>
<p>Bạn có thể muốn lưu trữ một số biểu đồ được tạo bởi <em>vòng lặp for</em> trong danh sách. Một danh sách giống như vector, nhưng chứa các đối tượng R khác bên trong nó có thể thuộc các lớp khác nhau. Các phần tử trong danh sách có thể là một số, một dataframe, một vector và thậm chí là một danh sách khác.</p>
<p>Bạn thực sự khởi tạo một danh sách trống bằng cách sử dụng cùng một lệnh <code><a href="https://rdrr.io/r/base/vector.html">vector()</a></code> như trên, nhưng với <code>mode = "list"</code>. Chỉ định độ dài như bạn muốn.</p>
<div class="sourceCode" id="cb769"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></code></pre></div>
</div>
<div id="in-1" class="section level3 unnumbered">
<h3>In<a class="anchor" aria-label="anchor" href="#in-1"><i class="fas fa-link"></i></a>
</h3>
<p>Lưu ý rằng để in từ bên trong <em>vòng lặp for</em>, bạn có thể sẽ cần phải đưa hàm <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> vào.</p>
<p>Trong ví dụ dưới đây, chuỗi là một vector ký tự rõ ràng, được sử dụng để đặt linelist con theo bệnh viện. Kết quả không được lưu trữ trong vùng chứa mà được in ra console với hàm <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>.</p>
<div class="sourceCode" id="cb770"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">hosp</span> <span class="kw">in</span> <span class="va">hospital_names</span><span class="op">)</span><span class="op">{</span> 
     <span class="va">hospital_cases</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="va">hosp</span><span class="op">)</span>
     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">hospital_cases</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## [1] 885
## [1] 1469
## [1] 422
## [1] 1762
## [1] 896
## [1] 454</code></pre>
</div>
<div id="kiểm-tra-vòng-lặp-for" class="section level3 unnumbered">
<h3>Kiểm tra vòng lặp for<a class="anchor" aria-label="anchor" href="#ki%E1%BB%83m-tra-v%C3%B2ng-l%E1%BA%B7p-for"><i class="fas fa-link"></i></a>
</h3>
<p>Để kiểm tra vòng lặp của mình, bạn có thể chạy lệnh để gán tạm thời “item”, chẳng hạn như <code>i &lt;- 10</code> hoặc <code>hosp &lt;- "Central Hospital"</code>. Thực hiện việc này <em>bên ngoài vòng lặp</em> và sau đó chỉ chạy code thao tác của bạn (code trong dấu ngoặc nhọn) để xem liệu kết quả mong đợi có được tạo ra hay không.</p>
</div>
<div id="lặp-lại-biểu-đồ" class="section level3 unnumbered">
<h3>Lặp lại biểu đồ<a class="anchor" aria-label="anchor" href="#l%E1%BA%B7p-l%E1%BA%A1i-bi%E1%BB%83u-%C4%91%E1%BB%93"><i class="fas fa-link"></i></a>
</h3>
<p>Để đặt tất cả ba thành phần lại với nhau (vùng chứa, trình tự và thao tác), chúng ta hãy cố gắng vẽ biểu đồ đường cong dịch bệnh cho mỗi bệnh viện (xem chương <a href="epicurves.html#epicurves">Đường cong dịch bệnh</a>).</p>
<p>Chúng tôi có thể tạo ra một đường cong dịch bệnh đẹp về <em>tất cả</em> các trường hợp theo giới tính bằng cách sử dụng package <strong>incidence2</strong> như bên dưới:</p>
<div class="sourceCode" id="cb772"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create 'incidence' object</span>
<span class="va">outbreak</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/incidence2/man/incidence.html">incidence</a></span><span class="op">(</span>   
     x <span class="op">=</span> <span class="va">linelist</span>,                   <span class="co"># dataframe - complete linelist</span>
     date_index <span class="op">=</span> <span class="va">date_onset</span>,        <span class="co"># date column</span>
     interval <span class="op">=</span> <span class="st">"week"</span>,              <span class="co"># aggregate counts weekly</span>
     groups <span class="op">=</span> <span class="va">gender</span>,                <span class="co"># group values by gender</span>
     na_as_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>             <span class="co"># missing gender is own group</span>

<span class="co"># plot epi curve</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">outbreak</span>,                       <span class="co"># name of incidence object</span>
     fill <span class="op">=</span> <span class="st">"gender"</span>,                <span class="co"># color bars by gender</span>
     color <span class="op">=</span> <span class="st">"black"</span>,                <span class="co"># outline color of bars</span>
     title <span class="op">=</span> <span class="st">"Outbreak of ALL cases"</span> <span class="co"># title</span>
     <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-600-1.png" width="672"></div>
<p>Để tạo ra một biểu đồ riêng cho từng trường hợp của bệnh viện, chúng ta có thể đặt code đường cong dịch bệnh này trong <em>vòng lặp for</em>.</p>
<p>Đầu tiên, chúng tôi lưu một vector được đặt tên duy nhất của các tên bệnh viện, <code>hospital_names</code>. <em>Vòng lặp for</em> sẽ chạy một lần cho mỗi tên sau: <code>for (hosp in hospital_names)</code>. Mỗi lần lặp lại của <em>vòng lặp for</em>, tên bệnh viện hiện tại từ vector sẽ được biểu diễn dưới dạng <code>hosp</code> để sử dụng trong vòng lặp.</p>
<p>Trong các thao tác vòng lặp, bạn có thể viết code R như bình thường, nhưng cần biết rằng giá trị của “item” (<code>hosp</code> trong trường hợp này) sẽ thay đổi. Trong vòng lặp này:</p>
<ul>
<li>Một <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> được áp dụng cho <code>linelist</code>, sao cho cột <code>hospital</code> phải bằng giá trị hiện tại của <code>hosp</code><br>
</li>
<li>Đối tượng tỷ lệ mắc được tạo trên linelist đã lọc<br>
</li>
<li>Biểu đồ cho bệnh viện hiện tại được tạo, với tiêu đề tự động điều chỉnh sử dụng <code>hosp</code><br>
</li>
<li>Biểu đồ cho bệnh viện hiện tại được lưu tạm thời và sau đó được in<br>
</li>
<li>Sau đó, vòng lặp di chuyển tiếp để lặp lại với bệnh viện tiếp theo trong <code>hospital_names</code>
</li>
</ul>
<div class="sourceCode" id="cb773"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make vector of the hospital names</span>
<span class="va">hospital_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span>

<span class="co"># for each name ("hosp") in hospital_names, create and print the epi curve</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">hosp</span> <span class="kw">in</span> <span class="va">hospital_names</span><span class="op">)</span> <span class="op">{</span>
     
     <span class="co"># create incidence object specific to the current hospital</span>
     <span class="va">outbreak_hosp</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/incidence2/man/incidence.html">incidence</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="va">hosp</span><span class="op">)</span>,   <span class="co"># linelist is filtered to the current hospital</span>
          date_index <span class="op">=</span> <span class="va">date_onset</span>,
          interval <span class="op">=</span> <span class="st">"week"</span>, 
          groups <span class="op">=</span> <span class="va">gender</span>,
          na_as_group <span class="op">=</span> <span class="cn">TRUE</span>
     <span class="op">)</span>
     
     <span class="co"># Create and save the plot. Title automatically adjusts to the current hospital</span>
     <span class="va">plot_hosp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
       <span class="va">outbreak_hosp</span>,
       fill <span class="op">=</span> <span class="st">"gender"</span>,
       color <span class="op">=</span> <span class="st">"black"</span>,
       title <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Epidemic of cases admitted to {hosp}"</span><span class="op">)</span>
     <span class="op">)</span>
     
     <span class="co"># print the plot for the current hospital</span>
     <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot_hosp</span><span class="op">)</span>
     
<span class="op">}</span> <span class="co"># end the for loop when it has been run for every hospital in hospital_names </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-601-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-601-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-601-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-601-4.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-601-5.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-601-6.png" width="50%"></p>
</div>
<div id="theo-dõi-tiến-trình-của-một-vòng-lặp" class="section level3 unnumbered">
<h3>Theo dõi tiến trình của một vòng lặp<a class="anchor" aria-label="anchor" href="#theo-d%C3%B5i-ti%E1%BA%BFn-tr%C3%ACnh-c%E1%BB%A7a-m%E1%BB%99t-v%C3%B2ng-l%E1%BA%B7p"><i class="fas fa-link"></i></a>
</h3>
<p>Một vòng lặp có nhiều lần lặp có thể chạy trong nhiều phút hoặc thậm chí hàng giờ. Do đó, có thể hữu ích khi in tiến trình ra R console. Câu lệnh <code>if</code> dưới đây có thể được đặt <em>trong</em> các thao tác vòng lặp để in mỗi số thứ 100. Chỉ cần điều chỉnh nó để <code>i</code> là “item” trong vòng lặp của bạn.</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb774-1"><a href="iteration.html#cb774-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loop with code to print progress every 100 iterations</span></span>
<span id="cb774-2"><a href="iteration.html#cb774-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(linelist))){</span>
<span id="cb774-3"><a href="iteration.html#cb774-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb774-4"><a href="iteration.html#cb774-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print progress</span></span>
<span id="cb774-5"><a href="iteration.html#cb774-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">%%</span> <span class="dv">100</span><span class="sc">==</span><span class="dv">0</span>){    <span class="co"># The %% operator is the remainder</span></span>
<span id="cb774-6"><a href="iteration.html#cb774-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(i)</span>
<span id="cb774-7"><a href="iteration.html#cb774-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb774-8"><a href="iteration.html#cb774-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="iter_purrr" class="section level2" number="16.3">
<h2>
<span class="header-section-number">16.3</span> <strong>purrr</strong> và các danh sách<a class="anchor" aria-label="anchor" href="#iter_purrr"><i class="fas fa-link"></i></a>
</h2>
<p>Một cách tiếp cận khác đối với các thao tác lặp là package <strong>purrr</strong> - nó là phương pháp <strong>tidyverse</strong> để lặp lại.</p>
<p>Nếu bạn phải thực hiện cùng một tác vụ nhiều lần, có lẽ bạn nên tạo một giải pháp tổng thể có thể sử dụng trên nhiều đầu vào. Ví dụ: tạo các biểu đồ cho nhiều khu vực pháp lý, hoặc nhập và kết hợp nhiều tệp.</p>
<p>Ngoài ra còn có một số lợi thế khác đối với <strong>purrr</strong> - bạn có thể sử dụng nó với các pipes <code>%&gt;%</code>, nó xử lý lỗi tốt hơn <em>vòng lặp for</em> bình thường, và có cú pháp khá rõ ràng và đơn giản! Nếu bạn đang sử dụng <em>vòng lặp for</em>, bạn có thể tạo vòng lặp rõ ràng và ngắn gọn hơn với <strong>purrr</strong>!</p>
<p>Hãy nhớ rằng <strong>purrr</strong> là một <em>công cụ lập trình theo hàm</em>. Có nghĩa là, các thao tác lặp đi lặp lại được gói gọn trong <em>các hàm</em>. Xem chương <a href="writing-functions.html#writing-functions">Viết hàm</a> để tìm hiểu cách viết hàm của riêng bạn.</p>
<p><strong>purrr</strong> cũng gần như hoàn toàn dựa trên <em>danh sách</em> và <em>vectors</em> - vì vậy hãy nghĩ về nó như là áp dụng một hàm cho mỗi phần tử của danh sách/vector đó!</p>
<div id="tải-packages" class="section level3 unnumbered">
<h3>Tải packages<a class="anchor" aria-label="anchor" href="#t%E1%BA%A3i-packages"><i class="fas fa-link"></i></a>
</h3>
<p><strong>purrr</strong> là một phần của <strong>tidyverse</strong>, vì vậy không cần cài đặt/tải một package riêng biệt.</p>
<div class="sourceCode" id="cb775"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
     <span class="va">rio</span>,            <span class="co"># import/export</span>
     <span class="va">here</span>,           <span class="co"># relative filepaths</span>
     <span class="va">tidyverse</span>,      <span class="co"># data mgmt and viz</span>
     <span class="va">writexl</span>,        <span class="co"># write Excel file with multiple sheets</span>
     <span class="va">readxl</span>          <span class="co"># import Excel with multiple sheets</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="map" class="section level3 unnumbered">
<h3>
<code>map()</code><a class="anchor" aria-label="anchor" href="#map"><i class="fas fa-link"></i></a>
</h3>
<p>Một hàm cốt lõi của <strong>purrr</strong> là <code>map()</code>, hàm này “maps” (áp dụng) một hàm cho từng phần tử đầu vào của danh sách/vector bạn cung cấp.</p>
<p>Cú pháp cơ bản là <code>map(.x = SEQUENCE, .f = HÀM, CÁC ĐỐI SỐ KHÁC)</code>. Chi tiết hơn như sau:</p>
<ul>
<li>
<code>.x =</code> là các <em>đầu vào</em> mà hàm <code>.f</code> sẽ được áp dụng lặp đi lặp lại - ví dụ: vector của tên các khu vực pháp lý, các cột trong data frame hoặc danh sách các data frame<br>
</li>
<li>
<code>.f =</code> là <em>hàm</em> áp dụng cho từng phần tử của đầu vào <code>.x</code> - nó có thể là một hàm như <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> đã tồn tại hoặc một hàm tùy chỉnh mà bạn xác định. Hàm thường được viết sau dấu ngã <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code> (chi tiết bên dưới).</li>
</ul>
<p>Thêm một số lưu ý về cú pháp:</p>
<ul>
<li>Nếu hàm không cần chỉ định thêm đối số, nó có thể được viết không có dấu ngoặc đơn và không có dấu ngã (ví dụ: <code>.f = mean</code>). Để cung cấp các đối số sẽ có cùng giá trị cho mỗi lần lặp, hãy cung cấp chúng trong <code>map()</code> nhưng bên ngoài đối số <code>.f =</code>, chẳng hạn như <code>na.rm = T</code> trong <code>map(.x = my_list, .f = mean, na.rm=T)</code>.<br>
</li>
<li>Bạn có thể sử dụng <code>.x</code> (hoặc đơn giản là <code>.</code>) <em>bên trong</em> hàm <code>.f =</code> làm trình giữ chỗ cho giá trị <code>.x</code> của lần lặp đó<br>
</li>
<li>Sử dụng cú pháp dấu ngã (<code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>) để kiểm soát hàm nhiều hơn - viết hàm như bình thường với dấu ngoặc đơn, chẳng hạn như: <code>map(.x = my_list, .f = ~mean(., na.rm = T))</code>. Sử dụng cú pháp này đặc biệt nếu giá trị của một đối số sẽ thay đổi mỗi lần lặp lại hoặc nếu nó là chính giá trị <code>.x</code> (xem ví dụ bên dưới)</li>
</ul>
<p>** Đầu ra của việc sử dụng <code>map()</code> là một <em>danh sách</em>** - một danh sách là một lớp đối tượng giống như một vector nhưng các phần tử của nó có thể thuộc các lớp khác nhau. Vì vậy, một danh sách được tạo bởi <code>map()</code> có thể chứa nhiều data frames, hoặc nhiều vector, nhiều giá trị đơn lẻ, hoặc thậm chí nhiều danh sách! Có các phiên bản thay thế của <code>map()</code> được giải thích bên dưới, tạo ra các loại kết quả khác (ví dụ: <code>map_dfr()</code> để tạo data frame, <code>map_chr()</code> để tạo vectors ký tự và <code>map_dbl()</code> để tạo vectors số).</p>
<div id="iter_combined" class="section level4 unnumbered">
<h4>Ví dụ - nhập và kết hợp các trang tính Excel<a class="anchor" aria-label="anchor" href="#iter_combined"><i class="fas fa-link"></i></a>
</h4>
<p><strong>Hãy biểu diễn với một công việc thường gặp của nhà dịch tễ học:</strong> - <em>Bạn muốn nhập một Excel workbook với dữ liệu trường hợp bệnh, nhưng dữ liệu được chia thành các trang tính có tên khác nhau trong workbook. Làm cách nào để bạn nhập và kết hợp các trang tính vào một data frame một cách hiệu quả?</em></p>
<p>Giả sử chúng tôi được gửi Excel workbook bên dưới. Mỗi trang tính chứa các trường hợp từ một bệnh viện nhất định.</p>
<div class="inline-figure"><img src="images/hospital_linelists_excel_sheets.png" width="615" style="display: block; margin: auto;"></div>
<p>Đây là một cách tiếp cận sử dụng <code>map()</code>:</p>
<ol style="list-style-type: decimal">
<li>
<code>map()</code> hàm <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> để nó chạy qua mỗi trang tính Excel<br>
</li>
<li>Kết hợp các data frames đã nhập thành một bằng cách sử dụng <code>bind_rows()</code><br>
</li>
<li>Trong khi đó, hãy giữ nguyên tên trang tính ban đầu cho mỗi hàng, lưu trữ thông tin này trong một cột mới trong data frame cuối cùng</li>
</ol>
<p>Đầu tiên, chúng ta cần trích xuất tên trang tính và lưu chúng. Chúng tôi cung cấp đường dẫn tệp của Excel workbook tới hàm <code>excel_sheets()</code> từ package <strong>readxl</strong>, sẽ trích xuất tên trang tính. Chúng tôi lưu trữ chúng trong một vector ký tự được gọi là <code>sheet_names</code>.</p>
<div class="sourceCode" id="cb776"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sheet_names</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="st">"hospital_linelists.xlsx"</span><span class="op">)</span></code></pre></div>
<p>Đây là các tên trang tính:</p>
<div class="sourceCode" id="cb777"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sheet_names</span></code></pre></div>
<pre><code>## [1] "Central Hospital"              "Military Hospital"             "Missing"                       "Other"                        
## [5] "Port Hospital"                 "St. Mark's Maternity Hospital"</code></pre>
<p>Bây giờ chúng ta có tên của vector này, <code>map()</code> có thể cung cấp từng cái một cho hàm <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code>. Trong ví dụ này, <code>sheet_names</code> là <code>.x</code> và <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> là hàm <code>.f</code>.</p>
<p>Nhớ lại từ chương [Nhập và xuất dữ liệu], khi sử dụng trên Excel workbooks, <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> có thể chấp nhận đối số <code>which =</code> để chỉ định trang tính để nhập. Trong hàm <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> của <code>.f</code>, chúng tôi cung cấp <code>which = .x</code>, giá trị của nó sẽ thay đổi theo mỗi lần lặp thông qua vector <code>sheet_names</code> - đầu tiên là “Central Hospital”, sau đó là “Military Hospital”, v.v.</p>
<p>Lưu ý - bởi vì chúng tôi đã sử dụng <code>map()</code>, dữ liệu trong mỗi trang tính Excel sẽ được lưu thành một data frame riêng biệt trong danh sách. Chúng tôi muốn mỗi phần tử danh sách này (data frames) có một <em>tên</em>, vì vậy trước khi chuyển <code>sheet_names</code> đến <code>map()</code>, chúng tôi chuyển nó qua <code>set_names()</code> từ <strong>purrr</strong>, điều này đảm bảo rằng mỗi phần tử danh sách nhận được tên thích hợp.</p>
<p>Chúng tôi lưu danh sách đầu ra dưới dạng <code>combined</code>.</p>
<div class="sourceCode" id="cb779"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">combined</span> <span class="op">&lt;-</span> <span class="va">sheet_names</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">map</span><span class="op">(</span>.f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"hospital_linelists.xlsx"</span>, which <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Khi kiểm tra đầu ra, chúng ta thấy rằng dữ liệu từ mỗi trang tính Excel được lưu trong danh sách với một tên. Điều này là tốt, nhưng chúng ta chưa kết thúc ở đây.</p>
<div class="inline-figure"><img src="images/sheets_as_list.png" width="544" style="display: block; margin: auto;"></div>
<p>Cuối cùng, chúng tôi sử dụng hàm <code>bind_rows()</code> (từ <strong>dplyr</strong>) chấp nhận danh sách các data frames có cấu trúc tương tự và kết hợp chúng thành một data frame. Để tạo một cột mới từ phần tử danh sách <em>tên</em>, chúng tôi sử dụng đối số <code>.id =</code> và cung cấp cho nó tên mong muốn cho cột mới.</p>
<p>Dưới đây là toàn bộ chuỗi lệnh:</p>
<div class="sourceCode" id="cb780"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sheet_names</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="st">"hospital_linelists.xlsx"</span><span class="op">)</span>  <span class="co"># extract sheet names</span>
 
<span class="va">combined</span> <span class="op">&lt;-</span> <span class="va">sheet_names</span> <span class="op">%&gt;%</span>                                     <span class="co"># begin with sheet names</span>
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>                                        <span class="co"># set their names</span>
  <span class="fu">map</span><span class="op">(</span>.f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"hospital_linelists.xlsx"</span>, which <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># iterate, import, save in list</span>
  <span class="fu">bind_rows</span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"origin_sheet"</span><span class="op">)</span> <span class="co"># combine list of data frames, preserving origin in new column  </span></code></pre></div>
<p>Và bây giờ chúng ta có một data frame với một cột chứa trang tính ban đầu!</p>
<div class="inline-figure"><img src="images/sheets_as_df.png" width="543" style="display: block; margin: auto;"></div>
<p>Có những biến thể của <code>map()</code> mà bạn nên biết. Ví dụ: <code>map_dfr()</code> trả về data frame, không phải danh sách. Vì vậy, chúng ta có thể đã sử dụng nó cho tác vụ ở trên và không cần phải ràng buộc các hàng. Nhưng sau đó chúng ta sẽ không thể nắm bắt được trường hợp nào đến từ trang tính nào (bệnh viện).</p>
<p>Các biến thể khác bao gồm <code>map_chr()</code>, <code>map_dbl()</code>. Đây là những hàm rất hữu ích vì hai lý do. Trước hết, chúng tự động chuyển đổi đầu ra của một hàm lặp thành một vector (không phải danh sách). Thứ hai, chúng có thể kiểm soát rõ ràng lớp mà dữ liệu quay trở lại - bạn đảm bảo rằng dữ liệu của bạn quay trở lại dưới dạng vector ký tự với <code>map_chr()</code>, hoặc vector số với <code>map_dbl()</code>. Hãy quay lại những hàm này sau trong phần sau!</p>
<p>Các hàm <code>map_at()</code> và <code>map_if()</code> cũng rất hữu ích để lặp lại - chúng cho phép bạn chỉ định phần tử nào của danh sách nên lặp lại! Chúng hoạt động đơn giản bằng cách áp dụng một vector gồm các chỉ mục/tên (với <code>map_at()</code>) hoặc một phép kiểm tra logic (với <code>map_if()</code>).</p>
<p>Ví dụ, chúng tôi không muốn đọc trang tính đầu tiên chứa dữ liệu của bệnh viện. Chúng tôi sử dụng <code>map_at()</code> thay vì <code>map()</code> và chỉ định đối số <code>.at =</code> thành <code><a href="https://rdrr.io/r/base/c.html">c(-1)</a></code> có nghĩa là <em>không</em> sử dụng phần tử đầu tiên của <code>.x</code>. Ngoài ra, bạn có thể cung cấp một vector gồm các số dương hoặc tên cho <code>.at =</code> để chỉ định phần tử nào sẽ sử dụng.</p>
<div class="sourceCode" id="cb781"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sheet_names</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="st">"hospital_linelists.xlsx"</span><span class="op">)</span>

<span class="va">combined</span> <span class="op">&lt;-</span> <span class="va">sheet_names</span> <span class="op">%&gt;%</span> 
     <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
     <span class="co"># exclude the first sheet</span>
     <span class="fu">map_at</span><span class="op">(</span>.f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span> <span class="st">"hospital_linelists.xlsx"</span>, which <span class="op">=</span> <span class="va">.x</span><span class="op">)</span>,
            .at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Lưu ý rằng tên trang tính đầu tiên sẽ vẫn xuất hiện như một phần tử của danh sách đầu ra - nhưng nó chỉ là một tên ký tự đơn lẻ (không phải là một data frame). Bạn sẽ cần phải loại bỏ phần tử này trước khi liên kết các hàng. Chúng tôi sẽ trình bày cách xóa và sửa đổi các phần tử danh sách trong phần sau.</p>
</div>
</div>
<div id="tách-và-xuất-bộ-dữ-liệu" class="section level3 unnumbered">
<h3>Tách và xuất bộ dữ liệu<a class="anchor" aria-label="anchor" href="#t%C3%A1ch-v%C3%A0-xu%E1%BA%A5t-b%E1%BB%99-d%E1%BB%AF-li%E1%BB%87u"><i class="fas fa-link"></i></a>
</h3>
<p>Dưới đây, chúng tôi đưa ra một ví dụ về cách tách bộ dữ liệu thành các phần và sau đó sử dụng phép lặp <code>map()</code> để xuất từng phần dưới dạng trang tính Excel riêng biệt hoặc dưới dạng tệp CSV riêng biệt.</p>
<div id="tách-bộ-dữ-liệu" class="section level4 unnumbered">
<h4>Tách bộ dữ liệu<a class="anchor" aria-label="anchor" href="#t%C3%A1ch-b%E1%BB%99-d%E1%BB%AF-li%E1%BB%87u"><i class="fas fa-link"></i></a>
</h4>
<p>Giả sử chúng ta có toàn bộ trường hợp <code>linelist</code> làm data frame và bây giờ chúng ta muốn tạo một linelist riêng biệt cho từng bệnh viện và xuất từng trường hợp dưới dạng tệp CSV riêng biệt. Dưới đây, chúng tôi thực hiện các bước sau:</p>
<p>Sử dụng <code>group_split()</code> (từ <strong>dplyr</strong>) để tách data frame <code>linelist</code> theo các giá trị duy nhất trong cột <code>hospital</code>. Đầu ra là một danh sách chứa một data frame cho mỗi tập hợp con của bệnh viện.</p>
<div class="sourceCode" id="cb782"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_split</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
     <span class="fu">group_split</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<p>Chúng ta có thể chạy <code><a href="https://rdrr.io/r/utils/View.html">View(linelist_split)</a></code> và thấy rằng danh sách này chứa 6 data frames (“tibbles”), mỗi khung đại diện cho các trường hợp từ một bệnh viện.</p>
<div class="inline-figure"><img src="images/purrr_linelist_split.png" width="574" style="display: block; margin: auto;"></div>
<p>Tuy nhiên, lưu ý rằng các data frames trong danh sách không có tên theo mặc định! Chúng tôi muốn mỗi người có một tên và sau đó sử dụng tên đó khi lưu tệp CSV.</p>
<p>Một cách tiếp cận để trích xuất các tên là sử dụng <code>pull()</code> (từ <strong>dplyr</strong>) để trích xuất cột <code>hospital</code> từ mỗi data frame trong danh sách. Sau đó, để an toàn, chúng tôi chuyển đổi các giá trị thành ký tự và sau đó sử dụng <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code> để lấy tên cho data frame cụ thể đó. Tất cả các bước này được áp dụng cho từng data frame thông qua <code>map()</code>.</p>
<div class="sourceCode" id="cb783"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist_split</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">linelist_split</span> <span class="op">%&gt;%</span>   <span class="co"># Assign to names of listed data frames </span>
     <span class="co"># Extract the names by doing the following to each data frame: </span>
     <span class="fu">map</span><span class="op">(</span>.f <span class="op">=</span> <span class="op">~</span><span class="fu">pull</span><span class="op">(</span><span class="va">.x</span>, <span class="va">hospital</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>        <span class="co"># Pull out hospital column</span>
     <span class="fu">map</span><span class="op">(</span>.f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>          <span class="co"># Convert to character, just in case</span>
     <span class="fu">map</span><span class="op">(</span>.f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span>                    <span class="co"># Take the unique hospital name</span></code></pre></div>
<p>Bây giờ chúng ta có thể thấy rằng mỗi phần tử trong danh sách đều có một tên. Những tên này có thể được truy cập thông qua <code><a href="https://rdrr.io/r/base/names.html">names(linelist_split)</a></code>.</p>
<div class="inline-figure"><img src="images/purrr_linelist_split_named.png" width="575" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb784"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist_split</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Central Hospital"                     "Military Hospital"                    "Missing"                             
## [4] "Other"                                "Port Hospital"                        "St. Mark's Maternity Hospital (SMMH)"</code></pre>
<div id="nhiều-hơn-một-cột-group_split" class="section level5 unnumbered">
<h5>Nhiều hơn một cột <code>group_split()</code><a class="anchor" aria-label="anchor" href="#nhi%E1%BB%81u-h%C6%A1n-m%E1%BB%99t-c%E1%BB%99t-group_split"><i class="fas fa-link"></i></a>
</h5>
<p>Nếu bạn muốn chia linelist theo <em>nhiều hơn một nhóm cột</em>, chẳng hạn như để tạo tập hợp con linelist theo giao điểm của bệnh viện VÀ giới tính, bạn sẽ cần một cách tiếp cận khác để đặt tên cho các phần tử danh sách. Điều này liên quan đến việc thu thập các “nhóm chính (group keys)” duy nhất bằng cách sử dụng <code>group_keys()</code> từ <strong>dplyr</strong> - chúng được trả về dưới dạng một data frame. Sau đó, bạn có thể kết hợp các nhóm chính thành các giá trị với <code>unite()</code> như được hiển thị bên dưới và gán các tên tập nhóm này cho <code>linelist_split</code>.</p>
<div class="sourceCode" id="cb786"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># split linelist by unique hospital-gender combinations</span>
<span class="va">linelist_split</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
     <span class="fu">group_split</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">gender</span><span class="op">)</span>

<span class="co"># extract group_keys() as a dataframe</span>
<span class="va">groupings</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
     <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">gender</span><span class="op">)</span> <span class="op">%&gt;%</span>       
     <span class="fu">group_keys</span><span class="op">(</span><span class="op">)</span>

<span class="va">groupings</span>      <span class="co"># show unique groupings </span></code></pre></div>
<pre><code>## # A tibble: 18 x 2
##    hospital                             gender
##    &lt;chr&gt;                                &lt;chr&gt; 
##  1 Central Hospital                     f     
##  2 Central Hospital                     m     
##  3 Central Hospital                     &lt;NA&gt;  
##  4 Military Hospital                    f     
##  5 Military Hospital                    m     
##  6 Military Hospital                    &lt;NA&gt;  
##  7 Missing                              f     
##  8 Missing                              m     
##  9 Missing                              &lt;NA&gt;  
## 10 Other                                f     
## 11 Other                                m     
## 12 Other                                &lt;NA&gt;  
## 13 Port Hospital                        f     
## 14 Port Hospital                        m     
## 15 Port Hospital                        &lt;NA&gt;  
## 16 St. Mark's Maternity Hospital (SMMH) f     
## 17 St. Mark's Maternity Hospital (SMMH) m     
## 18 St. Mark's Maternity Hospital (SMMH) &lt;NA&gt;</code></pre>
<p>Bây giờ chúng ta kết hợp các nhóm với nhau, được phân tách bằng dấu gạch ngang và gán chúng làm tên của các phần tử danh sách trong <code>linelist_split</code>. Thao tác này sẽ mất thêm vài dòng khi chúng ta thay thế <code>NA</code> bằng “Missing”, sử dụng <code>unite()</code> từ <strong>dplyr</strong> để kết hợp các giá trị cột với nhau (phân tách bằng dấu gạch ngang), sau đó chuyển đổi thành vector không tên để nó có thể được dùng làm tên của <code>linelist_split</code>.</p>
<div class="sourceCode" id="cb788"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Combine into one name value </span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist_split</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">groupings</span> <span class="op">%&gt;%</span> 
     <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="va">replace_na</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># replace NA with "Missing" in all columns</span>
     <span class="fu">unite</span><span class="op">(</span><span class="st">"combined"</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span> <span class="op">%&gt;%</span>                         <span class="co"># Unite all column values into one</span>
     <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">%&gt;%</span> 
     <span class="fu">as_vector</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
     <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="xuất-dưới-dạng-trang-tính-excel" class="section level4 unnumbered">
<h4>Xuất dưới dạng trang tính Excel<a class="anchor" aria-label="anchor" href="#xu%E1%BA%A5t-d%C6%B0%E1%BB%9Bi-d%E1%BA%A1ng-trang-t%C3%ADnh-excel"><i class="fas fa-link"></i></a>
</h4>
<p>Để xuất linelists bệnh viện dưới dạng <em>Excel workbook với một linelist trên mỗi trang tính</em>, chúng tôi chỉ có thể cung cấp danh sách có tên <code>linelist_split</code> cho hàm <code>write_xlsx()</code> từ package <strong>writexl</strong>. Điều này có khả năng lưu một Excel workbook với nhiều trang tính. Tên phần tử danh sách được tự động áp dụng làm tên trang tính.</p>
<div class="sourceCode" id="cb789"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_split</span> <span class="op">%&gt;%</span> 
     <span class="fu">writexl</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/writexl/reference/write_xlsx.html">write_xlsx</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"hospital_linelists.xlsx"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Bây giờ bạn có thể mở tệp Excel và thấy rằng mỗi bệnh viện có một trang tính riêng.</p>
<div class="inline-figure"><img src="images/purrr_export_sheets.png" width="652" style="display: block; margin: auto;"></div>
</div>
<div id="xuất-dưới-dạng-tệp-csv" class="section level4 unnumbered">
<h4>Xuất dưới dạng tệp CSV<a class="anchor" aria-label="anchor" href="#xu%E1%BA%A5t-d%C6%B0%E1%BB%9Bi-d%E1%BA%A1ng-t%E1%BB%87p-csv"><i class="fas fa-link"></i></a>
</h4>
<p>Đây là lệnh phức tạp hơn một chút, nhưng bạn cũng có thể xuất từng linelist dành riêng cho bệnh viện dưới dạng tệp CSV riêng biệt, với tên tệp dành riêng cho bệnh viện.</p>
<p>Một lần nữa, chúng tôi sử dụng <code>map()</code>: chúng tôi lấy vector của tên phần tử danh sách (được hiển thị ở trên) và sử dụng <code>map()</code> để lặp lại chúng, áp dụng <code><a href="https://rdrr.io/pkg/rio/man/export.html">export()</a></code> (từ package <strong>rio</strong>, xem chương [Nhập và xuất dữ liệu]) trên data frame với danh sách <code>linelist_split</code> có tên đó. Chúng tôi cũng sử dụng tên để tạo một tên tệp duy nhất. Đây là các bước thực hiện:</p>
<ul>
<li>Chúng ta bắt đầu với vector tên kí tự, được chuyển tới <code>map()</code> dưới dạng <code>.x</code><br>
</li>
<li>Hàm <code>.f</code> là <code><a href="https://rdrr.io/pkg/rio/man/export.html">export()</a></code>, hàm này yêu cầu một data frame và một đường dẫn tệp để ghi vào<br>
</li>
<li>Đầu vào <code>.x</code> (tên bệnh viện) được sử dụng <em>trong</em> <code>.f</code> để trích xuất/lập chỉ mục phần tử cụ thể đó của danh sách <code>linelist_split</code>. Điều này làm cho mỗi lần chỉ một data frame được cung cấp cho <code><a href="https://rdrr.io/pkg/rio/man/export.html">export()</a></code>.<br>
</li>
<li>Ví dụ: khi <code>map()</code> lặp lại cho “Military Hospital”, thì <code>linelist_split[[.x]]</code> sẽ là <code>linelist_split[["Military Hospital"]]</code>, do đó trả về phần tử thứ hai của <code>linelist_split</code> - đó là tất cả các trường hợp từ Military Hospital.<br>
</li>
<li>Đường dẫn tệp được cung cấp cho <code><a href="https://rdrr.io/pkg/rio/man/export.html">export()</a></code> là động thông qua việc sử dụng <code>str_glue()</code> (xem chương <a href="characters-strings.html#characters-strings">Ký tự và chuỗi</a>):
<ul>
<li>
<code><a href="https://here.r-lib.org//reference/here.html">here()</a></code> được sử dụng để lấy cơ sở của đường dẫn tệp và chỉ định thư mục “data” (lưu ý dấu nháy đơn để không làm gián đoạn dấu ngoặc kép <code>str_glue()</code>)<br>
</li>
</ul>
</li>
<li>Sau đó là dấu gạch chéo <code><a href="https://rdrr.io/r/base/Arithmetic.html">/</a></code>, rồi lại <code>.x</code> in tên bệnh viện hiện tại để làm cho tệp có thể nhận dạng được<br>
</li>
<li>Cuối cùng là phần mở rộng “.csv” mà <code><a href="https://rdrr.io/pkg/rio/man/export.html">export()</a></code> sử dụng để tạo tệp CSV</li>
</ul>
<div class="sourceCode" id="cb790"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist_split</span><span class="op">)</span> <span class="op">%&gt;%</span>
     <span class="fu">map</span><span class="op">(</span>.f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/export.html">export</a></span><span class="op">(</span><span class="va">linelist_split</span><span class="op">[[</span><span class="va">.x</span><span class="op">]</span><span class="op">]</span>, file <span class="op">=</span> <span class="fu">str_glue</span><span class="op">(</span><span class="st">"{here('data')}/{.x}.csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Bây giờ bạn có thể thấy rằng mỗi tệp được lưu trong thư mục “data” của Dự án R “Epi_R_handbook”!</p>
<div class="inline-figure"><img src="images/purrr_export_csv.png" width="632" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="hàm-tùy-chỉnh" class="section level3 unnumbered">
<h3>Hàm tùy chỉnh<a class="anchor" aria-label="anchor" href="#h%C3%A0m-t%C3%B9y-ch%E1%BB%89nh"><i class="fas fa-link"></i></a>
</h3>
<p>Bạn có thể muốn tạo một hàm của riêng mình để đưa vào <code>map()</code>.</p>
<p>Giả sử chúng ta muốn tạo đường cong dịch bệnh cho từng trường hợp của bệnh viện. Để thực hiện việc này với <strong>purrr</strong>, hàm <code>.f</code> của chúng ta có thể là <code>ggplot()</code> và các phần mở rộng bằng <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> như bình thường. Vì đầu ra của <code>map()</code> luôn là một danh sách nên các biểu đồ được lưu trữ trong một danh sách. Bởi vì chúng là các biểu đồ, chúng có thể được trích xuất và vẽ bằng hàm <code>ggarrange()</code> từ package <strong>ggpubr</strong> (<a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">documentation</a>).</p>
<div class="sourceCode" id="cb791"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load package for plotting elements from list</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">ggpubr</span><span class="op">)</span>

<span class="co"># map across the vector of 6 hospital "names" (created earlier)</span>
<span class="co"># use the ggplot function specified</span>
<span class="co"># output is a list with 6 ggplots</span>

<span class="va">hospital_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span>

<span class="va">my_plots</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span>
  .x <span class="op">=</span> <span class="va">hospital_names</span>,
  .f <span class="op">=</span> <span class="op">~</span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
                <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
                <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="va">.x</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># print the ggplots (they are stored in a list)</span>
<span class="fu">ggarrange</span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">my_plots</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-627-1.png" width="672"></div>
<p>Nếu code <code>map()</code> này trông quá lộn xộn, bạn có thể đạt được kết quả tương tự bằng cách lưu lệnh <code>ggplot()</code> cụ thể của mình dưới dạng một hàm tùy chỉnh do người dùng xác định, ví dụ, chúng ta có thể đặt tên nó là <code>make_epicurve()</code>. Hàm này sau đó được sử dụng trong <code>map()</code>. <code>.x</code> sẽ được thay thế lặp lại bằng tên bệnh viện và được sử dụng làm <code>hosp_name</code> trong hàm <code>make_epicurve()</code>. Xem chương về <a href="writing-functions.html#writing-functions">Viết hàm</a>.</p>
<div class="sourceCode" id="cb792"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create function</span>
<span class="va">make_epicurve</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">hosp_name</span><span class="op">)</span><span class="op">{</span>
  
  <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">hospital</span> <span class="op">==</span> <span class="va">hosp_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="va">hosp_name</span><span class="op">)</span>
  
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb793"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># mapping</span>
<span class="va">my_plots</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="va">hospital_names</span>, <span class="op">~</span><span class="fu">make_epicurve</span><span class="op">(</span>hosp_name <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span>

<span class="co"># print the ggplots (they are stored in a list)</span>
<span class="fu">ggarrange</span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">my_plots</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
</div>
<div id="áp-dụng-một-hàm-qua-nhiều-cột" class="section level3 unnumbered">
<h3>Áp dụng một hàm qua nhiều cột<a class="anchor" aria-label="anchor" href="#%C3%A1p-d%E1%BB%A5ng-m%E1%BB%99t-h%C3%A0m-qua-nhi%E1%BB%81u-c%E1%BB%99t"><i class="fas fa-link"></i></a>
</h3>
<p>Một trường hợp sử dụng phổ biến khác là áp dụng một hàm trên nhiều cột. Dưới đây, chúng tôi <code>map()</code> hàm <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code> qua các cột số trong data frame <code>linelist</code>, so sánh các giá trị số theo giới tính.</p>
<p>Nhớ lại từ chương về <a href="stat-tests.html#stat-tests">Các kiểm định thống kê cơ bản</a> rằng <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code> có thể nhận đầu vào ở định dạng công thức, chẳng hạn như <code>t.test(numeric column ~ binary column)</code>. Trong ví dụ này, chúng tôi làm như sau:</p>
<ul>
<li>Các cột số được chọn từ <code>linelist</code> - những cột này trở thành đầu vào <code>.x</code> cho <code>map()</code><br>
</li>
<li>Hàm <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code> được cung cấp dưới dạng hàm <code>.f</code>, được áp dụng cho mỗi cột số<br>
</li>
<li>Trong dấu ngoặc đơn của <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code>:
<ul>
<li>dấu <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code> đầu tiên đứng trước <code>.f</code> mà <code>map()</code> sẽ lặp qua<code>.x</code><br>
</li>
<li>
<code>.x</code> đại diện cho cột hiện tại được cung cấp cho hàm <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code><br>
</li>
<li>dấu <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code> thứ hai là một phần của phương trình t-test được mô tả ở trên<br>
</li>
<li>hàm <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code> yêu cầu một cột nhị phân ở phía bên phải của phương trình. Chúng tôi đưa vector <code>linelist$gender</code> một cách độc lập và có ý nghĩa thống kê (lưu ý rằng nó không được bao gồm trong <code>select()</code>).</li>
</ul>
</li>
</ul>
<p><code>map()</code> trả về một danh sách, vì vậy đầu ra là một danh sách các kết quả t-test - một danh sách phần tử cho mỗi cột số được phân tích.</p>
<div class="sourceCode" id="cb794"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Results are saved as a list</span>
<span class="va">t.test_results</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">age</span>, <span class="va">wt_kg</span>, <span class="va">ht_cm</span>, <span class="va">ct_blood</span>, <span class="va">temp</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># keep only some numeric columns to map across</span>
  <span class="fu">map</span><span class="op">(</span>.f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">.x</span> <span class="op">~</span> <span class="va">linelist</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span><span class="op">)</span>        <span class="co"># t.test function, with equation NUMERIC ~ CATEGORICAL</span></code></pre></div>
<p>Đây là danh sách <code>t.test_results</code> trông như thế nào khi được mở (Cửa sổ Viewer) trong RStudio. Chúng tôi đã đánh dấu các phần quan trọng đối với các ví dụ trong trang này.</p>
<ul>
<li>Ở trên cùng, bạn có thể thấy toàn bộ danh sách được đặt tên là <code>t.test_results</code> và có năm phần tử. Năm phần tử đó được đặt tên là <code>age</code>, <code>wt_km</code>, <code>ht_cm</code>, <code>ct_blood</code>, <code>temp</code> theo mỗi biến được sử dụng trong t-test với <code>gender</code> từ <code>linelist</code>.<br>
</li>
<li>Mỗi phần tử trong số năm phần tử đó đều là danh sách, với các phần tử bên trong chúng, chẳng hạn như <code>p.value</code> và <code>conf.int</code>. Một số phần tử như <code>p.value</code> là các số đơn lẻ, trong khi một số phần tử như <code>estimate</code> bao gồm hai hoặc nhiều phần tử (<code>mean in group f</code> và <code>mean in group m</code>).</li>
</ul>
<div class="inline-figure"><img src="images/purrr_ttest.png" width="286" height="150%"></div>
<p>Lưu ý: Hãy nhớ rằng nếu bạn chỉ muốn áp dụng một hàm cho một số cột nhất định trong data frame, bạn cũng có thể chỉ cần sử dụng <code>mutate()</code> và <code>across()</code>, như được giải thích trong chương <a href="cleaning.html#cleaning">Làm sạch số liệu và các hàm quan trọng</a>. Dưới đây là một ví dụ về việc áp dụng <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> cho chỉ các cột “age”. Lưu ý vị trí của dấu ngoặc đơn và dấu phẩy.</p>
<div class="sourceCode" id="cb795"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># convert columns with column name containing "age" to class Character</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">contains</span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">as.character</span><span class="op">)</span><span class="op">)</span>  </code></pre></div>
</div>
<div id="trích-xuất-từ-danh-sách" class="section level3 unnumbered">
<h3>Trích xuất từ danh sách<a class="anchor" aria-label="anchor" href="#tr%C3%ADch-xu%E1%BA%A5t-t%E1%BB%AB-danh-s%C3%A1ch"><i class="fas fa-link"></i></a>
</h3>
<p>Khi <code>map()</code> tạo ra một đầu ra của lớp danh sách, chúng ta sẽ dành một chút thời gian thảo luận về cách trích xuất dữ liệu từ danh sách bằng cách sử dụng các hàm <strong>purrr</strong> đi kèm. Để minh họa điều này, chúng tôi sẽ sử dụng danh sách <code>t.test_results</code> từ phần trước. Đây là danh sách gồm 5 danh sách - mỗi danh sách trong số 5 danh sách chứa kết quả của t-test giữa một cột từ data frame <code>linelist</code> và cột nhị phân <code>gender</code> của nó. Xem hình ảnh trong phần trên để có hình ảnh về cấu trúc danh sách.</p>
<div id="tên-của-các-phần-tử" class="section level4 unnumbered">
<h4>Tên của các phần tử<a class="anchor" aria-label="anchor" href="#t%C3%AAn-c%E1%BB%A7a-c%C3%A1c-ph%E1%BA%A7n-t%E1%BB%AD"><i class="fas fa-link"></i></a>
</h4>
<p>Để trích xuất tên của chính các phần tử, chỉ cần sử dụng <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> từ <strong>base</strong> R. Trong trường hợp này, chúng tôi sử dụng <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> trên <code>t.test_results</code> để trả về tên của mỗi danh sách con, là tên của 5 biến đã thực hiện t-tests.</p>
<div class="sourceCode" id="cb796"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">t.test_results</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "age"      "wt_kg"    "ht_cm"    "ct_blood" "temp"</code></pre>
</div>
<div id="các-phần-tử-theo-tên-hoặc-vị-trí" class="section level4 unnumbered">
<h4>Các phần tử theo tên hoặc vị trí<a class="anchor" aria-label="anchor" href="#c%C3%A1c-ph%E1%BA%A7n-t%E1%BB%AD-theo-t%C3%AAn-ho%E1%BA%B7c-v%E1%BB%8B-tr%C3%AD"><i class="fas fa-link"></i></a>
</h4>
<p>Để trích xuất các phần tử danh sách theo tên hoặc theo vị trí, bạn có thể sử dụng dấu ngoặc <code>[[ ]]</code> như được mô tả trong chương <a href="basics.html#basics">R cơ bản</a>. Dưới đây chúng tôi sử dụng dấu ngoặc kép để lập chỉ mục danh sách <code>t.tests_results</code> và hiển thị phần tử đầu tiên là kết quả của t-test trên <code>age</code>.</p>
<div class="sourceCode" id="cb798"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t.test_results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># first element by position</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  .x by linelist$gender
## t = -21.3, df = 4902.9, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means between group f and group m is not equal to 0
## 95 percent confidence interval:
##  -7.544409 -6.272675
## sample estimates:
## mean in group f mean in group m 
##        12.66085        19.56939</code></pre>
<div class="sourceCode" id="cb800"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t.test_results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">"p.value"</span><span class="op">]</span> <span class="co"># return element named "p.value" from first element  </span></code></pre></div>
<pre><code>## $p.value
## [1] 2.350374e-96</code></pre>
<p>Tuy nhiên, dưới đây chúng tôi sẽ trình bày việc sử dụng các hàm <code>map()</code> và <code>pluck()</code> của <strong>purrr</strong> đơn giản và linh hoạt để đạt được kết quả tương tự.</p>
</div>
<div id="pluck" class="section level4 unnumbered">
<h4>
<code>pluck()</code><a class="anchor" aria-label="anchor" href="#pluck"><i class="fas fa-link"></i></a>
</h4>
<p><code>pluck()</code> kéo ra các phần tử theo tên hoặc theo vị trí. Ví dụ - để trích xuất kết quả t-test cho độ tuổi, bạn có thể sử dụng <code>pluck()</code> như thế này:</p>
<div class="sourceCode" id="cb802"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t.test_results</span> <span class="op">%&gt;%</span> 
  <span class="fu">pluck</span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span>        <span class="co"># alternatively, use pluck(1)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  .x by linelist$gender
## t = -21.3, df = 4902.9, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means between group f and group m is not equal to 0
## 95 percent confidence interval:
##  -7.544409 -6.272675
## sample estimates:
## mean in group f mean in group m 
##        12.66085        19.56939</code></pre>
<p>Lập chỉ mục các cấp độ sâu hơn bằng cách chỉ định các cấp độ cao hơn bằng dấu phẩy. Dưới đây trích xuất phần tử có tên “p.value” từ danh sách <code>age</code> trong danh sách <code>t.test_results</code>. Bạn cũng có thể sử dụng số thay vì tên ký tự.</p>
<div class="sourceCode" id="cb804"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t.test_results</span> <span class="op">%&gt;%</span> 
  <span class="fu">pluck</span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"p.value"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2.350374e-96</code></pre>
<p>Bạn có thể trích xuất các phần tử bên trong như vậy từ <em>tất cả</em> các phần tử cấp một bằng cách sử dụng <code>map()</code> để chạy hàm <code>pluck()</code> trên từng phần tử cấp một. Ví dụ, đoạn mã dưới đây trích xuất các phần tử “p.value” từ tất cả các danh sách trong <code>t.test_results</code>. Danh sách các kết quả t-test là <code>.x</code> được lặp qua,<code>pluck()</code> là hàm <code>.f</code> đang được lặp và giá trị “p-value” được cung cấp cho hàm.</p>
<div class="sourceCode" id="cb806"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t.test_results</span> <span class="op">%&gt;%</span>
  <span class="fu">map</span><span class="op">(</span><span class="va">pluck</span>, <span class="st">"p.value"</span><span class="op">)</span>   <span class="co"># return every p-value</span></code></pre></div>
<pre><code>## $age
## [1] 2.350374e-96
## 
## $wt_kg
## [1] 2.664367e-182
## 
## $ht_cm
## [1] 3.515713e-144
## 
## $ct_blood
## [1] 0.4473498
## 
## $temp
## [1] 0.5735923</code></pre>
<p>Một cách thay thế khác là <code>map()</code> viết tắt tên phần tử trong dấu ngoặc kép và nó sẽ ngắt nó ra. Nếu bạn sử dụng <code>map()</code>, đầu ra sẽ là một danh sách, trong khi nếu bạn sử dụng <code>map_chr()</code> thì nó sẽ là một vectơ ký tự được đặt tên và nếu bạn sử dụng <code>map_dbl()</code> nó sẽ là một vector số được đặt tên.</p>
<div class="sourceCode" id="cb808"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t.test_results</span> <span class="op">%&gt;%</span> 
  <span class="fu">map_dbl</span><span class="op">(</span><span class="st">"p.value"</span><span class="op">)</span>   <span class="co"># return p-values as a named numeric vector</span></code></pre></div>
<pre><code>##           age         wt_kg         ht_cm      ct_blood          temp 
##  2.350374e-96 2.664367e-182 3.515713e-144  4.473498e-01  5.735923e-01</code></pre>
<p>Bạn có thể đọc thêm về <code>pluck()</code> trong <a href="https://purrr.tidyverse.org/reference/pluck.html">tài liệu</a> về <strong>purrr</strong>. Nó có một hàm tương tự là <code>chuck()</code> sẽ trả về lỗi thay vì NULL nếu một phần tử không tồn tại.</p>
</div>
</div>
<div id="chuyển-đổi-danh-sách-thành-data-frame" class="section level3 unnumbered">
<h3>Chuyển đổi danh sách thành data frame<a class="anchor" aria-label="anchor" href="#chuy%E1%BB%83n-%C4%91%E1%BB%95i-danh-s%C3%A1ch-th%C3%A0nh-data-frame"><i class="fas fa-link"></i></a>
</h3>
<p>Đây là một nội dung phức tạp - hãy xem phần Tài nguyên học liệu để có các hướng dẫn đầy đủ hơn. Tuy nhiên, chúng tôi sẽ minh họa việc chuyển đổi danh sách các kết quả t-test thành một data frame. Chúng tôi sẽ tạo một data frame với các cột cho biến, p-value của nó và giá trị trung bình từ hai nhóm (nam và nữ).</p>
<p>Dưới đây là một số phương pháp và hàm mới sẽ được sử dụng:</p>
<ul>
<li>Hàm <code>tibble()</code> sẽ được sử dụng để tạo một tibble (giống như một data frame)
<ul>
<li>Chúng tôi bao quanh hàm <code>tibble()</code> bằng dấu ngoặc nhọn <code>{ }</code> để ngăn toàn bộ <code>t.test_results</code> được lưu trữ dưới dạng cột nhỏ đầu tiên<br>
</li>
</ul>
</li>
<li>Trong <code>tibble()</code>, mỗi cột được tạo một cách rõ ràng, tương tự như cú pháp của <code>mutate()</code>:
<ul>
<li>Dấu <code>.</code> đại diện cho <code>t.test_results</code><br>
</li>
<li>Để tạo một cột với các tên biến t-test (tên của mỗi phần tử danh sách), chúng tôi sử dụng <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> như đã mô tả ở trên<br>
</li>
<li>Để tạo một cột với các p-values, chúng tôi sử dụng <code>map_dbl()</code> như được mô tả ở trên để kéo các phần tử <code>p.value</code> và chuyển đổi chúng thành một vector số</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb810"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t.test_results</span> <span class="op">%&gt;%</span> <span class="op">{</span>
  <span class="fu">tibble</span><span class="op">(</span>
    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,
    p         <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">.</span>, <span class="st">"p.value"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   variables         p
##   &lt;chr&gt;         &lt;dbl&gt;
## 1 age       2.35e- 96
## 2 wt_kg     2.66e-182
## 3 ht_cm     3.52e-144
## 4 ct_blood  4.47e-  1
## 5 temp      5.74e-  1</code></pre>
<p>Nhưng bây giờ hãy thêm các cột chứa trung bình cho mỗi nhóm (nam và nữ).</p>
<p>Chúng tôi sẽ cần trích xuất phần tử <code>estimate</code>, nhưng điều này thực sự chứa <em>hai</em> phần tử bên trong nó (<code>mean in group f</code> và <code>mean in group m</code>). Vì vậy, nó không thể được đơn giản hóa thành một vector với <code>map_chr()</code> hoặc <code>map_dbl()</code>. Thay vào đó, chúng tôi sử dụng <code>map()</code>, được sử dụng trong <code>tibble()</code>, sẽ tạo <em>một cột lớp danh sách trong tibble</em>! Vâng, điều này là có thể!</p>
<div class="sourceCode" id="cb812"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t.test_results</span> <span class="op">%&gt;%</span> 
  <span class="op">{</span><span class="fu">tibble</span><span class="op">(</span>
    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,
    p <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">.</span>, <span class="st">"p.value"</span><span class="op">)</span>,
    means <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">.</span>, <span class="st">"estimate"</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##   variables         p means       
##   &lt;chr&gt;         &lt;dbl&gt; &lt;named list&gt;
## 1 age       2.35e- 96 &lt;dbl [2]&gt;   
## 2 wt_kg     2.66e-182 &lt;dbl [2]&gt;   
## 3 ht_cm     3.52e-144 &lt;dbl [2]&gt;   
## 4 ct_blood  4.47e-  1 &lt;dbl [2]&gt;   
## 5 temp      5.74e-  1 &lt;dbl [2]&gt;</code></pre>
<p>Sau khi bạn có cột danh sách này, có một số hàm <strong>tidyr</strong> (một phần của <strong>tidyverse</strong>) giúp bạn “gỡ rối” hoặc “gỡ bỏ” các cột “danh sách lồng nhau” này. Đọc thêm về chúng <a href="">tại đây</a> hoặc bằng cách chạy <code>vignette("rectangle")</code>. Tóm lại:</p>
<ul>
<li>
<code>unnest_wider()</code> - đưa mỗi phần tử của mỗi danh sách cột một cột riêng của nó<br>
</li>
<li>
<code>unnest_longer()</code> - đưa mỗi phần tử của mỗi danh sách cột một hàng riêng của nó<br>
</li>
<li>
<code>hoist()</code> - hoạt động giống như <code>unnest_wider()</code> nhưng bạn chỉ định phần tử nào cần gỡ bỏ</li>
</ul>
<p>Dưới đây, chúng tôi chuyển tibble sang <code>unnest_wider()</code> để chỉ định cột <code>means</code> của tibble (là một danh sách lồng nhau). Kết quả là <code>means</code> được thay thế bằng hai cột mới, mỗi cột phản ánh hai phần tử trước đó trong mỗi ô <code>means</code>.</p>
<div class="sourceCode" id="cb814"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t.test_results</span> <span class="op">%&gt;%</span> 
  <span class="op">{</span><span class="fu">tibble</span><span class="op">(</span>
    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,
    p <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">.</span>, <span class="st">"p.value"</span><span class="op">)</span>,
    means <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">.</span>, <span class="st">"estimate"</span><span class="op">)</span>
    <span class="op">)</span><span class="op">}</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">means</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##   variables         p `mean in group f` `mean in group m`
##   &lt;chr&gt;         &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;
## 1 age       2.35e- 96              12.7              19.6
## 2 wt_kg     2.66e-182              45.8              59.6
## 3 ht_cm     3.52e-144             109.              142. 
## 4 ct_blood  4.47e-  1              21.2              21.2
## 5 temp      5.74e-  1              38.6              38.6</code></pre>
</div>
<div id="loại-bỏ-giữ-lại-và-thu-gọn-danh-sách" class="section level3 unnumbered">
<h3>Loại bỏ, giữ lại và thu gọn danh sách<a class="anchor" aria-label="anchor" href="#lo%E1%BA%A1i-b%E1%BB%8F-gi%E1%BB%AF-l%E1%BA%A1i-v%C3%A0-thu-g%E1%BB%8Dn-danh-s%C3%A1ch"><i class="fas fa-link"></i></a>
</h3>
<p>Vì làm việc với <strong>purrr</strong> nên thường liên quan đến danh sách, chúng ta sẽ khám phá ngắn gọn một số hàm <strong>purrr</strong> để sửa đổi danh sách. Xem phần Tài nguyên học liệu để có hướng dẫn đầy đủ hơn về các hàm <strong>purrr</strong>.</p>
<ul>
<li>
<code>list_modify()</code> có nhiều cách sử dụng, một trong số đó có thể là xóa một phần tử danh sách<br>
</li>
<li>
<code>keep()</code> giữ lại các phần tử được chỉ định cho <code>.p =</code> hoặc trong đó một hàm được cung cấp cho <code>.p =</code> đánh giá là TRUE<br>
</li>
<li>
<code>discard()</code> loại bỏ các phần tử được chỉ định cho <code>.p</code> hoặc trong đó một hàm được cung cấp cho <code>.p =</code> đánh giá là TRUE<br>
</li>
<li>
<code>compact()</code> loại bỏ tất cả các phần tử trống</li>
</ul>
<p>Dưới đây là một số ví dụ sử dụng danh sách <code>combined</code> được tạo trong phần trên về <a href="#%20iter_combined">sử dụng map() để nhập và kết hợp nhiều tệp</a> (nó chứa 6 trường hợp linelist thuộc data frames):</p>
<p>Các phần tử có thể được xóa bằng tên với <code>list_modify()</code> và đặt tên bằng <code>NULL</code>.</p>
<div class="sourceCode" id="cb816"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">combined</span> <span class="op">%&gt;%</span> 
  <span class="fu">list_modify</span><span class="op">(</span><span class="st">"Central Hospital"</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>   <span class="co"># remove list element by name</span></code></pre></div>
<p>Bạn cũng có thể loại bỏ các phần tử theo tiêu chí, bằng cách cung cấp phương trình “định trước” cho <code>.p =</code> (một phương trình đánh giá là TRUE hoặc FALSE). Đặt dấu ngã <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code> trước hàm và sử dụng <code>.x</code> để đại diện cho phần tử danh sách. Sử dụng <code>keep()</code>, các phần tử danh sách đánh giá là TRUE sẽ được giữ lại. Ngược lại, nếu sử dụng <code>discard()</code>, các phần tử danh sách đánh giá là TRUE sẽ bị loại bỏ.</p>
<div class="sourceCode" id="cb817"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># keep only list elements with more than 500 rows</span>
<span class="va">combined</span> <span class="op">%&gt;%</span> 
  <span class="fu">keep</span><span class="op">(</span>.p <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">500</span><span class="op">)</span>  </code></pre></div>
<p>Trong ví dụ dưới đây, các phần tử danh sách bị loại bỏ nếu lớp của chúng không phải là data frames.</p>
<div class="sourceCode" id="cb818"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Discard list elements that are not data frames</span>
<span class="va">combined</span> <span class="op">%&gt;%</span> 
  <span class="fu">discard</span><span class="op">(</span>.p <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"data.frame"</span><span class="op">)</span></code></pre></div>
<p>Hàm định trước của bạn cũng có thể tham chiếu các phần tử/cột trong mỗi mục danh sách. Ví dụ, bên dưới, liệt kê các phần tử có giá trị trung bình của cột <code>ct_blood</code> trên 25 sẽ bị loại bỏ.</p>
<div class="sourceCode" id="cb819"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># keep only list elements where ct_blood column mean is over 25</span>
<span class="va">combined</span> <span class="op">%&gt;%</span> 
  <span class="fu">discard</span><span class="op">(</span>.p <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">ct_blood</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">25</span><span class="op">)</span>  </code></pre></div>
<p>Lệnh này sẽ xóa tất cả các phần tử danh sách trống:</p>
<div class="sourceCode" id="cb820"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Remove all empty list elements</span>
<span class="va">combined</span> <span class="op">%&gt;%</span> 
  <span class="fu">compact</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="pmap" class="section level3 unnumbered">
<h3>
<code>pmap()</code><a class="anchor" aria-label="anchor" href="#pmap"><i class="fas fa-link"></i></a>
</h3>
<p>PHẦN NÀY ĐANG ĐƯỢC XÂY DỰNG</p>
</div>
</div>
<div id="các-hàm-apply" class="section level2" number="16.4">
<h2>
<span class="header-section-number">16.4</span> Các hàm apply<a class="anchor" aria-label="anchor" href="#c%C3%A1c-h%C3%A0m-apply"><i class="fas fa-link"></i></a>
</h2>
<p>Nhóm hàm “apply” là một hàm R <strong>base</strong> thay thế cho <strong>purrr</strong> với các thao tác lặp lại. Bạn có thể đọc thêm về chúng <a href="https://www.datacamp.com/community/tutorials/r-tutorial-apply-family">tại đây</a>.</p>
<!-- ======================================================= -->
</div>
<div id="tài-nguyên-học-liệu-4" class="section level2" number="16.5">
<h2>
<span class="header-section-number">16.5</span> Tài nguyên học liệu<a class="anchor" aria-label="anchor" href="#t%C3%A0i-nguy%C3%AAn-h%E1%BB%8Dc-li%E1%BB%87u-4"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://datacarpentry.org/semester-biology/materials/for-loops-R/">for loops with Data Carpentry</a></p>
<p>The <a href="https://r4ds.had.co.nz/iteration.html#iteration">R for Data Science page on iteration</a></p>
<p><a href="https://martinctc.github.io/blog/vignette-write-and-read-multiple-excel-files-with-purrr/">Vignette on write/read Excel files</a></p>
<p>A purrr <a href="https://jennybc.github.io/purrr-tutorial/index.html">tutorial</a> by jennybc</p>
<p>Another purrr <a href="http://www.rebeccabarter.com/blog/2019-08-19_purrr/">tutorial</a> by Rebecca Barter</p>
<p>A purrr <a href="http://zevross.com/blog/2019/06/11/the-power-of-three-purrr-poseful-iteration-in-r-with-map-pmap-and-imap/">tutorial</a> on map, pmap, and imap</p>
<p><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/master/pngs/thumbnails/purrr-cheatsheet-thumbs.png">purrr cheatsheet</a></p>
<p><a href="https://www.hvitfeldt.me/blog/purrr-tips-and-tricks/">purrr tips and tricks</a></p>
<p><a href="https://hookedondata.org/going-off-the-map/#keep-and-discard">keep and discard</a></p>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="deduplication.html"><span class="header-section-number">15</span> Loại bỏ trùng lặp</a></div>
<div class="next"><a href="tables-descriptive.html"><span class="header-section-number">17</span> Bảng mô tả</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#iteration"><span class="header-section-number">16</span> Lặp, vòng lặp, và danh sách</a></li>
<li>
<a class="nav-link" href="#chu%E1%BA%A9n-b%E1%BB%8B-7"><span class="header-section-number">16.1</span> Chuẩn bị</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#g%E1%BB%8Di-packages-3">Gọi packages</a></li>
<li><a class="nav-link" href="#nh%E1%BA%ADp-d%E1%BB%AF-li%E1%BB%87u-9">Nhập dữ liệu</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#v%C3%B2ng-l%E1%BA%B7p-for"><span class="header-section-number">16.2</span> vòng lặp for</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#iter_loops">vòng lặp for trong R</a></li>
<li><a class="nav-link" href="#c%E1%BA%A5u-ph%E1%BA%A7n-c%E1%BB%91t-l%C3%B5i">Cấu phần cốt lõi</a></li>
<li><a class="nav-link" href="#chu%E1%BB%97i">Chuỗi</a></li>
<li><a class="nav-link" href="#c%C3%A1c-thao-t%C3%A1c">Các thao tác</a></li>
<li><a class="nav-link" href="#v%C3%B9ng-ch%E1%BB%A9a">Vùng chứa</a></li>
<li><a class="nav-link" href="#in-1">In</a></li>
<li><a class="nav-link" href="#ki%E1%BB%83m-tra-v%C3%B2ng-l%E1%BA%B7p-for">Kiểm tra vòng lặp for</a></li>
<li><a class="nav-link" href="#l%E1%BA%B7p-l%E1%BA%A1i-bi%E1%BB%83u-%C4%91%E1%BB%93">Lặp lại biểu đồ</a></li>
<li><a class="nav-link" href="#theo-d%C3%B5i-ti%E1%BA%BFn-tr%C3%ACnh-c%E1%BB%A7a-m%E1%BB%99t-v%C3%B2ng-l%E1%BA%B7p">Theo dõi tiến trình của một vòng lặp</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#iter_purrr"><span class="header-section-number">16.3</span> purrr và các danh sách</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#t%E1%BA%A3i-packages">Tải packages</a></li>
<li><a class="nav-link" href="#map">map()</a></li>
<li><a class="nav-link" href="#t%C3%A1ch-v%C3%A0-xu%E1%BA%A5t-b%E1%BB%99-d%E1%BB%AF-li%E1%BB%87u">Tách và xuất bộ dữ liệu</a></li>
<li><a class="nav-link" href="#h%C3%A0m-t%C3%B9y-ch%E1%BB%89nh">Hàm tùy chỉnh</a></li>
<li><a class="nav-link" href="#%C3%A1p-d%E1%BB%A5ng-m%E1%BB%99t-h%C3%A0m-qua-nhi%E1%BB%81u-c%E1%BB%99t">Áp dụng một hàm qua nhiều cột</a></li>
<li><a class="nav-link" href="#tr%C3%ADch-xu%E1%BA%A5t-t%E1%BB%AB-danh-s%C3%A1ch">Trích xuất từ danh sách</a></li>
<li><a class="nav-link" href="#chuy%E1%BB%83n-%C4%91%E1%BB%95i-danh-s%C3%A1ch-th%C3%A0nh-data-frame">Chuyển đổi danh sách thành data frame</a></li>
<li><a class="nav-link" href="#lo%E1%BA%A1i-b%E1%BB%8F-gi%E1%BB%AF-l%E1%BA%A1i-v%C3%A0-thu-g%E1%BB%8Dn-danh-s%C3%A1ch">Loại bỏ, giữ lại và thu gọn danh sách</a></li>
<li><a class="nav-link" href="#pmap">pmap()</a></li>
</ul>
</li>
<li><a class="nav-link" href="#c%C3%A1c-h%C3%A0m-apply"><span class="header-section-number">16.4</span> Các hàm apply</a></li>
<li><a class="nav-link" href="#t%C3%A0i-nguy%C3%AAn-h%E1%BB%8Dc-li%E1%BB%87u-4"><span class="header-section-number">16.5</span> Tài nguyên học liệu</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Cẩm nang dịch tễ học với R</strong>" was written by the handbook team. It was last built on 2021-10-14.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
